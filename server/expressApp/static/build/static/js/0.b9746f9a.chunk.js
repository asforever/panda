(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{51:function(e,t,n){"use strict";var i=n(13);function r(e,t,n){return(r="undefined"!==typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Object(i.a)(e)););return e}(e,t);if(r){var a=Object.getOwnPropertyDescriptor(r,t);return a.get?a.get.call(n):a.value}})(e,t,n||e)}n.d(t,"a",function(){return r})},52:function(e,t,n){"use strict";n.d(t,"a",function(){return u});var i=n(4),r=n(5),a=n(53),s=n(55),u=function(){function e(){Object(i.a)(this,e),this.canvas=null,this.renderer=null,this.renderTarget=null,this.scene=null,this.camera=null,this.needRender=!1,this.listenerManager=new s.a}return Object(r.a)(e,[{key:"setUp",value:function(e){this.renderer=a.v.create({canvas:e,antialias:!0}),this.listenerManager.addListener("resize",this.resize.bind(this),window),this.canvas=e,this.scene=new a.o;var t=this.camera=new a.l(70,e.clientWidth/e.clientHeight,.1,1e3);t.position.set(0,0,5),t.updateMatrix(),t.lookAt(new a.t(0,0,0)),e.width=e.clientWidth,e.height=e.clientHeight}},{key:"loadScene",value:function(){}},{key:"dispose",value:function(){this.needRender=!1,this.listenerManager.dispose(),this.renderer&&this.renderer.dispose(),this.renderer=null,this.scene.dispose(),this.camera.dispose()}},{key:"render",value:function(){this.renderer.render(this.scene,this.camera)}},{key:"resize",value:function(){this.resizeCanvas(),this.updateCamera(this.canvas.width,this.canvas.height)}},{key:"resizeCanvas",value:function(){var e=this.canvas;e.width=e.clientWidth,e.height=e.clientHeight}},{key:"updateCamera",value:function(e,t){this.renderer.viewport(0,0,e,t),this.camera.aspect=e/t,this.camera.updateProjectionMatrix()}},{key:"startAnimate",value:function(){this.needRender=!0,this.animate()}},{key:"animate",value:function(){this.needRender&&(this.render(),requestAnimationFrame(this.animate.bind(this)))}}]),e}()},53:function(e,t,n){"use strict";var i=n(4),r=n(5),a=n(14),s=n(13),u=n(15),o=function(){function e(t,n,r,a){Object(i.a)(this,e),this._x=t||0,this._y=n||0,this._z=r||0,this._w=void 0!==a?a:1}return Object(r.a)(e,[{key:"setFromEuler",value:function(e,t){if(!e||!e.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");var n=e._x,i=e._y,r=e._z,a=e._order,s=Math.cos,u=Math.sin,o=s(n/2),c=s(i/2),l=s(r/2),h=u(n/2),f=u(i/2),d=u(r/2);return"XYZ"===a?(this._x=h*c*l+o*f*d,this._y=o*f*l-h*c*d,this._z=o*c*d+h*f*l,this._w=o*c*l-h*f*d):"YXZ"===a?(this._x=h*c*l+o*f*d,this._y=o*f*l-h*c*d,this._z=o*c*d-h*f*l,this._w=o*c*l+h*f*d):"ZXY"===a?(this._x=h*c*l-o*f*d,this._y=o*f*l+h*c*d,this._z=o*c*d+h*f*l,this._w=o*c*l-h*f*d):"ZYX"===a?(this._x=h*c*l-o*f*d,this._y=o*f*l+h*c*d,this._z=o*c*d-h*f*l,this._w=o*c*l+h*f*d):"YZX"===a?(this._x=h*c*l+o*f*d,this._y=o*f*l+h*c*d,this._z=o*c*d-h*f*l,this._w=o*c*l-h*f*d):"XZY"===a&&(this._x=h*c*l-o*f*d,this._y=o*f*l-h*c*d,this._z=o*c*d+h*f*l,this._w=o*c*l+h*f*d),this}},{key:"x",get:function(){return this._x}},{key:"y",get:function(){return this._y}},{key:"z",get:function(){return this._z}},{key:"w",get:function(){return this._w}}]),e}(),c=function(){function e(t,n,r){var a=this;Object(i.a)(this,e),this.applyEuler=function(){var e=new o;return function(t){return t&&t.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),a.applyQuaternion(e.setFromEuler(t))}}(),this._x=t||0,this._y=n||0,this._z=r||0}return Object(r.a)(e,[{key:"set",value:function(e,t,n){this._x=e,this._y=t,this._z=n,this.onChange()}},{key:"add",value:function(e){return this._x+=e.x,this._y+=e.y,this._z+=e.z,this.onChange(),this}},{key:"applyQuaternion",value:function(e){var t=this.x,n=this.y,i=this.z,r=e.x,a=e.y,s=e.z,u=e.w,o=u*t+a*i-s*n,c=u*n+s*t-r*i,l=u*i+r*n-a*t,h=-r*t-a*n-s*i;return this._x=o*u+h*-r+c*-s-l*-a,this._y=c*u+h*-a+l*-r-o*-s,this._z=l*u+h*-s+o*-a-c*-r,this.onChange(),this}},{key:"applyMatrix4",value:function(e){var t=this.x,n=this.y,i=this.z,r=e.elements,a=1/(r[3]*t+r[7]*n+r[11]*i+r[15]);return this._x=(r[0]*t+r[4]*n+r[8]*i+r[12])*a,this._y=(r[1]*t+r[5]*n+r[9]*i+r[13])*a,this._z=(r[2]*t+r[6]*n+r[10]*i+r[14])*a,this.onChange(),this}},{key:"setFromMatrixPosition",value:function(e){var t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}},{key:"subVectors",value:function(e,t){return this._x=e.x-t.x,this._y=e.y-t.y,this._z=e.z-t.z,this.onChange(),this}},{key:"lengthSq",value:function(){return this.x*this.x+this.y*this.y+this.z*this.z}},{key:"multiplyScalar",value:function(e){return this._x*=e,this._y*=e,this._z*=e,this.onChange(),this}},{key:"divideScalar",value:function(e){return this.multiplyScalar(1/e)}},{key:"crossVectors",value:function(e,t){var n=e.x,i=e.y,r=e.z,a=t.x,s=t.y,u=t.z;return this._x=i*u-r*s,this._y=r*a-n*u,this._z=n*s-i*a,this.onChange(),this}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}},{key:"normalize",value:function(){return this.divideScalar(this.length()||1)}},{key:"clone",value:function(){return new this.constructor(this.x,this.y,this.z)}},{key:"toArray",value:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}},{key:"onChange",value:function(){}},{key:"x",get:function(){return this._x},set:function(e){this._x=e||0,this.onChange()}},{key:"y",get:function(){return this._y},set:function(e){this._y=e||0,this.onChange()}},{key:"z",get:function(){return this._z},set:function(e){this._z=e||0,this.onChange()}}]),e}(),l=function(e){function t(){var e;return Object(i.a)(this,t),(e=Object(a.a)(this,Object(s.a)(t).call(this))).lookAt=function(){var e=new c,t=new c,n=new c;return function(i,r,a){var s=this.elements;return n.subVectors(i,r),0===n.lengthSq()&&(n.z=1),n.normalize(),e.crossVectors(a,n),0===e.lengthSq()&&(1===Math.abs(a.z)?n.x+=1e-4:n.z+=1e-4,n.normalize(),e.crossVectors(a,n)),e.normalize(),t.crossVectors(n,e),s[0]=e.x,s[4]=t.x,s[8]=n.x,s[1]=e.y,s[5]=t.y,s[9]=n.y,s[2]=e.z,s[6]=t.z,s[10]=n.z,this}}(),e.isMatrix4=!0,e.needsUpdate=!0,e.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],e}return Object(u.a)(t,e),Object(r.a)(t,[{key:"compose",value:function(e,t,n){var i=this.elements,r=t._x,a=t._y,s=t._z,u=t._w,o=r+r,c=a+a,l=s+s,h=r*o,f=r*c,d=r*l,_=a*c,v=a*l,m=s*l,p=u*o,E=u*c,g=u*l,y=n.x,A=n.y,b=n.z;return i[0]=(1-(_+m))*y,i[1]=(f+g)*y,i[2]=(d-E)*y,i[3]=0,i[4]=(f-g)*A,i[5]=(1-(h+m))*A,i[6]=(v+p)*A,i[7]=0,i[8]=(d+E)*b,i[9]=(v-p)*b,i[10]=(1-(h+_))*b,i[11]=0,i[12]=e.x,i[13]=e.y,i[14]=e.z,i[15]=1,this}},{key:"set",value:function(e,t,n,i,r,a,s,u,o,c,l,h,f,d,_,v){var m=this.elements;return m[0]=e,m[4]=t,m[8]=n,m[12]=i,m[1]=r,m[5]=a,m[9]=s,m[13]=u,m[2]=o,m[6]=c,m[10]=l,m[14]=h,m[3]=f,m[7]=d,m[11]=_,m[15]=v,this}},{key:"identity",value:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}},{key:"makePerspective",value:function(e,t,n,i,r,a){var s=this.elements,u=2*r/(t-e),o=2*r/(n-i),c=(t+e)/(t-e),l=(n+i)/(n-i),h=-(a+r)/(a-r),f=-2*a*r/(a-r);return s[0]=u,s[4]=0,s[8]=c,s[12]=0,s[1]=0,s[5]=o,s[9]=l,s[13]=0,s[2]=0,s[6]=0,s[10]=h,s[14]=f,s[3]=0,s[7]=0,s[11]=-1,s[15]=0,this}},{key:"makeTranslation",value:function(e,t,n){return this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this}},{key:"multiply",value:function(e,t){return void 0!==t?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)}},{key:"multiplyMatrices",value:function(e,t){var n=e.elements,i=t.elements,r=this.elements,a=n[0],s=n[4],u=n[8],o=n[12],c=n[1],l=n[5],h=n[9],f=n[13],d=n[2],_=n[6],v=n[10],m=n[14],p=n[3],E=n[7],g=n[11],y=n[15],A=i[0],b=i[4],S=i[8],T=i[12],O=i[1],U=i[5],M=i[9],k=i[13],R=i[2],C=i[6],L=i[10],x=i[14],F=i[3],I=i[7],w=i[11],P=i[15];return r[0]=a*A+s*O+u*R+o*F,r[4]=a*b+s*U+u*C+o*I,r[8]=a*S+s*M+u*L+o*w,r[12]=a*T+s*k+u*x+o*P,r[1]=c*A+l*O+h*R+f*F,r[5]=c*b+l*U+h*C+f*I,r[9]=c*S+l*M+h*L+f*w,r[13]=c*T+l*k+h*x+f*P,r[2]=d*A+_*O+v*R+m*F,r[6]=d*b+_*U+v*C+m*I,r[10]=d*S+_*M+v*L+m*w,r[14]=d*T+_*k+v*x+m*P,r[3]=p*A+E*O+g*R+y*F,r[7]=p*b+E*U+g*C+y*I,r[11]=p*S+E*M+g*L+y*w,r[15]=p*T+E*k+g*x+y*P,this}},{key:"getInverse",value:function(e,t){var n=this.elements,i=e.elements,r=i[0],a=i[1],s=i[2],u=i[3],o=i[4],c=i[5],l=i[6],h=i[7],f=i[8],d=i[9],_=i[10],v=i[11],m=i[12],p=i[13],E=i[14],g=i[15],y=d*E*h-p*_*h+p*l*v-c*E*v-d*l*g+c*_*g,A=m*_*h-f*E*h-m*l*v+o*E*v+f*l*g-o*_*g,b=f*p*h-m*d*h+m*c*v-o*p*v-f*c*g+o*d*g,S=m*d*l-f*p*l-m*c*_+o*p*_+f*c*E-o*d*E,T=r*y+a*A+s*b+u*S;if(0===T){var O="THREE.Matrix4: .getInverse() can't invert matrix, determinant is 0";if(!0===t)throw new Error(O);return console.warn(O),this.identity()}var U=1/T;return n[0]=y*U,n[1]=(p*_*u-d*E*u-p*s*v+a*E*v+d*s*g-a*_*g)*U,n[2]=(c*E*u-p*l*u+p*s*h-a*E*h-c*s*g+a*l*g)*U,n[3]=(d*l*u-c*_*u-d*s*h+a*_*h+c*s*v-a*l*v)*U,n[4]=A*U,n[5]=(f*E*u-m*_*u+m*s*v-r*E*v-f*s*g+r*_*g)*U,n[6]=(m*l*u-o*E*u-m*s*h+r*E*h+o*s*g-r*l*g)*U,n[7]=(o*_*u-f*l*u+f*s*h-r*_*h-o*s*v+r*l*v)*U,n[8]=b*U,n[9]=(m*d*u-f*p*u-m*a*v+r*p*v+f*a*g-r*d*g)*U,n[10]=(o*p*u-m*c*u+m*a*h-r*p*h-o*a*g+r*c*g)*U,n[11]=(f*c*u-o*d*u-f*a*h+r*d*h+o*a*v-r*c*v)*U,n[12]=S*U,n[13]=(f*p*s-m*d*s+m*a*_-r*p*_-f*a*E+r*d*E)*U,n[14]=(m*c*s-o*p*s-m*a*l+r*p*l+o*a*E-r*c*E)*U,n[15]=(o*d*s-f*c*s+f*a*l-r*d*l-o*a*_+r*c*_)*U,this}},{key:"fromArray",value:function(e,t){t=t||0;for(var n=0;n<16;n++)this.elements[n]=e[n+t];return this}},{key:"clone",value:function(){return(new t).fromArray(this.elements)}}]),t}(function e(){Object(i.a)(this,e),this.needsUpdate=!0});l.EPSILON=1e-6;var h=function(){function e(t,n,r,a){Object(i.a)(this,e),this.isEuler=!0,this._x=t||0,this._y=n||0,this._z=r||0,this._order=a||e.DefaultOrder}return Object(r.a)(e,[{key:"set",value:function(e,t,n,i){return this._x=e,this._y=t,this._z=n,this._order=i||this._order,this}},{key:"onChange",value:function(){}},{key:"x",get:function(){return this._x},set:function(e){this._x=e||0,this.onChange()}},{key:"y",get:function(){return this._y},set:function(e){this._y=e||0,this.onChange()}},{key:"z",get:function(){return this._z},set:function(e){this._z=e||0,this.onChange()}}]),e}();h.DefaultOrder="XYZ";var f=function e(){Object(i.a)(this,e)};f.DEG2RAD=Math.PI/180,f.RAD2DEG=180/Math.PI,f.generateUUID=function(){for(var e=[],t=0;t<256;t++)e[t]=(t<16?"0":"")+t.toString(16);return function(){var t=4294967295*Math.random()|0,n=4294967295*Math.random()|0,i=4294967295*Math.random()|0,r=4294967295*Math.random()|0;return(e[255&t]+e[t>>8&255]+e[t>>16&255]+e[t>>24&255]+"-"+e[255&n]+e[n>>8&255]+"-"+e[n>>16&15|64]+e[n>>24&255]+"-"+e[63&i|128]+e[i>>8&255]+"-"+e[i>>16&255]+e[i>>24&255]+e[255&r]+e[r>>8&255]+e[r>>16&255]+e[r>>24&255]).toUpperCase()}}(),f.clamp=function(e,t,n){return Math.max(t,Math.min(n,e))},f.euclideanModulo=function(e,t){return(e%t+t)%t},f.mapLinear=function(e,t,n,i,r){return i+(e-t)*(r-i)/(n-t)},f.lerp=function(e,t,n){return(1-n)*e+n*t},f.smoothstep=function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t))*e*(3-2*e)},f.smootherstep=function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t))*e*e*(e*(6*e-15)+10)},f.randInt=function(e,t){return e+Math.floor(Math.random()*(t-e+1))},f.randFloat=function(e,t){return e+Math.random()*(t-e)},f.randFloatSpread=function(e){return e*(.5-Math.random())},f.degToRad=function(e){return e*f.DEG2RAD},f.radToDeg=function(e){return e*f.RAD2DEG},f.isPowerOfTwo=function(e){return 0===(e&e-1)&&0!==e},f.ceilPowerOfTwo=function(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))},f.floorPowerOfTwo=function(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))};var d=function(){function e(){Object(i.a)(this,e),this.UUID=f.generateUUID(),this.children=[],this.matrix=new l,this.position=new c,this.rotation=new h,this.quaternion=new o,this.scale=new c(1,1,1),this.initEvent()}return Object(r.a)(e,[{key:"initEvent",value:function(){var e=this;this.position.onChange=function(){e.matrix.needsUpdate=!0},this.rotation.onChange=function(){e.matrix.needsUpdate=!0}}},{key:"add",value:function(e){this.children.push(e)}},{key:"traverse",value:function(e){e(this);for(var t=this.children,n=0,i=t.length;n<i;n++)t[n].traverse(e)}},{key:"updateMatrix",value:function(){this.quaternion.setFromEuler(this.rotation),this.matrix.compose(this.position,this.quaternion,this.scale),this.matrix.needsUpdate=!0}},{key:"lookAt",value:function(e){this.matrix.lookAt(this.position,e,new c(0,1,0))}},{key:"dispose",value:function(){}}]),e}(),_=function(e){function t(){return Object(i.a)(this,t),Object(a.a)(this,Object(s.a)(t).apply(this,arguments))}return Object(u.a)(t,e),t}(d),v=n(51),m=function(e){function t(e,n,r,u){var o;return Object(i.a)(this,t),(o=Object(a.a)(this,Object(s.a)(t).call(this))).fov=e,o.aspect=n,o.near=r,o.far=u,o.zoom=1,o.projectionMatrix=new l,o.matrixInverse=new l,o.updateProjectionMatrix(),o}return Object(u.a)(t,e),Object(r.a)(t,[{key:"lookAt",value:function(e){Object(v.a)(Object(s.a)(t.prototype),"lookAt",this).call(this,e),this.matrixInverse.getInverse(this.matrix),this.matrixInverse.needsUpdate=!0}},{key:"updateProjectionMatrix",value:function(){var e=this.near,t=e*Math.tan(Math.PI/180*.5*this.fov)/this.zoom,n=2*t,i=this.aspect*n,r=-.5*i;this.projectionMatrix.makePerspective(r,r+i,t,t-n,e,this.far),this.projectionMatrix.needsUpdate=!0}}]),t}(d),p=function(){function e(){Object(i.a)(this,e),this.applyToBufferAttribute=function(){var e=new c;return function(t){for(var n=0,i=t.count;n<i;n++)e.x=t.getX(n),e.y=t.getY(n),e.z=t.getZ(n),e.applyMatrix3(this),t.setXYZ(n,e.x,e.y,e.z);return t}}(),this.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1]}return Object(r.a)(e,[{key:"set",value:function(e,t,n,i,r,a,s,u,o){var c=this.elements;return c[0]=e,c[1]=i,c[2]=s,c[3]=t,c[4]=r,c[5]=u,c[6]=n,c[7]=a,c[8]=o,this}},{key:"identity",value:function(){return this.set(1,0,0,0,1,0,0,0,1),this}},{key:"clone",value:function(){return(new this.constructor).fromArray(this.elements)}},{key:"copy",value:function(e){var t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],this}},{key:"setFromMatrix4",value:function(e){var t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}},{key:"multiply",value:function(e){return this.multiplyMatrices(this,e)}},{key:"premultiply",value:function(e){return this.multiplyMatrices(e,this)}},{key:"multiplyMatrices",value:function(e,t){var n=e.elements,i=t.elements,r=this.elements,a=n[0],s=n[3],u=n[6],o=n[1],c=n[4],l=n[7],h=n[2],f=n[5],d=n[8],_=i[0],v=i[3],m=i[6],p=i[1],E=i[4],g=i[7],y=i[2],A=i[5],b=i[8];return r[0]=a*_+s*p+u*y,r[3]=a*v+s*E+u*A,r[6]=a*m+s*g+u*b,r[1]=o*_+c*p+l*y,r[4]=o*v+c*E+l*A,r[7]=o*m+c*g+l*b,r[2]=h*_+f*p+d*y,r[5]=h*v+f*E+d*A,r[8]=h*m+f*g+d*b,this}},{key:"multiplyScalar",value:function(e){var t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}},{key:"determinant",value:function(){var e=this.elements,t=e[0],n=e[1],i=e[2],r=e[3],a=e[4],s=e[5],u=e[6],o=e[7],c=e[8];return t*a*c-t*s*o-n*r*c+n*s*u+i*r*o-i*a*u}},{key:"getInverse",value:function(e,t){e&&e.isMatrix4&&console.error("THREE.Matrix3: .getInverse() no longer takes a Matrix4 argument.");var n=e.elements,i=this.elements,r=n[0],a=n[1],s=n[2],u=n[3],o=n[4],c=n[5],l=n[6],h=n[7],f=n[8],d=f*o-c*h,_=c*l-f*u,v=h*u-o*l,m=r*d+a*_+s*v;if(0===m){var p="THREE.Matrix3: .getInverse() can't invert matrix, determinant is 0";if(!0===t)throw new Error(p);return console.warn(p),this.identity()}var E=1/m;return i[0]=d*E,i[1]=(s*h-f*a)*E,i[2]=(c*a-s*o)*E,i[3]=_*E,i[4]=(f*r-s*l)*E,i[5]=(s*u-c*r)*E,i[6]=v*E,i[7]=(a*l-h*r)*E,i[8]=(o*r-a*u)*E,this}},{key:"transpose",value:function(){var e,t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}},{key:"getNormalMatrix",value:function(e){return this.setFromMatrix4(e).getInverse(this).transpose()}},{key:"transposeIntoArray",value:function(e){var t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}},{key:"setUvTransform",value:function(e,t,n,i,r,a,s){var u=Math.cos(r),o=Math.sin(r);this.set(n*u,n*o,-n*(u*a+o*s)+a+e,-i*o,i*u,-i*(-o*a+u*s)+s+t,0,0,1)}},{key:"scale",value:function(e,t){var n=this.elements;return n[0]*=e,n[3]*=e,n[6]*=e,n[1]*=t,n[4]*=t,n[7]*=t,this}},{key:"rotate",value:function(e){var t=Math.cos(e),n=Math.sin(e),i=this.elements,r=i[0],a=i[3],s=i[6],u=i[1],o=i[4],c=i[7];return i[0]=t*r+n*u,i[3]=t*a+n*o,i[6]=t*s+n*c,i[1]=-n*r+t*u,i[4]=-n*a+t*o,i[7]=-n*s+t*c,this}},{key:"translate",value:function(e,t){var n=this.elements;return n[0]+=e*n[2],n[3]+=e*n[5],n[6]+=e*n[8],n[1]+=t*n[2],n[4]+=t*n[5],n[7]+=t*n[8],this}},{key:"equals",value:function(e){for(var t=this.elements,n=e.elements,i=0;i<9;i++)if(t[i]!==n[i])return!1;return!0}},{key:"fromArray",value:function(e,t){void 0===t&&(t=0);for(var n=0;n<9;n++)this.elements[n]=e[n+t];return this}},{key:"toArray",value:function(e,t){void 0===e&&(e=[]),void 0===t&&(t=0);var n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e}}]),e}(),E=function(e){function t(e,n){var r;return Object(i.a)(this,t),(r=Object(a.a)(this,Object(s.a)(t).call(this))).isMesh=!0,r.geometry=e,r.material=n,r.normalMatrix=new p,r}return Object(u.a)(t,e),Object(r.a)(t,[{key:"updateMatrix",value:function(){Object(v.a)(Object(s.a)(t.prototype),"updateMatrix",this).call(this),this.normalMatrix=(new p).getNormalMatrix(this.matrix)}}]),t}(d),g=function e(t,n){Object(i.a)(this,e),this.needsUpdate=!0,this.offset=t,this.data=n},y=function(){function e(t){var n=t.name,r=t.data,a=t.componentNum;Object(i.a)(this,e),this.name=n,this.data=r,this.componentNum=a,this.needsUpdate=!0,this.attributesSubData=[]}return Object(r.a)(e,[{key:"addSubData",value:function(e){this.attributesSubData.push(e)}},{key:"clearSubData",value:function(){this.subData=null}},{key:"update",value:function(){this.needsUpdate=!1}}]),e}(),A=function(){function e(){Object(i.a)(this,e),this.UUID=f.generateUUID(),this.needsUpdate=!0,this.attributes={},this.indices=null}return Object(r.a)(e,[{key:"addAttribute",value:function(e,t){this.needsUpdate=!0,this.attributes[e]=t}},{key:"setIndex",value:function(e){this.needsUpdate=!0,this.indices=e}}]),e}(),b=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;return Object(i.a)(this,t),(e=Object(a.a)(this,Object(s.a)(t).call(this))).init(n,r,u),e}return Object(u.a)(t,e),Object(r.a)(t,[{key:"init",value:function(e,t,n){this.resetSize(e,t,n);this.addAttribute("normal",new y({name:"normal",data:new Float32Array([0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0]),componentNum:3})),this.addAttribute("uv",new y({name:"uv",data:new Float32Array([0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,1]),componentNum:2})),this.setIndex(new y({name:"indices",data:new Int16Array([0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]),componentNum:1}))}},{key:"resetSize",value:function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:3)/2,t=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:3)/2,n=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:3)/2,i=[-t,-n,e],r=[t,-n,e],a=[t,n,e],s=[-t,n,e],u=[-t,-n,-e],o=[-t,n,-e],c=[t,n,-e],l=[t,-n,-e],h=[].concat(i,r,a,s,u,o,c,l,o,s,a,c,u,l,r,i,l,c,a,r,u,i,s,o);this.addAttribute("position",new y({name:"position",data:new Float32Array(h),componentNum:3}))}}]),t}(A),S=function(e){function t(){var e;return Object(i.a)(this,t),(e=Object(a.a)(this,Object(s.a)(t).call(this))).init(),e}return Object(u.a)(t,e),Object(r.a)(t,[{key:"init",value:function(){this.addAttribute("position",new y({name:"position",data:new Float32Array([-1,-1,0,1,-1,0,0,1,0]),componentNum:3})),this.addAttribute("normal",new y({name:"normal",data:new Float32Array([0,0,1,0,0,1,0,0,1]),componentNum:3})),this.addAttribute("uv",new y({name:"uv",data:new Float32Array([0,0,1,0,.5,1]),componentNum:2})),this.setIndex(new y({name:"indices",data:new Int16Array([0,1,2]),componentNum:1}))}}]),t}(A),T=function(e){function t(){var e;return Object(i.a)(this,t),(e=Object(a.a)(this,Object(s.a)(t).call(this))).init(),e}return Object(u.a)(t,e),Object(r.a)(t,[{key:"init",value:function(){this.addAttribute("position",new y({name:"position",data:new Float32Array([-1,0,1,1,0,1,1,0,-1,-1,0,-1]),componentNum:3})),this.addAttribute("normal",new y({name:"normal",data:new Float32Array([0,1,0,0,1,0,0,1,0,0,1,0]),componentNum:3})),this.addAttribute("uv",new y({name:"uv",data:new Float32Array([0,0,1,0,1,1,0,1]),componentNum:2})),this.setIndex(new y({name:"indices",data:new Int16Array([0,1,2,0,2,3]),componentNum:1}))}}]),t}(A),O=n(54),U={TEXTURE_2D:"texture 2d",TEXTURE_CUBE:"texture cube"},M=function(){function e(){var t=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).image;Object(i.a)(this,e),this.type=U.TEXTURE_2D,this.UUID=f.generateUUID(),this.isTexture=!0,this.image=t,this.needsUpdate=!0,this.wrapS=O.a.REPEAT,this.wrapT=O.a.REPEAT}return Object(r.a)(e,[{key:"load",value:function(e){var t=this;return new Promise(function(n){if(t.image)n(t.image);else{var i=new Image;i.src=e,i.onload=function(){t.needsUpdate=!0,t.image=i,n(t.image)}}})}}]),e}(),k=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(i.a)(this,e),this.UUID=f.generateUUID(),this.type=U.TEXTURE_CUBE,this.image=t.image,this.needsUpdate=!0,this.wrapS=O.a.REPEAT,this.wrapT=O.a.REPEAT},R=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;Object(i.a)(this,e),this.r=t,this.b=n,this.g=r,this.a=a}return Object(r.a)(e,[{key:"toArray",value:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e[t+3]=this.a,e}},{key:"toArray3",value:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}},{key:"setRGB",value:function(e,t,n){return this.r=e,this.g=t,this.b=n,this}},{key:"setRGBA",value:function(e,t,n,i){return this.setRGB(e,t,n),this.a=i,this}},{key:"equals",value:function(e){return e.r===this.r&&e.g===this.g&&e.b===this.b&&e.a===this.a}}]),e}(),C=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(i.a)(this,e),this.type=null,this.map=t.map,this.color=t.color||new R,this.cullFace=void 0!==t.cullFace?t.cullFace:O.a.BACK,this.depthTest=!0,this.depthFunc=O.a.LESS,this.depthMask=!0,this.stencilTest=!1,this.stencilMask=255,this.stencilFunc=O.a.ALWAYS,this.stencilFuncRef=0,this.stencilFuncMask=255,this.Fail=O.a.KEEP,this.ZFail=O.a.KEEP,this.ZPass=O.a.KEEP,this.opacity=1,this.transparent=!1,this.blendSeprate=!1,this.blendSrc=O.a.SRC_ALPHA,this.blendDst=O.a.ONE_MINUS_SRC_ALPHA,this.blendSrcAlpha=O.a.SRC_ALPHA,this.blendDstAlpha=O.a.ONE_MINUS_SRC_ALPHA,this.blendEquation=O.a.FUNC_ADD},L={MESH_BASIC_MATERIAL:"mesh base material",MESH_PHONG_MATERIAL:"mesh phong material",MESH_GRAYSCALE_MATERIAL:"mesh grayscale material",MESH_INVERSION_MATERIAL:"mesh inversion material",MESH_KERNEL_MATERIAL:"mesh kernel material"},x=function(e){function t(e){var n;return Object(i.a)(this,t),(n=Object(a.a)(this,Object(s.a)(t).call(this,e))).type=L.MESH_BASIC_MATERIAL,n}return Object(u.a)(t,e),t}(C),F=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(i.a)(this,t),(e=Object(a.a)(this,Object(s.a)(t).call(this,n))).type=L.MESH_PHONG_MATERIAL,e.shininess=32,e.specularMap=n.specularMap,e.envMap=n.envMap,e.reflect=.5,e}return Object(u.a)(t,e),t}(C),I=function(e){function t(e){var n;return Object(i.a)(this,t),(n=Object(a.a)(this,Object(s.a)(t).call(this,e))).type=L.MESH_INVERSION_MATERIAL,n}return Object(u.a)(t,e),t}(C),w=function(e){function t(e){var n;return Object(i.a)(this,t),(n=Object(a.a)(this,Object(s.a)(t).call(this,e))).type=L.MESH_GRAYSCALE_MATERIAL,n}return Object(u.a)(t,e),t}(C),P=function(e){function t(e){var n;return Object(i.a)(this,t),(n=Object(a.a)(this,Object(s.a)(t).call(this,e))).type=L.MESH_KERNEL_MATERIAL,n.offset=.01,n.kernel=[-1,-1,-1,-1,9,-1,-1,-1,-1],n}return Object(u.a)(t,e),t}(C),j=function(e){function t(){var e;return Object(i.a)(this,t),(e=Object(a.a)(this,Object(s.a)(t).call(this))).needsUpdate=!0,e.isLight=!0,e.color=new R(1,1,1),e.intensity=1,e}return Object(u.a)(t,e),t}(d),N=function(e){function t(){var e;return Object(i.a)(this,t),(e=Object(a.a)(this,Object(s.a)(t).call(this))).isDirectionalLight=!0,e.specular=new R(1,1,1),e.dir=new c(0,-1,0),e}return Object(u.a)(t,e),t}(j),B=function(e){function t(){var e;return Object(i.a)(this,t),(e=Object(a.a)(this,Object(s.a)(t).call(this))).isAmbientLight=!0,e.intensity=.2,e}return Object(u.a)(t,e),t}(j),D=function(e){function t(){var e;return Object(i.a)(this,t),(e=Object(a.a)(this,Object(s.a)(t).call(this))).isPointLight=!0,e.constant=1,e.linear=.09,e.quadratic=.032,e.specular=new R(1,1,1),e}return Object(u.a)(t,e),t}(j),V=function(e){function t(){var e;return Object(i.a)(this,t),(e=Object(a.a)(this,Object(s.a)(t).call(this))).isSpotLight=!0,e.dir=new c(0,-1,0),e.cutOff=Math.cos(Math.PI/180*7.5),e.outerCutOff=Math.cos(Math.PI/180*12),e.constant=1,e.linear=.09,e.quadratic=.032,e.specular=new R(1,1,1),e}return Object(u.a)(t,e),t}(j),z=function(){function e(t,n,r){Object(i.a)(this,e),this.UUID=f.generateUUID(),this.texture=t,this.width=n,this.height=r}return Object(r.a)(e,[{key:"updateSize",value:function(e,t){this.width=e,this.height=t,this.texture.needsUpdate=!0}}]),e}(),G=function(){function e(){Object(i.a)(this,e)}return Object(r.a)(e,null,[{key:"loadMatrixFromCache",value:function(e){var t=e.cache,n=e.uuid,i=e.matrices,r=!1;i.forEach(function(e){r=e.needsUpdate||r});var a=t.getUniform(n);return a&&!r||(a=new l,i.forEach(function(e,t){return a.multiplyMatrices(e,t),t})),a}},{key:"loadTextureFrameBufferCache",value:function(e){var t=e.state,n=e.cache,i=e.uuid,r=e.texture,a=n.getFrameBuffer(i);return a||(a=t.genFramebufferTexture(r),n.setFrameBuffer(i,a)),a}},{key:"loadVAOFromCache",value:function(e){var t=e.state,n=e.cache,i=e.uuid,r=n.getVAO(i);return r||(r=t.createVAO(),n.setVAO(i,r)),r}},{key:"loadAttributeFromCache",value:function(e){var t=e.state,n=e.cache,i=e.uuid,r=e.bufferAttribute,a=e.isIndices,s=r.data,u=r.componentNum,o=r.needsUpdate,c=n.getAttribute(i);c?o&&t.updateAttributeBufferArrayInfo(c,r.data):(c=t.createAttributeBufferArrayInfo(s,u,a),n.setAttribute(i,c));var l=r.attributesSubData;return l.length>0&&l.forEach(function(e){t.updateSubAttributeBufferArrayInfo(c,e.offset,e.data),e.needsUpdate=!1}),r.needsUpdate=!1,c}},{key:"loadProgramInfoFromCache",value:function(e){var t=e.state,n=e.cache,i=e.uuid,r=e.shaderSource,a=n.getProgramInfo(i);return a||(a=t.createProgramInfo(r.vsSource,r.fsSource),n.setProgramInfo(i,a)),a}},{key:"loadTextureFromCache",value:function(e){var t=e.state,n=e.cache,i=e.map,r=e.width,a=void 0===r?void 0:r,s=e.height,u=void 0===s?void 0:s,o=i.UUID,c=i.type===U.TEXTURE_CUBE,l=n.getTexture(o),h=i.needsUpdate;return l||(l=t.genTexture({wrapS:i.wrapS,wrapT:i.wrapT,isCubeTexture:c}),n.setTexture(o,l),h=!0),h&&(t.updateTexture(l,i.image,a,u,0,void 0,c),i.needsUpdate=!1),l}}]),e}(),H=function(){function e(){Object(i.a)(this,e),this.UUID=null,this.fbo=null,this.texture=null}return Object(r.a)(e,[{key:"parse",value:function(e,t,n){if(n){var i=n.texture,r=n.width,a=n.height;this.UUID=n.UUID;var s=this.texture=G.loadTextureFromCache({state:e,cache:t,map:i,width:r,height:a});this.fbo=G.loadTextureFrameBufferCache({state:e,cache:t,uuid:n.UUID,texture:s})}}}]),e}(),X="precision mediump float;\r\n",Y="#ifdef USE_DIFFUSE_MAP\r\nuniform sampler2D diffuse_map;\r\n#elif defined( USE_DIFFUSE_MAP_CUBE )\r\nuniform samplerCube diffuse_map;\r\n#endif\r\n",q="#ifdef USE_SPECULAR_MAP\r\nuniform sampler2D specular_map;\r\n#elif defined( USE_SPECULAR_MAP_CUBE )\r\nuniform samplerCube specular_map;\r\n#endif\r\n",Z="#ifdef NUM_AMB_LIGHT\r\nstruct AmbientLight {\r\n   vec3 ambient;\r\n   float intensity;\r\n};\r\nuniform AmbientLight ambient_lights[NUM_AMB_LIGHT];\r\nvoid calcAmbientLight(out vec3 result_color,vec4 material_diff){\r\n     for(int i=0;i<NUM_AMB_LIGHT;i++){\r\n           AmbientLight light = ambient_lights[i];\r\n           result_color+= light.ambient * light.intensity * material_diff.xyz;\r\n     }\r\n}\r\n#endif\r\n",W="#ifdef NUM_DIR_LIGHT\r\nstruct DirLight {\r\n   vec3 dir;\r\n   vec3 diffuse;\r\n   vec3 specular;\r\n   float intensity;\r\n};\r\nuniform DirLight dir_lights[NUM_DIR_LIGHT];\r\nvoid calcDirLight(out vec3 result_color\r\n                   ,vec3 view_dir\r\n                   ,vec3 v_normal\r\n                   ,vec4 material_diff\r\n                   ,vec4 material_spec\r\n                   ,float material_shininess){\r\n   for(int i=0;i<NUM_DIR_LIGHT;i++){\r\n         DirLight light = dir_lights[i];\r\n         vec3 light_dir = normalize(-light.dir);\r\n         vec3 reflect_dir = reflect(-light_dir, v_normal);\r\n         float diff = max(dot(light_dir,v_normal),0.0);\r\n         float spec = pow(max(dot(view_dir, reflect_dir), 0.0), material_shininess);\r\n         vec3 diffuse  =  diff * light.diffuse * material_diff.xyz;\r\n         vec3 specular =  spec * light.specular * material_spec.xyz;\r\n         result_color += (diffuse + specular) * light.intensity;\r\n     }\r\n}\r\n#endif\r\n",K="#ifdef NUM_POINT_LIGHT\r\nstruct PointLight {\r\n  float constant;\r\n  float linear;\r\n  float quadratic;\r\n  float intensity;\r\n\r\n  vec3 position;\r\n  vec3 diffuse;\r\n  vec3 specular;\r\n};\r\nuniform PointLight point_lights[NUM_POINT_LIGHT];\r\nvoid calcPointLight(out vec3 result_color\r\n                   ,vec3 view_dir\r\n                   ,vec3 v_normal\r\n                   ,vec3 v_position\r\n                   ,vec4 material_diffuse\r\n                   ,vec4 material_specular\r\n                   ,float material_shininess){\r\n   for(int i=0;i<NUM_POINT_LIGHT;i++){\r\n         PointLight light = point_lights[i];\r\n         vec3 pos_to_light = light.position - v_position;\r\n         float distance = length(pos_to_light);\r\n         vec3 light_dir = normalize(pos_to_light);\r\n         float diff = max(dot(v_normal,light_dir),0.0);\r\n         vec3 reflect_dir = reflect(-light_dir, v_normal);\r\n         float spec = pow(max(dot(view_dir, reflect_dir), 0.0), material_shininess);\r\n\r\n         float attenuation = 1.0 / (light.constant + light.linear * distance\r\n         + light.quadratic * (distance * distance));\r\n\r\n         vec3 diffuse  =  diff * light.diffuse * material_diffuse.xyz;\r\n         vec3 specular =  spec * light.specular * material_specular.xyz;\r\n         result_color += (diffuse + specular)* attenuation * light.intensity;\r\n     }\r\n}\r\n#endif\r\n",Q="#ifdef NUM_SPOT_LIGHT\r\nstruct SpotLight {\r\n  float constant;\r\n  float linear;\r\n  float quadratic;\r\n  float intensity;\r\n\r\n  vec3 position;\r\n  vec3 dir;\r\n  float cut_off;\r\n  float outer_cut_off;\r\n  vec3 diffuse;\r\n  vec3 specular;\r\n};\r\nuniform SpotLight spot_lights[NUM_SPOT_LIGHT];\r\nvoid calcSpotLight(out vec3 result_color\r\n                   ,vec3 view_dir\r\n                   ,vec3 v_normal\r\n                   ,vec3 v_position\r\n                   ,vec4 material_diff\r\n                   ,vec4 material_spec\r\n                   ,float material_shininess){\r\n   for(int i=0;i<NUM_SPOT_LIGHT;i++){\r\n         SpotLight light = spot_lights[i];\r\n         vec3 pos_to_light = light.position - v_position;\r\n         float distance = length(pos_to_light);\r\n         vec3 light_dir = normalize(pos_to_light);\r\n         float diff = max(dot(v_normal,light_dir),0.0);\r\n         vec3 reflect_dir = reflect(-light_dir, v_normal);\r\n         float spec = pow(max(dot(view_dir, reflect_dir), 0.0), material_shininess);\r\n\r\n         float attenuation = 1.0 / (light.constant + light.linear * distance\r\n         + light.quadratic * (distance * distance));\r\n\r\n         //diff point light\r\n         float theta = dot(light_dir, normalize(-light.dir));\r\n         float epsilon = light.cut_off - light.outer_cut_off;\r\n         float intensity = clamp((theta - light.outer_cut_off) / epsilon, 0.0, 1.0);\r\n         //\r\n\r\n         vec3 diffuse  =  diff * light.diffuse * material_diff.xyz;\r\n         vec3 specular =  spec * light.specular * material_spec.xyz;\r\n         result_color += (diffuse + specular)* attenuation * intensity * light.intensity;\r\n     }\r\n}\r\n#endif\r\n",J="void calcAllLight(\r\n        out vec3 result_color\r\n        ,vec3 view_dir\r\n        ,vec3 v_normal\r\n        ,vec3 v_position\r\n        ,vec4 material_diffuse\r\n        ,vec4 material_specular\r\n        ,float material_shininess){\r\n\r\n        #ifdef NUM_AMB_LIGHT\r\n        calcAmbientLight(result_color,material_diffuse);\r\n        #endif\r\n\r\n        #ifdef NUM_DIR_LIGHT\r\n        calcDirLight(result_color,view_dir,v_normal,material_diffuse,material_specular,material_shininess);\r\n        #endif\r\n\r\n        #ifdef NUM_POINT_LIGHT\r\n        calcPointLight(result_color,view_dir,v_normal,v_position,material_diffuse,material_specular,material_shininess);\r\n        #endif\r\n\r\n        #ifdef NUM_SPOT_LIGHT\r\n        calcSpotLight(result_color,view_dir,v_normal,v_position,material_diffuse,material_specular,material_shininess);\r\n        #endif\r\n}\r\n",$="precision mediump float;\r\n\r\nuniform mat4 u_modelViewMatrix;\r\nuniform mat4 u_projectionMatrix;\r\n\r\nattribute vec3 a_position;\r\nattribute vec2 a_uv;\r\n\r\nvarying vec2 v_uv;\r\nvarying vec3 v_position;\r\n\r\nvoid main(void) {\r\n  v_uv = a_uv;\r\n  v_position = a_position;\r\n  gl_Position = u_projectionMatrix * u_modelViewMatrix * vec4(a_position,1.0);\r\n}\r\n",ee="uniform mat4 u_modelViewMatrix;\r\nuniform mat4 u_projectionMatrix;\r\nuniform mat3 u_normalMatrix;\r\n\r\nattribute vec3 a_position;\r\nattribute vec3 a_normal;\r\nattribute vec2 a_uv;\r\n\r\nvarying vec3  v_position;\r\nvarying vec3  v_normal;\r\nvarying vec2  v_uv;\r\n\r\nvoid main(){\r\n     vec4 view_position = u_modelViewMatrix * vec4(a_position, 1.0);\r\n     v_uv = a_uv;\r\n     v_normal = u_normalMatrix * a_normal;\r\n     v_position = vec3(view_position);\r\n     gl_Position = u_projectionMatrix * view_position;\r\n}\r\n\r\n",te={common:{precision:X,diffuse_map:Y,specular_map:q,ambient_light:Z,dir_light:W,point_light:K,spot_light:Q,all_light:J},base:{vsSource:$,fsSource:X+Y+"\r\nvarying vec3 v_position;\r\nvarying vec2 v_uv;\r\n\r\nuniform vec4 material_color;\r\n\r\nvoid main(void) {\r\n\r\n    vec4 diffuse = material_color;\r\n    #ifdef USE_DIFFUSE_MAP\r\n    diffuse *= texture2D(diffuse_map,v_uv);\r\n    #elif defined( USE_DIFFUSE_MAP_CUBE )\r\n    diffuse *= textureCube(diffuse_map,v_position);\r\n    #endif\r\n\r\n    gl_FragColor = diffuse;\r\n}\r\n"},phong:{vsSource:ee,fsSource:X+Y+q+"#ifdef USE_ENV_MAP_CUBE\r\nuniform samplerCube env_map;\r\n#endif\r\n\r\n\r\n"+Z+W+K+Q+J+"uniform vec3 u_cameraPosition;\r\nvarying vec3 v_position;\r\nvarying vec2 v_uv;\r\nvarying vec3 v_normal;\r\n\r\nuniform vec4 material_color;\r\nuniform float material_shininess;\r\nuniform float material_reflect;\r\n\r\nvoid main(){\r\n    vec3 view_dir = normalize(u_cameraPosition - v_position);\r\n\r\n    vec4 diffuse = material_color;\r\n    #ifdef USE_DIFFUSE_MAP\r\n    diffuse *= texture2D(diffuse_map,v_uv);\r\n    #elif defined( USE_DIFFUSE_MAP_CUBE )\r\n    diffuse *= textureCube(diffuse_map,v_position);\r\n    #endif\r\n\r\n    vec4 specular = vec4(1.0);\r\n    #ifdef USE_SPECULAR_MAP\r\n    specular = texture2D(specular_map,v_uv);\r\n    #elif defined( USE_SPECULAR_MAP_CUBE )\r\n    specular = textureCube(specular_map,v_position);\r\n    #endif\r\n\r\n    #ifdef USE_ENV_MAP_CUBE\r\n    vec3 R = reflect(-view_dir, v_normal);\r\n    vec4 env = textureCube(env_map,R);\r\n    diffuse = diffuse * (1. - env.a * material_reflect) + env * material_reflect;\r\n    #endif\r\n\r\n    vec3 result_color = vec3(0.0);\r\n    calcAllLight(result_color,view_dir,v_normal,v_position,diffuse,specular,material_shininess);\r\n\r\n    gl_FragColor = vec4(result_color,diffuse.a);\r\n}\r\n"},inversion:{vsSource:$,fsSource:X+Y+"\r\nvarying vec2 v_uv;\r\nuniform vec4 material_color;\r\n\r\nvoid main(){\r\n  vec4 diffuse = material_color;\r\n  #ifdef USE_DIFFUSE_MAP\r\n  diffuse *= texture2D(diffuse_map,v_uv);\r\n  #elif defined( USE_DIFFUSE_MAP_CUBE )\r\n  diffuse *= textureCube(diffuse_map,v_position);\r\n  #endif\r\n\r\n  gl_FragColor = vec4(1.0-diffuse.xyz,diffuse.a);\r\n}\r\n"},grayscale:{vsSource:$,fsSource:X+Y+"precision mediump float;\r\nvarying vec2 v_uv;\r\nuniform vec4 material_color;\r\n\r\nvoid main(){\r\n  vec4 diffuse = material_color;\r\n  #ifdef USE_DIFFUSE_MAP\r\n  diffuse *= texture2D(diffuse_map,v_uv);\r\n  #elif defined( USE_DIFFUSE_MAP_CUBE )\r\n  diffuse *= textureCube(diffuse_map,v_position);\r\n  #endif\r\n\r\n  float average =  0.2126 * diffuse.r + 0.7152 * diffuse.g + 0.0722 * diffuse.b;\r\n  gl_FragColor = vec4(vec3(average),diffuse.a);\r\n}\r\n\r\n"},kernel:{vsSource:ee,fsSource:X+Y+"varying vec2 v_uv;\r\n\r\nuniform vec4 material_color;\r\nuniform float kernel[9];\r\nuniform float offset;\r\nvec2 offsets[9];\r\nvec3 sampleTex[9];\r\n\r\nvoid main()\r\n{\r\n    offsets[0] = vec2(-offset,  offset);\r\n    offsets[1] = vec2(      0.0,  offset);\r\n    offsets[2] = vec2( offset,  offset);\r\n    offsets[3] = vec2(-offset,      0.0);\r\n    offsets[4] = vec2(      0.0,      0.0);\r\n    offsets[5] = vec2( offset,       0.0);\r\n    offsets[6] = vec2(-offset, -offset);\r\n    offsets[7] = vec2(     0.0,  -offset);\r\n    offsets[8] = vec2( offset,  -offset);\r\n\r\n    for(int i = 0; i < 9; i++)\r\n    {\r\n        #ifdef USE_DIFFUSE_MAP\r\n        sampleTex[i] = texture2D(diffuse_map, v_uv + offsets[i]).xyz;\r\n        #elif defined( USE_DIFFUSE_MAP_CUBE )\r\n        sampleTex[i] = textureCube(diffuse_map,v_position  + vec3(offsets[i],0.0)).xyz;\r\n        #endif\r\n    }\r\n\r\n    vec3 col = vec3(0.0);\r\n    for(int i = 0; i < 9; i++)\r\n        col += sampleTex[i] * kernel[i];\r\n    gl_FragColor = vec4(col, 1.0) * material_color;\r\n}\r\n\r\n"}},ne={USE_DIFFUSE_MAP:"#define USE_DIFFUSE_MAP\n",USE_DIFFUSE_MAP_CUBE:"#define USE_DIFFUSE_MAP_CUBE\n",USE_SPECULAR_MAP:"#define USE_SPECULAR_MAP\n",USE_SPECULAR_MAP_CUBE:"#define USE_SPECULAR_MAP_CUBE\n",USE_ENV_MAP_CUBE:"#define USE_ENV_MAP_CUBE\n"},ie=new(function(){function e(){Object(i.a)(this,e),this.source=null}return Object(r.a)(e,[{key:"parseLight",value:function(e){var t=e.dirLightNum,n=e.ambientLightNum,i=e.pointLightNum,r=e.spotLightNum,a=this.source;t>0&&(a.phongFS="#define NUM_DIR_LIGHT "+t+"\n"+a.phongFS),n>0&&(a.phongFS="#define NUM_AMB_LIGHT "+n+"\n"+a.phongFS),i>0&&(a.phongFS="#define NUM_POINT_LIGHT "+i+"\n"+a.phongFS),r>0&&(a.phongFS="#define NUM_SPOT_LIGHT "+r+"\n"+a.phongFS)}},{key:"parseMaterial",value:function(e){var t=e.type,n=this.source,i="",r="",a=e.map?e.map.type:"",s=e.specularMap?e.specularMap.type:"",u=e.envMap?e.envMap.type:"",o=t+a+s+u;switch(a===U.TEXTURE_2D?r+=ne.USE_DIFFUSE_MAP:a===U.TEXTURE_CUBE&&(r+=ne.USE_DIFFUSE_MAP_CUBE),s===U.TEXTURE_2D?r+=ne.USE_SPECULAR_MAP:s===U.TEXTURE_CUBE&&(r+=ne.USE_SPECULAR_MAP_CUBE),s===U.TEXTURE_2D?r+=ne.USE_SPECULAR_MAP:s===U.TEXTURE_CUBE&&(r+=ne.USE_SPECULAR_MAP_CUBE),u===U.TEXTURE_CUBE&&(r+=ne.USE_ENV_MAP_CUBE),t){case L.MESH_BASIC_MATERIAL:i+=n.baseVS,r+=n.baseFS;break;case L.MESH_PHONG_MATERIAL:i+=n.phongVS,r+=n.phongFS;break;case L.MESH_INVERSION_MATERIAL:i+=n.inversionVS,r+=n.inversionFS;break;case L.MESH_GRAYSCALE_MATERIAL:i+=n.grayscaleVS,r+=n.grayscaleFS;break;case L.MESH_KERNEL_MATERIAL:i+=n.kernelVS,r+=n.kernelFS}return{id:o,vsSource:i,fsSource:r}}},{key:"reset",value:function(){this.source={baseVS:te.base.vsSource,baseFS:te.base.fsSource,phongVS:te.phong.vsSource,phongFS:te.phong.fsSource,inversionVS:te.inversion.vsSource,inversionFS:te.inversion.fsSource,grayscaleVS:te.grayscale.vsSource,grayscaleFS:te.grayscale.fsSource,kernelVS:te.kernel.vsSource,kernelFS:te.kernel.fsSource}}}]),e}()),re=function(){function e(){Object(i.a)(this,e),this.uniforms={}}return Object(r.a)(e,[{key:"parse",value:function(e){var t=new l;t.multiplyMatrices(e.projectionMatrix,e.matrixInverse),this.uniforms={u_projectionMatrix:t.elements,u_cameraPosition:e.position.toArray()}}}]),e}(),ae=function(){function e(){Object(i.a)(this,e),this.uniforms={}}return Object(r.a)(e,[{key:"parse",value:function(e){var t={};e.forEach(function(e,n){var i="ambient_lights["+n+"]";t[i+".ambient"]=e.color.toArray3(),t[i+".intensity"]=e.intensity}),this.uniforms=t}}]),e}(),se=function(){function e(){Object(i.a)(this,e),this.uniforms={}}return Object(r.a)(e,[{key:"parse",value:function(e){var t={};e.forEach(function(e,n){var i=e.intensity,r="dir_lights["+n+"]";t[r+".diffuse"]=e.color.toArray3(),t[r+".specular"]=e.specular.toArray3(),t[r+".dir"]=e.dir.toArray(),t[r+".intensity"]=i}),this.uniforms=t}}]),e}(),ue=function(){function e(){Object(i.a)(this,e),this.uniforms={}}return Object(r.a)(e,[{key:"parse",value:function(e){var t={};e.forEach(function(e,n){var i="spot_lights["+n+"]";t[i+".diffuse"]=e.color.toArray3(),t[i+".specular"]=e.specular.toArray3(),t[i+".position"]=e.position.toArray(),t[i+".dir"]=e.dir.toArray(),t[i+".cut_off"]=e.cutOff,t[i+".outer_cut_off"]=e.outerCutOff,t[i+".intensity"]=e.intensity,t[i+".constant"]=e.constant,t[i+".linear"]=e.linear,t[i+".quadratic"]=e.quadratic}),this.uniforms=t}}]),e}(),oe=function(){function e(){Object(i.a)(this,e),this.uniforms={}}return Object(r.a)(e,[{key:"parse",value:function(e){var t={};e.forEach(function(e,n){var i="point_lights["+n+"]";t[i+".diffuse"]=e.color.toArray3(),t[i+".specular"]=e.specular.toArray3(),t[i+".position"]=e.position.toArray(),t[i+".intensity"]=e.intensity,t[i+".constant"]=e.constant,t[i+".linear"]=e.linear,t[i+".quadratic"]=e.quadratic}),this.uniforms=t}}]),e}(),ce=function(){function e(){Object(i.a)(this,e),this.uniforms={}}return Object(r.a)(e,[{key:"parse",value:function(e,t){this.uniforms={u_modelViewMatrix:t.matrix.elements,u_normalMatrix:t.normalMatrix.elements}}}]),e}(),le=function(){function e(){Object(i.a)(this,e),this.programInfo=null,this.uniforms={},this.capabilities={}}return Object(r.a)(e,[{key:"parse",value:function(e,t,n,i){var r,a=n.map,s=n.specularMap,u=n.envMap,o={},c=n,l=i.parseMaterial(n);r=G.loadProgramInfoFromCache({state:e,cache:t,uuid:l.id,shaderSource:l}),a&&(o.diffuse_map=G.loadTextureFromCache({state:e,cache:t,map:a})),s&&(o.specular_map=G.loadTextureFromCache({state:e,cache:t,map:s})),u&&(o.env_map=G.loadTextureFromCache({state:e,cache:t,map:u}));var h=n.color.toArray3();h.push(n.color.a*n.opacity),o.material_color=h,n.type===L.MESH_KERNEL_MATERIAL&&(o.kernel=n.kernel,o.offset=n.offset),n.type===L.MESH_PHONG_MATERIAL&&(o.material_shininess=n.shininess,o.material_reflect=n.reflect),this.programInfo=r,this.uniforms=o,this.capabilities=c}}]),e}(),he=function(){function e(){Object(i.a)(this,e),this.attributes={},this.indices=null,this.VAO=null,this.needsUpdateVAO=null,this.drawSize=0}return Object(r.a)(e,[{key:"parse",value:function(e,t,n,i){var r=n.UUID+i,a=n.attributes,s=n.indices;if(this.needsUpdateVAO=!Boolean(t.getVAO(r)),this.VAO=G.loadVAOFromCache({state:e,cache:t,uuid:r}),this.drawSize=s.data.length,this.needsUpdateVAO||n.needsUpdate){for(var u in n.needsUpdate=!1,this.attributes={},a){var o=a[u],c="a_"+o.name;this.attributes[c]=G.loadAttributeFromCache({state:e,cache:t,uuid:r+c,bufferAttribute:o,isIndices:!1})}this.indices=G.loadAttributeFromCache({state:e,cache:t,uuid:r+"indices",data:s.data,bufferAttribute:s,isIndices:!0})}}}]),e}(),fe=function(){function e(){Object(i.a)(this,e),this.programInfo=null,this.uniforms=null,this.attributes=null,this.indices=null,this.drawSize=0,this.capabilities=null,this.depth=0}return Object(r.a)(e,[{key:"setUp",value:function(e){var t=e.programInfo,n=e.uniforms,i=e.attributes,r=e.indices,a=e.drawSize,s=e.VAO,u=e.needsUpdateVAO,o=e.capabilities;this.programInfo=t,this.uniforms=n,this.attributes=i,this.indices=r,this.drawSize=a,this.VAO=s,this.needsUpdateVAO=u,this.capabilities=o}},{key:"mergeUniforms",value:function(){return Object.assign.apply(Object,[this.uniforms].concat(Array.prototype.slice.call(arguments)))}},{key:"needSort",value:function(){return this.capabilities.transparent}},{key:"reCalcDepth",value:function(){var e=this.uniforms;e.u_projectionMatrix&&e.u_modelViewMatrix||console.warn("Can't be sorted because there is no u_projectionMatrix||u_modelViewMatrix");var t=new l,n=new l,i=new c;t.elements=this.uniforms.u_projectionMatrix,n.elements=this.uniforms.u_modelViewMatrix,this.depth=i.setFromMatrixPosition(n).applyMatrix4(t).z}}]),e}(),de=function(){function e(){Object(i.a)(this,e)}return Object(r.a)(e,null,[{key:"createRenderTargetGL",value:function(){return new H}},{key:"createShaderStoreGL",value:function(){return ie.reset(),ie}},{key:"createCameraGL",value:function(){return new re}},{key:"createAmbientLightGL",value:function(){return new ae}},{key:"createDirectionalLightGL",value:function(){return new se}},{key:"createSpotLightGL",value:function(){return new ue}},{key:"createPointLightGL",value:function(){return new oe}},{key:"createMaterialGL",value:function(){return new le}},{key:"createGeometryGL",value:function(){return new he}},{key:"createMeshGL",value:function(){return new ce}},{key:"createWaitToDrawObject",value:function(){return new fe}}]),e}(),_e=function(){function e(t,n){Object(i.a)(this,e),this.state=t,this.cache=n,this.autoClear=!0,this.curRenderTarget=null,this.meshes=[],this.ambientLights=[],this.dirLights=[],this.spotLights=[],this.pointLights=[]}return Object(r.a)(e,[{key:"sortScene",value:function(e){var t=this;this.dirLights=[],this.ambientLights=[],this.pointLights=[],this.spotLights=[],this.meshes=[],e.traverse(function(e){e.isDirectionalLight&&t.dirLights.push(e),e.isAmbientLight&&t.ambientLights.push(e),e.isPointLight&&t.pointLights.push(e),e.isSpotLight&&t.spotLights.push(e),e.isMesh&&t.meshes.push(e)})}},{key:"render",value:function(e,t,n){var i=this.state,r=this.cache;this.sortScene(e);var a=de.createRenderTargetGL(),s=de.createShaderStoreGL(),u=de.createCameraGL(),o=de.createAmbientLightGL(),c=de.createDirectionalLightGL(),l=de.createSpotLightGL(),h=de.createPointLightGL();s.parseLight({dirLightNum:this.dirLights.length,ambientLightNum:this.ambientLights.length,pointLightNum:this.pointLights.length,spotLightNum:this.spotLights.length}),a.parse(i,r,n),u.parse(t),c.parse(this.dirLights),o.parse(this.ambientLights),h.parse(this.pointLights),l.parse(this.spotLights);var f=[],d=[];this.meshes.forEach(function(e){var t=de.createMeshGL(),n=de.createMaterialGL(),a=de.createGeometryGL();t.parse(r,e),n.parse(i,r,e.material,s),a.parse(i,r,e.geometry,e.material.type);var _=de.createWaitToDrawObject();_.setUp({programInfo:n.programInfo,uniforms:{},attributes:a.attributes,indices:a.indices,drawSize:a.drawSize,VAO:a.VAO,needsUpdateVAO:a.needsUpdateVAO,capabilities:n.capabilities}),_.mergeUniforms(t.uniforms,n.uniforms,u.uniforms,c.uniforms,o.uniforms,h.uniforms,l.uniforms),_.needSort()?(_.reCalcDepth(),d.push(_)):f.push(_)}),d.sort(function(e,t){return t.depth-e.depth});var _=f.concat(d);this.curRenderTarget!==n&&(this.curRenderTarget=n,i.bindFrameBuffer(a.fbo)),this.autoClear&&this.clear(),_.forEach(function(e){var t=e.programInfo,n=t.program,r=e.uniforms,a=e.attributes,s=e.indices,u=e.drawSize,o=e.VAO,c=e.needsUpdateVAO,l=e.capabilities,h=l.depthTest,f=l.stencilTest,d=l.transparent,_=l.cullFace;i.useProgram(n),i.setUniforms(t,r),c?i.bindVAOAndSetAttributes(t,a,s,o):i.bindVAO(o);var v=i.capabilities.depthBuffer,m=i.capabilities.stencilBuffer,p=i.capabilities.blending,E=i.capabilities.CullFace;v.setTest(h),m.setTest(f),p.setBlend(d),E.setCullType(_),h&&(v.setMask(l.depthMask),v.setFunc(l.depthFunc)),f&&(m.setMask(l.stencilMask),m.setFunc(l.stencilFunc,l.stencilFuncRef,l.stencilFuncMask),m.setOp(l.Fail,l.ZFail,l.ZPass)),d&&(l.blendSeprate?p.setBlendFuncSeparate(l.blendSrc,l.blendDst,l.blendSrcAlpha,l.blendDstAlpha):p.setBlendFunc(l.blendSrc,l.blendDst),l.blendEquation&&p.setBlendEquation(l.blendEquation)),i.drawElements(u)}),i.bindVAO(null)}},{key:"setClearColor",value:function(e,t,n,i){this.state.setClearColor(e,t,n,i)}},{key:"setClearDepth",value:function(e){this.state.setClearDepth(e)}},{key:"setClearStencil",value:function(e){this.state.setClearStencil(e)}},{key:"clear",value:function(){this.state.clear()}},{key:"getState",value:function(){return this.state}},{key:"dispose",value:function(){this.state.disposeContext()}},{key:"viewport",value:function(e,t,n,i){this.state.viewport(e,t,n,i)}}]),e}();function ve(e,t){if(null==e)return{};var n,i,r=function(e,t){if(null==e)return{};var n,i,r={},a=Object.keys(e);for(i=0;i<a.length;i++)n=a[i],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(i=0;i<a.length;i++)n=a[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var me=function(){function e(t){Object(i.a)(this,e),this.gl=t,this.extensions={}}return Object(r.a)(e,[{key:"get",value:function(e){return this.extensions[e]?this.extensions[e]:this.gl.getExtension(e)}}]),e}();me.OES_VERTEX_ARRAY_OBJECT="OES_vertex_array_object";var pe=function(){function e(t,n,r){Object(i.a)(this,e),this._gl=t,this.extensions=n,this.capabilities=r,this.textureUnit=0}return Object(r.a)(e,null,[{key:"createContext",value:function(e){var t=e.canvas,n=ve(e,["canvas"]),i={};i.alpha=void 0!==n.alpha&&n.alpha,i.depth=void 0===n.depth||n.depth,i.stencil=void 0===n.stencil||n.stencil,i.antialias=void 0===n.antialias||n.antialias,i.premultipliedAlpha=void 0===n.premultipliedAlpha||n.premultipliedAlpha,i.preserveDrawingBuffer=void 0!==n.preserveDrawingBuffer&&n.preserveDrawingBuffer,i.powerPreference=void 0!==n.powerPreference?n.powerPreference:"default";var r=t.getContext("webgl",i);return r||alert("Unable to initialize WebGL. Your browser or machine may not support it."),r}}]),Object(r.a)(e,[{key:"loaderShader",value:function(e,t){var n=this._gl,i=n.createShader(e);return n.shaderSource(i,t),n.compileShader(i),n.getShaderParameter(i,n.COMPILE_STATUS)?i:(alert("An error occurred compiling the shaders: "+n.getShaderInfoLog(i)),n.deleteShader(i),null)}},{key:"getBindPointForSamplerType",value:function(e){var t=this._gl;return e===t.SAMPLER_2D?t.TEXTURE_2D:e===t.SAMPLER_CUBE?t.TEXTURE_CUBE_MAP:void 0}},{key:"createUniformsSetter",value:function(e){var t=this;this.textureUnit=0;for(var n=function(n,i){var r,a=n.getUniformLocation(e,i.name),s=i.type,u=i.size>1&&"[0]"===i.name.substr(-3);if(s===n.FLOAT&&u)return function(e){n.uniform1fv(a,e)};if(s===n.FLOAT)return function(e){n.uniform1f(a,e)};if(s===n.FLOAT_VEC2)return function(e){n.uniform2fv(a,e)};if(s===n.FLOAT_VEC3)return function(e){n.uniform3fv(a,e)};if(s===n.FLOAT_VEC4)return function(e){n.uniform4fv(a,e)};if(s===n.INT&&u)return function(e){n.uniform1iv(a,e)};if(s===n.INT)return function(e){n.uniform1i(a,e)};if(s===n.INT_VEC2)return function(e){n.uniform2iv(a,e)};if(s===n.INT_VEC3)return function(e){n.uniform3iv(a,e)};if(s===n.INT_VEC4)return function(e){n.uniform4iv(a,e)};if(s===n.BOOL)return function(e){n.uniform1iv(a,e)};if(s===n.BOOL_VEC2)return function(e){n.uniform2iv(a,e)};if(s===n.BOOL_VEC3)return function(e){n.uniform3iv(a,e)};if(s===n.BOOL_VEC4)return function(e){n.uniform4iv(a,e)};if(s===n.FLOAT_MAT2)return function(e){n.uniformMatrix2fv(a,!1,e)};if(s===n.FLOAT_MAT3)return function(e){n.uniformMatrix3fv(a,!1,e)};if(s===n.FLOAT_MAT4)return function(e){n.uniformMatrix4fv(a,!1,e)};if((s===n.SAMPLER_2D||s===n.SAMPLER_CUBE)&&u){for(var o=[],c=t.getBindPointForSamplerType(s),l=0;l<i.size;++l)o.push(++t.textureUnit);return function(e){return function(t){n.uniform1iv(a,e),t.forEach(function(t,i){n.activeTexture(n.TEXTURE0+e[i]),n.bindTexture(c,t)})}}(o)}if(s===n.SAMPLER_2D||s===n.SAMPLER_CUBE){var h=t.getBindPointForSamplerType(s);return r=++t.textureUnit,function(e){n.uniform1i(a,r),n.activeTexture(n.TEXTURE0+r),n.bindTexture(h,e)}}console.error("unknown type: 0x"+s.toString(16))},i=this._gl,r={},a=i.getProgramParameter(e,i.ACTIVE_UNIFORMS),s=0;s<a;++s){var u=i.getActiveUniform(e,s);if(!u)break;var o=u.name;"[0]"===o.substr(-3)&&(o=o.substr(0,o.length-3)),r[o]=n(i,u)}return r}},{key:"createAttributeSetters",value:function(e){function t(e,t){return function(n){e.bindBuffer(e.ARRAY_BUFFER,n.buffer),e.enableVertexAttribArray(t),e.vertexAttribPointer(t,n.numComponents||n.size,n.type||e.FLOAT,n.normalize||!1,n.stride||0,n.offset||0)}}for(var n=this._gl,i={},r=n.getProgramParameter(e,n.ACTIVE_ATTRIBUTES),a=0;a<r;++a){var s=n.getActiveAttrib(e,a);if(!s)break;var u=n.getAttribLocation(e,s.name);i[s.name]=t(n,u)}return i}},{key:"createProgram",value:function(e,t){var n=this._gl,i=this.loaderShader(n.VERTEX_SHADER,e),r=this.loaderShader(n.FRAGMENT_SHADER,t),a=n.createProgram();return n.attachShader(a,i),n.attachShader(a,r),n.linkProgram(a),n.getProgramParameter(a,n.LINK_STATUS)?(this.deleteShader(i),this.deleteShader(r),a):(n.deleteProgram(a),console.error("Unable to initialize the shader program: "+n.getProgramInfoLog(a)),null)}},{key:"useProgram",value:function(e){this._gl.useProgram(e)}},{key:"createProgramInfo",value:function(e,t){var n=this.createProgram(e,t);return{program:n,uniformSetters:this.createUniformsSetter(n),attribSetters:this.createAttributeSetters(n)}}},{key:"getGLTypeForTypedArray",value:function(e){var t=this._gl;return e instanceof Int8Array?t.BYTE:e instanceof Uint8Array?t.UNSIGNED_BYTE:e instanceof Int16Array?t.SHORT:e instanceof Uint16Array?t.UNSIGNED_SHORT:e instanceof Int32Array?t.INT:e instanceof Uint32Array?t.UNSIGNED_INT:e instanceof Float32Array?t.FLOAT:void console.error("unsupported typed array type")}},{key:"createBufferFromTypedArray",value:function(e,t,n){var i=this._gl;t=t||i.ARRAY_BUFFER;var r=i.createBuffer();return i.bindBuffer(t,r),i.bufferData(t,e,n||i.STATIC_DRAW),r}},{key:"updateBufferFromTypedArray",value:function(e,t,n,i){var r=this._gl;return n=n||r.ARRAY_BUFFER,r.bindBuffer(n,e),r.bufferData(n,t,i||r.STATIC_DRAW),e}},{key:"createVAO",value:function(){return this.extensions.get(me.OES_VERTEX_ARRAY_OBJECT).createVertexArrayOES()}},{key:"createAttributeBufferArrayInfo",value:function(e,t,n){var i=this._gl,r=n?i.ELEMENT_ARRAY_BUFFER:i.ARRAY_BUFFER,a=e.length;return{buffer:this.createBufferFromTypedArray(e,r),numComponents:t,size:a,isIndices:n,type:this.getGLTypeForTypedArray(e)}}},{key:"updateAttributeBufferArrayInfo",value:function(e,t){var n=this._gl,i=e.isIndices?n.ELEMENT_ARRAY_BUFFER:n.ARRAY_BUFFER;return this.updateBufferFromTypedArray(e.buffer,t,i),e.size=t.length,e}},{key:"updateSubAttributeBufferArrayInfo",value:function(e,t,n){var i=this._gl,r=e.isIndices?i.ELEMENT_ARRAY_BUFFER:i.ARRAY_BUFFER;i.bindBuffer(r,e.buffer),i.bufferSubData(r,t,n)}},{key:"bindVAO",value:function(e){this.extensions.get(me.OES_VERTEX_ARRAY_OBJECT).bindVertexArrayOES(e)}},{key:"setAttributes",value:function(e,t){e=e.attribSetters||e,Object.keys(t).forEach(function(n){var i=e[n];i&&i(t[n])})}},{key:"setBuffersAndAttributes",value:function(e,t){var n=this._gl;this.setAttributes(e,t.attributes),t.indices&&n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,t.indices.buffer)}},{key:"bindVAOAndSetAttributes",value:function(e,t,n,i){var r=this._gl;this.extensions.get(me.OES_VERTEX_ARRAY_OBJECT).bindVertexArrayOES(i),this.setAttributes(e,t),n&&r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,n.buffer)}},{key:"setUniforms",value:function(e,t){e=e.uniformSetters||e,Object.keys(t).forEach(function(n){var i=e[n];i&&i(t[n])})}},{key:"genTexture",value:function(e){var t=e.wrapS,n=e.wrapT,i=e.isCubeTexture,r=void 0!==i&&i,a=this._gl,s=r?a.TEXTURE_CUBE_MAP:a.TEXTURE_2D,u=a.createTexture(),o=a[t],c=a[n],l=a.NEAREST,h=a.NEAREST;return a.bindTexture(s,u),a.texParameteri(s,a.TEXTURE_WRAP_S,o),a.texParameteri(s,a.TEXTURE_WRAP_T,c),a.texParameteri(s,a.TEXTURE_MIN_FILTER,l),a.texParameteri(s,a.TEXTURE_MAG_FILTER,h),u}},{key:"updateTexture",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,a=arguments.length>5?arguments[5]:void 0,s=arguments.length>6&&void 0!==arguments[6]&&arguments[6],u=this._gl,o=a||u.RGBA,c=a||u.RGBA,l=u.UNSIGNED_BYTE,h=t||null;s&&!t||(s?h instanceof Array&&(u.texImage2D(u.TEXTURE_CUBE_MAP_POSITIVE_X,0,o,c,l,h[3]),u.texImage2D(u.TEXTURE_CUBE_MAP_NEGATIVE_X,0,o,c,l,h[2]),u.texImage2D(u.TEXTURE_CUBE_MAP_POSITIVE_Y,0,o,c,l,h[0]),u.texImage2D(u.TEXTURE_CUBE_MAP_NEGATIVE_Y,0,o,c,l,h[1]),u.texImage2D(u.TEXTURE_CUBE_MAP_POSITIVE_Z,0,o,c,l,h[4]),u.texImage2D(u.TEXTURE_CUBE_MAP_NEGATIVE_Z,0,o,c,l,h[5])):(u.bindTexture(u.TEXTURE_2D,e),h?u.texImage2D(u.TEXTURE_2D,0,o,c,l,h):u.texImage2D(u.TEXTURE_2D,0,o,n,i,r,c,l,h)))}},{key:"bindFrameBuffer",value:function(e){this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,e)}},{key:"genFramebufferTexture",value:function(e){var t=this._gl,n=t.createFramebuffer();return t.bindFramebuffer(t.FRAMEBUFFER,n),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,e,0),n}},{key:"genRenderBuffer",value:function(e,t){var n=this._gl,i=n.createRenderbuffer();return n.bindRenderbuffer(n.RENDERBUFFER,i),n.renderbufferStorage(n.RENDERBUFFER,n.RGBA4,e,t),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.RENDERBUFFER,i),i}},{key:"disable",value:function(e){this._gl.disable(e)}},{key:"enable",value:function(e){this._gl.enable(e)}},{key:"viewport",value:function(e,t,n,i){this._gl.viewport(e,t,n,i)}},{key:"setClearColor",value:function(e,t,n,i){this._gl.clearColor(e,t,n,i)}},{key:"setClearDepth",value:function(e){this._gl.clearDepth(e)}},{key:"setClearStencil",value:function(e){this._gl.clearStencil(e)}},{key:"clear",value:function(){var e=this._gl;e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT|e.STENCIL_BUFFER_BIT)}},{key:"drawElements",value:function(e){var t=this._gl,n=t.UNSIGNED_SHORT;t.drawElements(t.TRIANGLES,e,n,0)}},{key:"deleteVAO",value:function(e){this.extensions.get(me.OES_VERTEX_ARRAY_OBJECT).deleteVertexArrayOES(e)}},{key:"deleteBuffer",value:function(e){this._gl.deleteBuffer(e)}},{key:"deleteTexture",value:function(e){this._gl.deleteTexture(e)}},{key:"deleteShader",value:function(e){this._gl.deleteShader(e)}},{key:"deleteProgram",value:function(e){this._gl.deleteProgram(e)}},{key:"deleteFramebuffer",value:function(e){this._gl.deleteFramebuffer(e)}},{key:"deleteRenderbuffer",value:function(e){this._gl.deleteRenderbuffer(e)}},{key:"disposeContext",value:function(){this._gl.getExtension("WEBGL_lose_context").loseContext()}}]),e}(),Ee=function(){function e(t){Object(i.a)(this,e),this._gl=t,this.tempColor=new R,this.currentMask=null,this.currentClear=new R(0,0,0,0)}return Object(r.a)(e,[{key:"setMask",value:function(e){this.currentMask!==e&&(this._gl.colorMask(e,e,e,e),this.currentMask=e)}},{key:"setClear",value:function(e,t,n,i,r){!0===r&&(e*=i,t*=i,n*=i),this.tempColor.set(e,t,n,i),!1===this.currentClear.equals(this.tempColor)&&(this._gl.clearColor(e,t,n,i),this.currentClear.copy(this.tempColor))}},{key:"reset",value:function(){this.currentColorMask=null,this.currentClear.set(-1,0,0,0)}}]),e}(),ge=function(){function e(t){Object(i.a)(this,e),this._gl=t,this.currentTest=null,this.currentMask=null,this.currentFunc=null,this.currentClear=null}return Object(r.a)(e,[{key:"setTest",value:function(e){if(this.currentTest!==e){var t=this._gl;e?t.enable(t.DEPTH_TEST):t.disable(t.DEPTH_TEST),this.currentTest=e}}},{key:"setMask",value:function(e){this.currentMask!==e&&(this._gl.depthMask(e),this.currentMask=e)}},{key:"setFunc",value:function(e){if(this.currentFunc!==e){var t=this._gl;t.depthFunc(t[e]),this.currentFunc=e}}},{key:"setClear",value:function(e){this.currentClear!==e&&(this._gl.clearDepth(e),this.currentClear=e)}},{key:"reset",value:function(){this.currentFunc=null}}]),e}(),ye=function(){function e(t){Object(i.a)(this,e),this._gl=t,this.currentTest=null,this.currentMask=null,this.currentFunc=null,this.currentFuncRef=null,this.currentFuncMask=null,this.currentFail=null,this.currentZFail=null,this.currentZPass=null,this.currentClear=null}return Object(r.a)(e,[{key:"setTest",value:function(e){if(this.currentTest!==e){var t=this._gl;e?t.enable(t.STENCIL_TEST):t.disable(t.STENCIL_TEST),this.currentTest=e}}},{key:"setMask",value:function(e){this.currentMask!==e&&(this._gl.stencilMask(e),this.currentMask=e)}},{key:"setFunc",value:function(e,t,n){if(this.currentFunc!==e||this.currentFuncRef!==t||this.currentFuncMask!==n){var i=this._gl;i.stencilFunc(i[e],t,n),this.currentFunc=e,this.currentFuncRef=t,this.currentFuncMask=n}}},{key:"setOp",value:function(e,t,n){if(this.currentFail!==e||this.currentZFail!==t||this.currentZPass!==n){var i=this._gl;i.stencilOp(i[e],i[t],i[n]),this.currentFail=e,this.currentZFail=t,this.currentZPass=n}}},{key:"setClear",value:function(e){this.currentClear!==e&&(this._gl.clearStencil(e),this.currentClear=e)}},{key:"reset",value:function(){this.currentFunc=null}}]),e}(),Ae=function(){function e(t){Object(i.a)(this,e),this._gl=t,this.currentBlend=null,this.blendEquation=null,this.blendSrc=null,this.blendDst=null,this.srcAlpha=null,this.dstAlpha=null}return Object(r.a)(e,[{key:"setBlend",value:function(e){if(this.currentBlend!==e){var t=this._gl;e?t.enable(t.BLEND):t.disable(t.BLEND),this.currentBlend=e}}},{key:"setBlendFunc",value:function(e,t){if(this.blendSrc!==e||this.blendDst!==t){var n=this._gl;n.blendFunc(n[e],n[t]),this.blendSrc=e,this.blendDst=t}}},{key:"setBlendFuncSeparate",value:function(e,t,n,i){if(this.blendSrc!==e||this.blendDst!==t||this.srcAlpha!==n||this.dstAlpha!==i){var r=this._gl;r.blendFuncSeparate(r[e],r[t],r[n],r[i]),this.blendSrc=e,this.blendDst=t,this.srcAlpha=n,this.dstAlpha=i}}},{key:"setBlendEquation",value:function(e){this.blendEquation!==e&&(this._gl.blendEquation(this._gl[e]),this.blendEquation=e)}},{key:"reset",value:function(){this.currentBlend=null}}]),e}(),be=function(){function e(t){Object(i.a)(this,e),this._gl=t,this.currentCullType=null,this.enableCullType=null}return Object(r.a)(e,[{key:"setCullType",value:function(e){if(this.currentCullType!==e){var t=this._gl;e===O.a.FRONT||e===O.a.BACK?(!0!==this.enableCullType&&t.enable(t.CULL_FACE),t.cullFace(t[e]),this.enableCullType=!0):!1!==this.enableCullType&&(t.disable(t.CULL_FACE),this.enableCullType=!1),this.currentCullType=e}}},{key:"reset",value:function(){this.currentCullType=null}}]),e}(),Se=function e(t){Object(i.a)(this,e),this.depthBuffer=new ge(t),this.stencilBuffer=new ye(t),this.colorBuffer=new Ee(t),this.blending=new Ae(t),this.CullFace=new be(t)},Te=function(){function e(){Object(i.a)(this,e),this.programsInfo={},this.uniforms={},this.attributes={},this.textures={},this.frameBuffers={},this.VAOs={}}return Object(r.a)(e,null,[{key:"getCacheByTarget",value:function(t,n,i){var r=t[n];return!r&&i&&e.setCacheByTarget(t,n,i),r}},{key:"setCacheByTarget",value:function(e,t,n){return e[t]=n}}]),Object(r.a)(e,[{key:"getUniform",value:function(e){return this.uniforms[e]}},{key:"setUniform",value:function(e,t){this.uniforms[e]=t}},{key:"getProgramInfo",value:function(e){return this.programsInfo[e]}},{key:"setProgramInfo",value:function(e,t){this.programsInfo[e]=t}},{key:"getTexture",value:function(e){return this.textures[e]}},{key:"setTexture",value:function(e,t){this.textures[e]=t}},{key:"getAttribute",value:function(e){return this.attributes[e]}},{key:"setAttribute",value:function(e,t){this.attributes[e]=t}},{key:"getFrameBuffer",value:function(e){return this.frameBuffers[e]}},{key:"setFrameBuffer",value:function(e,t){this.frameBuffers[e]=t}},{key:"getVAO",value:function(e){return this.VAOs[e]}},{key:"setVAO",value:function(e,t){this.VAOs[e]=t}}]),e}(),Oe=function(){function e(){Object(i.a)(this,e)}return Object(r.a)(e,null,[{key:"create",value:function(e){var t=pe.createContext(e),n=new me(t),i=new Se(t),r=new pe(t,n,i),a=new Te;return new _e(r,a)}}]),e}();n.d(t,"o",function(){return _}),n.d(t,"l",function(){return m}),n.d(t,"f",function(){return E}),n.d(t,"b",function(){return g}),n.d(t,"c",function(){return b}),n.d(t,"s",function(){return S}),n.d(t,"m",function(){return T}),n.d(t,"q",function(){return M}),n.d(t,"r",function(){return k}),n.d(t,"g",function(){return x}),n.d(t,"k",function(){return F}),n.d(t,"i",function(){return I}),n.d(t,"h",function(){return w}),n.d(t,"j",function(){return P}),n.d(t,"a",function(){return B}),n.d(t,"e",function(){return N}),n.d(t,"n",function(){return D}),n.d(t,"p",function(){return V}),n.d(t,"t",function(){return c}),n.d(t,"d",function(){return R}),n.d(t,"u",function(){return z}),n.d(t,"v",function(){return Oe})},54:function(e,t,n){"use strict";t.a={FRONT:"FRONT",BACK:"BACK",LEQUAL:"LEQUAL",LESS:"LESS",ALWAYS:"ALWAYS",NEVER:"NEVER",EQUAL:"EQUAL",NOTEQUAL:"NOTEQUAL",GEQUAL:"GEQUAL",GREATER:"GREATER",KEEP:"KEEP",REPLACE:"REPLACE",INCR:"INCR",INCR_WRAP:"INCR_WRAP",DECR:"DECR",DECR_WRAP:"DECR_WRAP",INVERT:"INVERT",ZERO:"ZERO",ONE:"ONE",SRC_COLOR:"SRC_COLOR",ONE_MINUS_SRC_COLOR:"ONE_MINUS_SRC_COLOR",DST_COLOR:"DST_COLOR",ONE_MINUS_DST_COLOR:"ONE_MINUS_DST_COLOR",SRC_ALPHA:"SRC_ALPHA",ONE_MINUS_SRC_ALPHA:"ONE_MINUS_SRC_ALPHA",DST_ALPHA:"DST_ALPHA",ONE_MINUS_DST_ALPHA:"ONE_MINUS_DST_ALPHA",CONSTANT_COLOR:"CONSTANT_COLOR",ONE_MINUS_CONSTANT_COLOR:"ONE_MINUS_CONSTANT_COLOR",CONSTANT_ALPHA:"CONSTANT_ALPHA",ONE_MINUS_CONSTANT_ALPHA:"ONE_MINUS_CONSTANT_ALPHA",FUNC_ADD:"FUNC_ADD",FUNC_SUBTRACT:"FUNC_SUBTRACT",FUNC_REVERSE_SUBTRACT:"FUNC_REVERSE_SUBTRACT",CLAMP_TO_EDGE:"CLAMP_TO_EDGE",REPEAT:"REPEAT"}},55:function(e,t,n){"use strict";n.d(t,"a",function(){return a});var i=n(4),r=n(5),a=function(){function e(){Object(i.a)(this,e),this.listens=[]}return Object(r.a)(e,[{key:"addListener",value:function(e,t,n){n.addEventListener(e,t,!1),this.listens.push({target:n,type:e,handler:t})}},{key:"dispose",value:function(){this.listens.forEach(function(e){e.target.removeEventListener(e.type,e.handler)})}}]),e}()}}]);