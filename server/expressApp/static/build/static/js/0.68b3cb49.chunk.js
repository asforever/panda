(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{51:function(e,t,n){"use strict";var r=n(14);function i(e,t,n){return(i="undefined"!==typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Object(r.a)(e)););return e}(e,t);if(i){var a=Object.getOwnPropertyDescriptor(i,t);return a.get?a.get.call(n):a.value}})(e,t,n||e)}n.d(t,"a",function(){return i})},52:function(e,t,n){"use strict";var r=n(5),i=n(6),a=n(16),s=n(14),o=n(15),u=function(){function e(t,n,i,a){Object(r.a)(this,e),this._x=t||0,this._y=n||0,this._z=i||0,this._w=void 0!==a?a:1}return Object(i.a)(e,[{key:"setFromEuler",value:function(e,t){if(!e||!e.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");var n=e._x,r=e._y,i=e._z,a=e._order,s=Math.cos,o=Math.sin,u=s(n/2),c=s(r/2),l=s(i/2),f=o(n/2),h=o(r/2),_=o(i/2);return"XYZ"===a?(this._x=f*c*l+u*h*_,this._y=u*h*l-f*c*_,this._z=u*c*_+f*h*l,this._w=u*c*l-f*h*_):"YXZ"===a?(this._x=f*c*l+u*h*_,this._y=u*h*l-f*c*_,this._z=u*c*_-f*h*l,this._w=u*c*l+f*h*_):"ZXY"===a?(this._x=f*c*l-u*h*_,this._y=u*h*l+f*c*_,this._z=u*c*_+f*h*l,this._w=u*c*l-f*h*_):"ZYX"===a?(this._x=f*c*l-u*h*_,this._y=u*h*l+f*c*_,this._z=u*c*_-f*h*l,this._w=u*c*l+f*h*_):"YZX"===a?(this._x=f*c*l+u*h*_,this._y=u*h*l+f*c*_,this._z=u*c*_-f*h*l,this._w=u*c*l-f*h*_):"XZY"===a&&(this._x=f*c*l-u*h*_,this._y=u*h*l-f*c*_,this._z=u*c*_+f*h*l,this._w=u*c*l+f*h*_),this}},{key:"x",get:function(){return this._x}},{key:"y",get:function(){return this._y}},{key:"z",get:function(){return this._z}},{key:"w",get:function(){return this._w}}]),e}(),c=function(){function e(t,n,i){var a=this;Object(r.a)(this,e),this.applyEuler=function(){var e=new u;return function(t){return t&&t.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),a.applyQuaternion(e.setFromEuler(t))}}(),this._x=t||0,this._y=n||0,this._z=i||0}return Object(i.a)(e,[{key:"set",value:function(e,t,n){this._x=e,this._y=t,this._z=n,this.onChange()}},{key:"add",value:function(e){return this._x+=e.x,this._y+=e.y,this._z+=e.z,this.onChange(),this}},{key:"applyQuaternion",value:function(e){var t=this.x,n=this.y,r=this.z,i=e.x,a=e.y,s=e.z,o=e.w,u=o*t+a*r-s*n,c=o*n+s*t-i*r,l=o*r+i*n-a*t,f=-i*t-a*n-s*r;return this._x=u*o+f*-i+c*-s-l*-a,this._y=c*o+f*-a+l*-i-u*-s,this._z=l*o+f*-s+u*-a-c*-i,this.onChange(),this}},{key:"applyMatrix4",value:function(e){var t=this.x,n=this.y,r=this.z,i=e.elements,a=1/(i[3]*t+i[7]*n+i[11]*r+i[15]);return this._x=(i[0]*t+i[4]*n+i[8]*r+i[12])*a,this._y=(i[1]*t+i[5]*n+i[9]*r+i[13])*a,this._z=(i[2]*t+i[6]*n+i[10]*r+i[14])*a,this.onChange(),this}},{key:"setFromMatrixPosition",value:function(e){var t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}},{key:"subVectors",value:function(e,t){return this._x=e.x-t.x,this._y=e.y-t.y,this._z=e.z-t.z,this.onChange(),this}},{key:"lengthSq",value:function(){return this.x*this.x+this.y*this.y+this.z*this.z}},{key:"multiplyScalar",value:function(e){return this._x*=e,this._y*=e,this._z*=e,this.onChange(),this}},{key:"divideScalar",value:function(e){return this.multiplyScalar(1/e)}},{key:"crossVectors",value:function(e,t){var n=e.x,r=e.y,i=e.z,a=t.x,s=t.y,o=t.z;return this._x=r*o-i*s,this._y=i*a-n*o,this._z=n*s-r*a,this.onChange(),this}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}},{key:"normalize",value:function(){return this.divideScalar(this.length()||1)}},{key:"clone",value:function(){return new this.constructor(this.x,this.y,this.z)}},{key:"toArray",value:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}},{key:"onChange",value:function(){}},{key:"x",get:function(){return this._x},set:function(e){this._x=e||0,this.onChange()}},{key:"y",get:function(){return this._y},set:function(e){this._y=e||0,this.onChange()}},{key:"z",get:function(){return this._z},set:function(e){this._z=e||0,this.onChange()}}]),e}(),l=function(e){function t(){var e;return Object(r.a)(this,t),(e=Object(a.a)(this,Object(s.a)(t).call(this))).lookAt=function(){var e=new c,t=new c,n=new c;return function(r,i,a){var s=this.elements;return n.subVectors(r,i),0===n.lengthSq()&&(n.z=1),n.normalize(),e.crossVectors(a,n),0===e.lengthSq()&&(1===Math.abs(a.z)?n.x+=1e-4:n.z+=1e-4,n.normalize(),e.crossVectors(a,n)),e.normalize(),t.crossVectors(n,e),s[0]=e.x,s[4]=t.x,s[8]=n.x,s[1]=e.y,s[5]=t.y,s[9]=n.y,s[2]=e.z,s[6]=t.z,s[10]=n.z,this}}(),e.isMatrix4=!0,e.needsUpdate=!0,e.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],e}return Object(o.a)(t,e),Object(i.a)(t,[{key:"compose",value:function(e,t,n){var r=this.elements,i=t._x,a=t._y,s=t._z,o=t._w,u=i+i,c=a+a,l=s+s,f=i*u,h=i*c,_=i*l,d=a*c,v=a*l,m=s*l,p=o*u,g=o*c,E=o*l,y=n.x,A=n.y,b=n.z;return r[0]=(1-(d+m))*y,r[1]=(h+E)*y,r[2]=(_-g)*y,r[3]=0,r[4]=(h-E)*A,r[5]=(1-(f+m))*A,r[6]=(v+p)*A,r[7]=0,r[8]=(_+g)*b,r[9]=(v-p)*b,r[10]=(1-(f+d))*b,r[11]=0,r[12]=e.x,r[13]=e.y,r[14]=e.z,r[15]=1,this}},{key:"set",value:function(e,t,n,r,i,a,s,o,u,c,l,f,h,_,d,v){var m=this.elements;return m[0]=e,m[4]=t,m[8]=n,m[12]=r,m[1]=i,m[5]=a,m[9]=s,m[13]=o,m[2]=u,m[6]=c,m[10]=l,m[14]=f,m[3]=h,m[7]=_,m[11]=d,m[15]=v,this}},{key:"identity",value:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}},{key:"makePerspective",value:function(e,t,n,r,i,a){var s=this.elements,o=2*i/(t-e),u=2*i/(n-r),c=(t+e)/(t-e),l=(n+r)/(n-r),f=-(a+i)/(a-i),h=-2*a*i/(a-i);return s[0]=o,s[4]=0,s[8]=c,s[12]=0,s[1]=0,s[5]=u,s[9]=l,s[13]=0,s[2]=0,s[6]=0,s[10]=f,s[14]=h,s[3]=0,s[7]=0,s[11]=-1,s[15]=0,this}},{key:"makeTranslation",value:function(e,t,n){return this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this}},{key:"multiply",value:function(e,t){return void 0!==t?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)}},{key:"multiplyMatrices",value:function(e,t){var n=e.elements,r=t.elements,i=this.elements,a=n[0],s=n[4],o=n[8],u=n[12],c=n[1],l=n[5],f=n[9],h=n[13],_=n[2],d=n[6],v=n[10],m=n[14],p=n[3],g=n[7],E=n[11],y=n[15],A=r[0],b=r[4],S=r[8],T=r[12],O=r[1],M=r[5],U=r[9],R=r[13],k=r[2],L=r[6],x=r[10],C=r[14],F=r[3],I=r[7],N=r[11],P=r[15];return i[0]=a*A+s*O+o*k+u*F,i[4]=a*b+s*M+o*L+u*I,i[8]=a*S+s*U+o*x+u*N,i[12]=a*T+s*R+o*C+u*P,i[1]=c*A+l*O+f*k+h*F,i[5]=c*b+l*M+f*L+h*I,i[9]=c*S+l*U+f*x+h*N,i[13]=c*T+l*R+f*C+h*P,i[2]=_*A+d*O+v*k+m*F,i[6]=_*b+d*M+v*L+m*I,i[10]=_*S+d*U+v*x+m*N,i[14]=_*T+d*R+v*C+m*P,i[3]=p*A+g*O+E*k+y*F,i[7]=p*b+g*M+E*L+y*I,i[11]=p*S+g*U+E*x+y*N,i[15]=p*T+g*R+E*C+y*P,this}},{key:"getInverse",value:function(e,t){var n=this.elements,r=e.elements,i=r[0],a=r[1],s=r[2],o=r[3],u=r[4],c=r[5],l=r[6],f=r[7],h=r[8],_=r[9],d=r[10],v=r[11],m=r[12],p=r[13],g=r[14],E=r[15],y=_*g*f-p*d*f+p*l*v-c*g*v-_*l*E+c*d*E,A=m*d*f-h*g*f-m*l*v+u*g*v+h*l*E-u*d*E,b=h*p*f-m*_*f+m*c*v-u*p*v-h*c*E+u*_*E,S=m*_*l-h*p*l-m*c*d+u*p*d+h*c*g-u*_*g,T=i*y+a*A+s*b+o*S;if(0===T){var O="THREE.Matrix4: .getInverse() can't invert matrix, determinant is 0";if(!0===t)throw new Error(O);return console.warn(O),this.identity()}var M=1/T;return n[0]=y*M,n[1]=(p*d*o-_*g*o-p*s*v+a*g*v+_*s*E-a*d*E)*M,n[2]=(c*g*o-p*l*o+p*s*f-a*g*f-c*s*E+a*l*E)*M,n[3]=(_*l*o-c*d*o-_*s*f+a*d*f+c*s*v-a*l*v)*M,n[4]=A*M,n[5]=(h*g*o-m*d*o+m*s*v-i*g*v-h*s*E+i*d*E)*M,n[6]=(m*l*o-u*g*o-m*s*f+i*g*f+u*s*E-i*l*E)*M,n[7]=(u*d*o-h*l*o+h*s*f-i*d*f-u*s*v+i*l*v)*M,n[8]=b*M,n[9]=(m*_*o-h*p*o-m*a*v+i*p*v+h*a*E-i*_*E)*M,n[10]=(u*p*o-m*c*o+m*a*f-i*p*f-u*a*E+i*c*E)*M,n[11]=(h*c*o-u*_*o-h*a*f+i*_*f+u*a*v-i*c*v)*M,n[12]=S*M,n[13]=(h*p*s-m*_*s+m*a*d-i*p*d-h*a*g+i*_*g)*M,n[14]=(m*c*s-u*p*s-m*a*l+i*p*l+u*a*g-i*c*g)*M,n[15]=(u*_*s-h*c*s+h*a*l-i*_*l-u*a*d+i*c*d)*M,this}},{key:"fromArray",value:function(e,t){t=t||0;for(var n=0;n<16;n++)this.elements[n]=e[n+t];return this}},{key:"clone",value:function(){return(new t).fromArray(this.elements)}}]),t}(function e(){Object(r.a)(this,e),this.needsUpdate=!0});l.EPSILON=1e-6;var f=function(){function e(t,n,i,a){Object(r.a)(this,e),this.isEuler=!0,this._x=t||0,this._y=n||0,this._z=i||0,this._order=a||e.DefaultOrder}return Object(i.a)(e,[{key:"set",value:function(e,t,n,r){return this._x=e,this._y=t,this._z=n,this._order=r||this._order,this}},{key:"onChange",value:function(){}},{key:"x",get:function(){return this._x},set:function(e){this._x=e||0,this.onChange()}},{key:"y",get:function(){return this._y},set:function(e){this._y=e||0,this.onChange()}},{key:"z",get:function(){return this._z},set:function(e){this._z=e||0,this.onChange()}}]),e}();f.DefaultOrder="XYZ";var h=function e(){Object(r.a)(this,e)};h.DEG2RAD=Math.PI/180,h.RAD2DEG=180/Math.PI,h.generateUUID=function(){for(var e=[],t=0;t<256;t++)e[t]=(t<16?"0":"")+t.toString(16);return function(){var t=4294967295*Math.random()|0,n=4294967295*Math.random()|0,r=4294967295*Math.random()|0,i=4294967295*Math.random()|0;return(e[255&t]+e[t>>8&255]+e[t>>16&255]+e[t>>24&255]+"-"+e[255&n]+e[n>>8&255]+"-"+e[n>>16&15|64]+e[n>>24&255]+"-"+e[63&r|128]+e[r>>8&255]+"-"+e[r>>16&255]+e[r>>24&255]+e[255&i]+e[i>>8&255]+e[i>>16&255]+e[i>>24&255]).toUpperCase()}}(),h.clamp=function(e,t,n){return Math.max(t,Math.min(n,e))},h.euclideanModulo=function(e,t){return(e%t+t)%t},h.mapLinear=function(e,t,n,r,i){return r+(e-t)*(i-r)/(n-t)},h.lerp=function(e,t,n){return(1-n)*e+n*t},h.smoothstep=function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t))*e*(3-2*e)},h.smootherstep=function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t))*e*e*(e*(6*e-15)+10)},h.randInt=function(e,t){return e+Math.floor(Math.random()*(t-e+1))},h.randFloat=function(e,t){return e+Math.random()*(t-e)},h.randFloatSpread=function(e){return e*(.5-Math.random())},h.degToRad=function(e){return e*h.DEG2RAD},h.radToDeg=function(e){return e*h.RAD2DEG},h.isPowerOfTwo=function(e){return 0===(e&e-1)&&0!==e},h.ceilPowerOfTwo=function(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))},h.floorPowerOfTwo=function(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))};var _=function(){function e(){Object(r.a)(this,e),this.UUID=h.generateUUID(),this.children=[],this.matrix=new l,this.position=new c,this.rotation=new f,this.quaternion=new u,this.scale=new c(1,1,1),this.initEvent()}return Object(i.a)(e,[{key:"initEvent",value:function(){var e=this;this.position.onChange=function(){e.matrix.needsUpdate=!0},this.rotation.onChange=function(){e.matrix.needsUpdate=!0}}},{key:"add",value:function(e){this.children.push(e)}},{key:"traverse",value:function(e){e(this);for(var t=this.children,n=0,r=t.length;n<r;n++)t[n].traverse(e)}},{key:"updateMatrix",value:function(){this.quaternion.setFromEuler(this.rotation),this.matrix.compose(this.position,this.quaternion,this.scale),this.matrix.needsUpdate=!0}},{key:"lookAt",value:function(e){this.matrix.lookAt(this.position,e,new c(0,1,0))}},{key:"dispose",value:function(){}}]),e}(),d=function(e){function t(){return Object(r.a)(this,t),Object(a.a)(this,Object(s.a)(t).apply(this,arguments))}return Object(o.a)(t,e),t}(_),v=n(51),m=function(e){function t(e,n,i,o){var u;return Object(r.a)(this,t),(u=Object(a.a)(this,Object(s.a)(t).call(this))).fov=e,u.aspect=n,u.near=i,u.far=o,u.zoom=1,u.projectionMatrix=new l,u.matrixInverse=new l,u.updateProjectionMatrix(),u}return Object(o.a)(t,e),Object(i.a)(t,[{key:"lookAt",value:function(e){Object(v.a)(Object(s.a)(t.prototype),"lookAt",this).call(this,e),this.matrixInverse.getInverse(this.matrix),this.matrixInverse.needsUpdate=!0}},{key:"updateProjectionMatrix",value:function(){var e=this.near,t=e*Math.tan(Math.PI/180*.5*this.fov)/this.zoom,n=2*t,r=this.aspect*n,i=-.5*r;this.projectionMatrix.makePerspective(i,i+r,t,t-n,e,this.far),this.projectionMatrix.needsUpdate=!0}}]),t}(_),p=function(){function e(){Object(r.a)(this,e),this.applyToBufferAttribute=function(){var e=new c;return function(t){for(var n=0,r=t.count;n<r;n++)e.x=t.getX(n),e.y=t.getY(n),e.z=t.getZ(n),e.applyMatrix3(this),t.setXYZ(n,e.x,e.y,e.z);return t}}(),this.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1]}return Object(i.a)(e,[{key:"set",value:function(e,t,n,r,i,a,s,o,u){var c=this.elements;return c[0]=e,c[1]=r,c[2]=s,c[3]=t,c[4]=i,c[5]=o,c[6]=n,c[7]=a,c[8]=u,this}},{key:"identity",value:function(){return this.set(1,0,0,0,1,0,0,0,1),this}},{key:"clone",value:function(){return(new this.constructor).fromArray(this.elements)}},{key:"copy",value:function(e){var t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],this}},{key:"setFromMatrix4",value:function(e){var t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}},{key:"multiply",value:function(e){return this.multiplyMatrices(this,e)}},{key:"premultiply",value:function(e){return this.multiplyMatrices(e,this)}},{key:"multiplyMatrices",value:function(e,t){var n=e.elements,r=t.elements,i=this.elements,a=n[0],s=n[3],o=n[6],u=n[1],c=n[4],l=n[7],f=n[2],h=n[5],_=n[8],d=r[0],v=r[3],m=r[6],p=r[1],g=r[4],E=r[7],y=r[2],A=r[5],b=r[8];return i[0]=a*d+s*p+o*y,i[3]=a*v+s*g+o*A,i[6]=a*m+s*E+o*b,i[1]=u*d+c*p+l*y,i[4]=u*v+c*g+l*A,i[7]=u*m+c*E+l*b,i[2]=f*d+h*p+_*y,i[5]=f*v+h*g+_*A,i[8]=f*m+h*E+_*b,this}},{key:"multiplyScalar",value:function(e){var t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}},{key:"determinant",value:function(){var e=this.elements,t=e[0],n=e[1],r=e[2],i=e[3],a=e[4],s=e[5],o=e[6],u=e[7],c=e[8];return t*a*c-t*s*u-n*i*c+n*s*o+r*i*u-r*a*o}},{key:"getInverse",value:function(e,t){e&&e.isMatrix4&&console.error("THREE.Matrix3: .getInverse() no longer takes a Matrix4 argument.");var n=e.elements,r=this.elements,i=n[0],a=n[1],s=n[2],o=n[3],u=n[4],c=n[5],l=n[6],f=n[7],h=n[8],_=h*u-c*f,d=c*l-h*o,v=f*o-u*l,m=i*_+a*d+s*v;if(0===m){var p="THREE.Matrix3: .getInverse() can't invert matrix, determinant is 0";if(!0===t)throw new Error(p);return console.warn(p),this.identity()}var g=1/m;return r[0]=_*g,r[1]=(s*f-h*a)*g,r[2]=(c*a-s*u)*g,r[3]=d*g,r[4]=(h*i-s*l)*g,r[5]=(s*o-c*i)*g,r[6]=v*g,r[7]=(a*l-f*i)*g,r[8]=(u*i-a*o)*g,this}},{key:"transpose",value:function(){var e,t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}},{key:"getNormalMatrix",value:function(e){return this.setFromMatrix4(e).getInverse(this).transpose()}},{key:"transposeIntoArray",value:function(e){var t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}},{key:"setUvTransform",value:function(e,t,n,r,i,a,s){var o=Math.cos(i),u=Math.sin(i);this.set(n*o,n*u,-n*(o*a+u*s)+a+e,-r*u,r*o,-r*(-u*a+o*s)+s+t,0,0,1)}},{key:"scale",value:function(e,t){var n=this.elements;return n[0]*=e,n[3]*=e,n[6]*=e,n[1]*=t,n[4]*=t,n[7]*=t,this}},{key:"rotate",value:function(e){var t=Math.cos(e),n=Math.sin(e),r=this.elements,i=r[0],a=r[3],s=r[6],o=r[1],u=r[4],c=r[7];return r[0]=t*i+n*o,r[3]=t*a+n*u,r[6]=t*s+n*c,r[1]=-n*i+t*o,r[4]=-n*a+t*u,r[7]=-n*s+t*c,this}},{key:"translate",value:function(e,t){var n=this.elements;return n[0]+=e*n[2],n[3]+=e*n[5],n[6]+=e*n[8],n[1]+=t*n[2],n[4]+=t*n[5],n[7]+=t*n[8],this}},{key:"equals",value:function(e){for(var t=this.elements,n=e.elements,r=0;r<9;r++)if(t[r]!==n[r])return!1;return!0}},{key:"fromArray",value:function(e,t){void 0===t&&(t=0);for(var n=0;n<9;n++)this.elements[n]=e[n+t];return this}},{key:"toArray",value:function(e,t){void 0===e&&(e=[]),void 0===t&&(t=0);var n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e}}]),e}(),g=function(e){function t(e,n){var i;return Object(r.a)(this,t),(i=Object(a.a)(this,Object(s.a)(t).call(this))).isMesh=!0,i.geometry=e,i.material=n,i.normalMatrix=new p,i}return Object(o.a)(t,e),Object(i.a)(t,[{key:"updateMatrix",value:function(){Object(v.a)(Object(s.a)(t.prototype),"updateMatrix",this).call(this),this.normalMatrix=(new p).getNormalMatrix(this.matrix)}}]),t}(_),E=function e(t,n){Object(r.a)(this,e),this.needsUpdate=!0,this.offset=t,this.data=n},y=function(){function e(t){var n=t.name,i=t.data,a=t.componentNum;Object(r.a)(this,e),this.name=n,this.data=i,this.componentNum=a,this.needsUpdate=!0,this.attributesSubData=[]}return Object(i.a)(e,[{key:"addSubData",value:function(e){this.attributesSubData.push(e)}},{key:"clearSubData",value:function(){this.subData=null}},{key:"update",value:function(){this.needsUpdate=!1}}]),e}(),A=function(){function e(){Object(r.a)(this,e),this.UUID=h.generateUUID(),this.needsUpdate=!0,this.attributes={},this.indices=null}return Object(i.a)(e,[{key:"addAttribute",value:function(e,t){this.needsUpdate=!0,this.attributes[e]=t}},{key:"setIndex",value:function(e){this.needsUpdate=!0,this.indices=e}}]),e}(),b=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;return Object(r.a)(this,t),(e=Object(a.a)(this,Object(s.a)(t).call(this))).init(n,i,o),e}return Object(o.a)(t,e),Object(i.a)(t,[{key:"init",value:function(e,t,n){this.resetSize(e,t,n);this.addAttribute("normal",new y({name:"normal",data:new Float32Array([0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0]),componentNum:3})),this.addAttribute("uv",new y({name:"uv",data:new Float32Array([0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,1]),componentNum:2})),this.setIndex(new y({name:"indices",data:new Int16Array([0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]),componentNum:1}))}},{key:"resetSize",value:function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:3)/2,t=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:3)/2,n=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:3)/2,r=[-t,-n,e],i=[t,-n,e],a=[t,n,e],s=[-t,n,e],o=[-t,-n,-e],u=[-t,n,-e],c=[t,n,-e],l=[t,-n,-e],f=[].concat(r,i,a,s,o,u,c,l,u,s,a,c,o,l,i,r,l,c,a,i,o,r,s,u);this.addAttribute("position",new y({name:"position",data:new Float32Array(f),componentNum:3}))}}]),t}(A),S=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:32;return Object(r.a)(this,t),(e=Object(a.a)(this,Object(s.a)(t).call(this))).radius=10,e.init(n,i,o),e}return Object(o.a)(t,e),Object(i.a)(t,[{key:"init",value:function(e,t,n){var r=[],i=[],a=[],s=[],o=0,u=-Math.PI/2,l=2*Math.PI/t,f=2*Math.PI/n,h=(t-1)*n+2;r.push(0,0,-e),a.push(0,0,-1),s.push(.5,0);for(var _=0;_<t;_++){for(var d=0;d<n;d++){var v=d+1+(_-1)*n,m=(d+1)%n+v-d,p=m+n,g=v+n;if(0===_?i.push(0,d+2,d+1):_===t-1?i.push(v,m,h-1):(i.push(v,m,p),i.push(v,p,g)),0!==_){var E=e*Math.cos(u)*Math.sin(o),A=e*Math.cos(u)*Math.cos(o),b=e*e*Math.sin(u),S=new c(E,A,b).normalize();r.push(E,A,b),a.push(S.x,S.y,S.z),s.push(o/Math.PI/2,u/Math.PI/2)}o+=f}u+=l}r.push(0,0,e),a.push(0,0,1),s.push(.5,1),this.addAttribute("position",new y({name:"position",data:new Float32Array(r),componentNum:3})),this.addAttribute("normal",new y({name:"normal",data:new Float32Array(a),componentNum:3})),this.addAttribute("uv",new y({name:"uv",data:new Float32Array(s),componentNum:2})),this.setIndex(new y({name:"indices",data:new Int16Array(i),componentNum:1}))}}]),t}(A),T=function(e){function t(){var e;return Object(r.a)(this,t),(e=Object(a.a)(this,Object(s.a)(t).call(this))).init(),e}return Object(o.a)(t,e),Object(i.a)(t,[{key:"init",value:function(){this.addAttribute("position",new y({name:"position",data:new Float32Array([-1,-1,0,1,-1,0,0,1,0]),componentNum:3})),this.addAttribute("normal",new y({name:"normal",data:new Float32Array([0,0,1,0,0,1,0,0,1]),componentNum:3})),this.addAttribute("uv",new y({name:"uv",data:new Float32Array([0,0,1,0,.5,1]),componentNum:2})),this.setIndex(new y({name:"indices",data:new Int16Array([0,1,2]),componentNum:1}))}}]),t}(A),O=function(e){function t(){var e;return Object(r.a)(this,t),(e=Object(a.a)(this,Object(s.a)(t).call(this))).init(),e}return Object(o.a)(t,e),Object(i.a)(t,[{key:"init",value:function(){this.addAttribute("position",new y({name:"position",data:new Float32Array([-1,0,1,1,0,1,1,0,-1,-1,0,-1]),componentNum:3})),this.addAttribute("normal",new y({name:"normal",data:new Float32Array([0,1,0,0,1,0,0,1,0,0,1,0]),componentNum:3})),this.addAttribute("uv",new y({name:"uv",data:new Float32Array([0,0,1,0,1,1,0,1]),componentNum:2})),this.setIndex(new y({name:"indices",data:new Int16Array([0,1,2,0,2,3]),componentNum:1}))}}]),t}(A),M=n(54),U={TEXTURE_2D:"texture 2d",TEXTURE_CUBE:"texture cube"},R=function(){function e(){var t=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).image;Object(r.a)(this,e),this.type=U.TEXTURE_2D,this.UUID=h.generateUUID(),this.isTexture=!0,this.image=t,this.needsUpdate=!0,this.wrapS=M.a.REPEAT,this.wrapT=M.a.REPEAT}return Object(i.a)(e,[{key:"load",value:function(e){var t=this;return new Promise(function(n){if(t.image)n(t.image);else{var r=new Image;r.src=e,r.onload=function(){t.needsUpdate=!0,t.image=r,n(t.image)}}})}}]),e}(),k=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(r.a)(this,e),this.UUID=h.generateUUID(),this.type=U.TEXTURE_CUBE,this.image=t.image,this.needsUpdate=!0,this.wrapS=M.a.REPEAT,this.wrapT=M.a.REPEAT},L=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;Object(r.a)(this,e),this.r=t,this.b=n,this.g=i,this.a=a}return Object(i.a)(e,[{key:"toArray",value:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e[t+3]=this.a,e}},{key:"toArray3",value:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}},{key:"setRGB",value:function(e,t,n){return this.r=e,this.g=t,this.b=n,this}},{key:"setRGBA",value:function(e,t,n,r){return this.setRGB(e,t,n),this.a=r,this}},{key:"equals",value:function(e){return e.r===this.r&&e.g===this.g&&e.b===this.b&&e.a===this.a}}]),e}(),x=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(r.a)(this,e),this.type=null,this.map=t.map,this.color=t.color||new L,this.cullFace=void 0!==t.cullFace?t.cullFace:M.a.BACK,this.depthTest=!0,this.depthFunc=M.a.LESS,this.depthMask=!0,this.stencilTest=!1,this.stencilMask=255,this.stencilFunc=M.a.ALWAYS,this.stencilFuncRef=0,this.stencilFuncMask=255,this.Fail=M.a.KEEP,this.ZFail=M.a.KEEP,this.ZPass=M.a.KEEP,this.opacity=1,this.transparent=!1,this.blendSeprate=!1,this.blendSrc=M.a.SRC_ALPHA,this.blendDst=M.a.ONE_MINUS_SRC_ALPHA,this.blendSrcAlpha=M.a.SRC_ALPHA,this.blendDstAlpha=M.a.ONE_MINUS_SRC_ALPHA,this.blendEquation=M.a.FUNC_ADD},C={MESH_BASIC_MATERIAL:"mesh base material",MESH_PHONG_MATERIAL:"mesh phong material",MESH_PBR_MATERIAL:"mesh pbr material",MESH_GRAYSCALE_MATERIAL:"mesh grayscale material",MESH_INVERSION_MATERIAL:"mesh inversion material",MESH_KERNEL_MATERIAL:"mesh kernel material"},F=function(e){function t(e){var n;return Object(r.a)(this,t),(n=Object(a.a)(this,Object(s.a)(t).call(this,e))).type=C.MESH_BASIC_MATERIAL,n}return Object(o.a)(t,e),t}(x),I=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(r.a)(this,t),(e=Object(a.a)(this,Object(s.a)(t).call(this,n))).type=C.MESH_PHONG_MATERIAL,e.shininess=32,e.specularMap=n.specularMap,e.envMap=n.envMap,e.reflect=.5,e}return Object(o.a)(t,e),t}(x),N=function(e){function t(e){var n;return Object(r.a)(this,t),(n=Object(a.a)(this,Object(s.a)(t).call(this,e))).type=C.MESH_INVERSION_MATERIAL,n}return Object(o.a)(t,e),t}(x),P=function(e){function t(e){var n;return Object(r.a)(this,t),(n=Object(a.a)(this,Object(s.a)(t).call(this,e))).type=C.MESH_GRAYSCALE_MATERIAL,n}return Object(o.a)(t,e),t}(x),w=function(e){function t(e){var n;return Object(r.a)(this,t),(n=Object(a.a)(this,Object(s.a)(t).call(this,e))).type=C.MESH_KERNEL_MATERIAL,n.offset=.01,n.kernel=[-1,-1,-1,-1,9,-1,-1,-1,-1],n}return Object(o.a)(t,e),t}(x),j=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(r.a)(this,t),(e=Object(a.a)(this,Object(s.a)(t).call(this,n))).type=C.MESH_PBR_MATERIAL,e.metallic=.5,e.roughness=.5,e.ao=1,e.lightPosition=[10,10,10,10,10,-10,10,-10,10,10,-10,-10],e.lightColor=[500,500,500,500,500,500,500,500,500,500,500,500],e.normalMap=n.normalMap,e.roughnessMap=n.roughnessMap,e.metallicMap=n.metallicMap,e.aoMap=n.envMap,e}return Object(o.a)(t,e),t}(x),D=function(e){function t(){var e;return Object(r.a)(this,t),(e=Object(a.a)(this,Object(s.a)(t).call(this))).needsUpdate=!0,e.isLight=!0,e.color=new L(1,1,1),e.intensity=1,e}return Object(o.a)(t,e),t}(_),B=function(e){function t(){var e;return Object(r.a)(this,t),(e=Object(a.a)(this,Object(s.a)(t).call(this))).isDirectionalLight=!0,e.specular=new L(1,1,1),e.dir=new c(0,-1,0),e}return Object(o.a)(t,e),t}(D),V=function(e){function t(){var e;return Object(r.a)(this,t),(e=Object(a.a)(this,Object(s.a)(t).call(this))).isAmbientLight=!0,e.intensity=.2,e}return Object(o.a)(t,e),t}(D),z=function(e){function t(){var e;return Object(r.a)(this,t),(e=Object(a.a)(this,Object(s.a)(t).call(this))).isPointLight=!0,e.constant=1,e.linear=.09,e.quadratic=.032,e.specular=new L(1,1,1),e}return Object(o.a)(t,e),t}(D),G=function(e){function t(){var e;return Object(r.a)(this,t),(e=Object(a.a)(this,Object(s.a)(t).call(this))).isSpotLight=!0,e.dir=new c(0,-1,0),e.cutOff=Math.cos(Math.PI/180*7.5),e.outerCutOff=Math.cos(Math.PI/180*12),e.constant=1,e.linear=.09,e.quadratic=.032,e.specular=new L(1,1,1),e}return Object(o.a)(t,e),t}(D),H=function(){function e(t,n,i){Object(r.a)(this,e),this.UUID=h.generateUUID(),this.texture=t,this.width=n,this.height=i}return Object(i.a)(e,[{key:"updateSize",value:function(e,t){this.width=e,this.height=t,this.texture.needsUpdate=!0}}]),e}(),X=function(){function e(){Object(r.a)(this,e)}return Object(i.a)(e,null,[{key:"loadMatrixFromCache",value:function(e){var t=e.cache,n=e.uuid,r=e.matrices,i=!1;r.forEach(function(e){i=e.needsUpdate||i});var a=t.getUniform(n);return a&&!i||(a=new l,r.forEach(function(e,t){return a.multiplyMatrices(e,t),t})),a}},{key:"loadTextureFrameBufferCache",value:function(e){var t=e.state,n=e.cache,r=e.uuid,i=e.texture,a=n.getFrameBuffer(r);return a||(a=t.genFramebufferTexture(i),n.setFrameBuffer(r,a)),a}},{key:"loadVAOFromCache",value:function(e){var t=e.state,n=e.cache,r=e.uuid,i=n.getVAO(r);return i||(i=t.createVAO(),n.setVAO(r,i)),i}},{key:"loadAttributeFromCache",value:function(e){var t=e.state,n=e.cache,r=e.uuid,i=e.bufferAttribute,a=e.isIndices,s=i.data,o=i.componentNum,u=i.needsUpdate,c=n.getAttribute(r);c?u&&t.updateAttributeBufferArrayInfo(c,i.data):(c=t.createAttributeBufferArrayInfo(s,o,a),n.setAttribute(r,c));var l=i.attributesSubData;return l.length>0&&l.forEach(function(e){t.updateSubAttributeBufferArrayInfo(c,e.offset,e.data),e.needsUpdate=!1}),i.needsUpdate=!1,c}},{key:"loadProgramInfoFromCache",value:function(e){var t=e.state,n=e.cache,r=e.uuid,i=e.shaderSource,a=n.getProgramInfo(r);return a||(a=t.createProgramInfo(i.vsSource,i.fsSource),n.setProgramInfo(r,a)),a}},{key:"loadTextureFromCache",value:function(e){var t=e.state,n=e.cache,r=e.map,i=e.width,a=void 0===i?void 0:i,s=e.height,o=void 0===s?void 0:s,u=r.UUID,c=r.type===U.TEXTURE_CUBE,l=n.getTexture(u),f=r.needsUpdate;return l||(l=t.genTexture({wrapS:r.wrapS,wrapT:r.wrapT,isCubeTexture:c}),n.setTexture(u,l),f=!0),f&&(t.updateTexture(l,r.image,a,o,0,void 0,c),r.needsUpdate=!1),l}}]),e}(),Y=function(){function e(){Object(r.a)(this,e),this.UUID=null,this.fbo=null,this.texture=null}return Object(i.a)(e,[{key:"parse",value:function(e,t,n){if(n){var r=n.texture,i=n.width,a=n.height;this.UUID=n.UUID;var s=this.texture=X.loadTextureFromCache({state:e,cache:t,map:r,width:i,height:a});this.fbo=X.loadTextureFrameBufferCache({state:e,cache:t,uuid:n.UUID,texture:s})}}}]),e}(),q="precision mediump float;\r\n",Z="#ifdef USE_DIFFUSE_MAP\r\nuniform sampler2D diffuse_map;\r\n#elif defined( USE_DIFFUSE_MAP_CUBE )\r\nuniform samplerCube diffuse_map;\r\n#endif\r\n",W="#ifdef USE_SPECULAR_MAP\r\nuniform sampler2D specular_map;\r\n#elif defined( USE_SPECULAR_MAP_CUBE )\r\nuniform samplerCube specular_map;\r\n#endif\r\n",Q="#ifdef NUM_AMB_LIGHT\r\nstruct AmbientLight {\r\n   vec3 ambient;\r\n   float intensity;\r\n};\r\nuniform AmbientLight ambient_lights[NUM_AMB_LIGHT];\r\nvoid calcAmbientLight(out vec3 result_color,vec4 material_diff){\r\n     for(int i=0;i<NUM_AMB_LIGHT;i++){\r\n           AmbientLight light = ambient_lights[i];\r\n           result_color+= light.ambient * light.intensity * material_diff.xyz;\r\n     }\r\n}\r\n#endif\r\n",K="#ifdef NUM_DIR_LIGHT\r\nstruct DirLight {\r\n   vec3 dir;\r\n   vec3 diffuse;\r\n   vec3 specular;\r\n   float intensity;\r\n};\r\nuniform DirLight dir_lights[NUM_DIR_LIGHT];\r\nvoid calcDirLight(out vec3 result_color\r\n                   ,vec3 view_dir\r\n                   ,vec3 v_normal\r\n                   ,vec4 material_diff\r\n                   ,vec4 material_spec\r\n                   ,float material_shininess){\r\n   for(int i=0;i<NUM_DIR_LIGHT;i++){\r\n         DirLight light = dir_lights[i];\r\n         vec3 light_dir = normalize(-light.dir);\r\n         vec3 reflect_dir = reflect(-light_dir, v_normal);\r\n         float diff = max(dot(light_dir,v_normal),0.0);\r\n         float spec = pow(max(dot(view_dir, reflect_dir), 0.0), material_shininess);\r\n         vec3 diffuse  =  diff * light.diffuse * material_diff.xyz;\r\n         vec3 specular =  spec * light.specular * material_spec.xyz;\r\n         result_color += (diffuse + specular) * light.intensity;\r\n     }\r\n}\r\n#endif\r\n",J="#ifdef NUM_POINT_LIGHT\r\nstruct PointLight {\r\n  float constant;\r\n  float linear;\r\n  float quadratic;\r\n  float intensity;\r\n\r\n  vec3 position;\r\n  vec3 diffuse;\r\n  vec3 specular;\r\n};\r\nuniform PointLight point_lights[NUM_POINT_LIGHT];\r\nvoid calcPointLight(out vec3 result_color\r\n                   ,vec3 view_dir\r\n                   ,vec3 v_normal\r\n                   ,vec3 v_position\r\n                   ,vec4 material_diffuse\r\n                   ,vec4 material_specular\r\n                   ,float material_shininess){\r\n   for(int i=0;i<NUM_POINT_LIGHT;i++){\r\n         PointLight light = point_lights[i];\r\n         vec3 pos_to_light = light.position - v_position;\r\n         float distance = length(pos_to_light);\r\n         vec3 light_dir = normalize(pos_to_light);\r\n         float diff = max(dot(v_normal,light_dir),0.0);\r\n         vec3 reflect_dir = reflect(-light_dir, v_normal);\r\n         float spec = pow(max(dot(view_dir, reflect_dir), 0.0), material_shininess);\r\n\r\n         float attenuation = 1.0 / (light.constant + light.linear * distance\r\n         + light.quadratic * (distance * distance));\r\n\r\n         vec3 diffuse  =  diff * light.diffuse * material_diffuse.xyz;\r\n         vec3 specular =  spec * light.specular * material_specular.xyz;\r\n         result_color += (diffuse + specular)* attenuation * light.intensity;\r\n     }\r\n}\r\n#endif\r\n",$="#ifdef NUM_SPOT_LIGHT\r\nstruct SpotLight {\r\n  float constant;\r\n  float linear;\r\n  float quadratic;\r\n  float intensity;\r\n\r\n  vec3 position;\r\n  vec3 dir;\r\n  float cut_off;\r\n  float outer_cut_off;\r\n  vec3 diffuse;\r\n  vec3 specular;\r\n};\r\nuniform SpotLight spot_lights[NUM_SPOT_LIGHT];\r\nvoid calcSpotLight(out vec3 result_color\r\n                   ,vec3 view_dir\r\n                   ,vec3 v_normal\r\n                   ,vec3 v_position\r\n                   ,vec4 material_diff\r\n                   ,vec4 material_spec\r\n                   ,float material_shininess){\r\n   for(int i=0;i<NUM_SPOT_LIGHT;i++){\r\n         SpotLight light = spot_lights[i];\r\n         vec3 pos_to_light = light.position - v_position;\r\n         float distance = length(pos_to_light);\r\n         vec3 light_dir = normalize(pos_to_light);\r\n         float diff = max(dot(v_normal,light_dir),0.0);\r\n         vec3 reflect_dir = reflect(-light_dir, v_normal);\r\n         float spec = pow(max(dot(view_dir, reflect_dir), 0.0), material_shininess);\r\n\r\n         float attenuation = 1.0 / (light.constant + light.linear * distance\r\n         + light.quadratic * (distance * distance));\r\n\r\n         //diff point light\r\n         float theta = dot(light_dir, normalize(-light.dir));\r\n         float epsilon = light.cut_off - light.outer_cut_off;\r\n         float intensity = clamp((theta - light.outer_cut_off) / epsilon, 0.0, 1.0);\r\n         //\r\n\r\n         vec3 diffuse  =  diff * light.diffuse * material_diff.xyz;\r\n         vec3 specular =  spec * light.specular * material_spec.xyz;\r\n         result_color += (diffuse + specular)* attenuation * intensity * light.intensity;\r\n     }\r\n}\r\n#endif\r\n",ee="void calcAllLight(\r\n        out vec3 result_color\r\n        ,vec3 view_dir\r\n        ,vec3 v_normal\r\n        ,vec3 v_position\r\n        ,vec4 material_diffuse\r\n        ,vec4 material_specular\r\n        ,float material_shininess){\r\n\r\n        #ifdef NUM_AMB_LIGHT\r\n        calcAmbientLight(result_color,material_diffuse);\r\n        #endif\r\n\r\n        #ifdef NUM_DIR_LIGHT\r\n        calcDirLight(result_color,view_dir,v_normal,material_diffuse,material_specular,material_shininess);\r\n        #endif\r\n\r\n        #ifdef NUM_POINT_LIGHT\r\n        calcPointLight(result_color,view_dir,v_normal,v_position,material_diffuse,material_specular,material_shininess);\r\n        #endif\r\n\r\n        #ifdef NUM_SPOT_LIGHT\r\n        calcSpotLight(result_color,view_dir,v_normal,v_position,material_diffuse,material_specular,material_shininess);\r\n        #endif\r\n}\r\n",te="precision mediump float;\r\n\r\nuniform mat4 u_modelViewMatrix;\r\nuniform mat4 u_projectionMatrix;\r\n\r\nattribute vec3 a_position;\r\nattribute vec2 a_uv;\r\n\r\nvarying vec2 v_uv;\r\nvarying vec3 v_position;\r\n\r\nvoid main(void) {\r\n  v_uv = a_uv;\r\n  v_position = a_position;\r\n  gl_Position = u_projectionMatrix * u_modelViewMatrix * vec4(a_position,1.0);\r\n}\r\n",ne="uniform mat4 u_modelViewMatrix;\r\nuniform mat4 u_projectionMatrix;\r\nuniform mat3 u_normalMatrix;\r\n\r\nattribute vec3 a_position;\r\nattribute vec3 a_normal;\r\nattribute vec2 a_uv;\r\n\r\nvarying vec3  v_position;\r\nvarying vec3  v_normal;\r\nvarying vec2  v_uv;\r\n\r\nvoid main(){\r\n     vec4 view_position = u_modelViewMatrix * vec4(a_position, 1.0);\r\n     v_uv = a_uv;\r\n     v_normal = u_normalMatrix * a_normal;\r\n     v_position = vec3(view_position);\r\n     gl_Position = u_projectionMatrix * view_position;\r\n}\r\n\r\n",re={common:{precision:q,diffuse_map:Z,specular_map:W,ambient_light:Q,dir_light:K,point_light:J,spot_light:$,all_light:ee},base:{vsSource:te,fsSource:q+Z+"\r\nvarying vec3 v_position;\r\nvarying vec2 v_uv;\r\n\r\nuniform vec4 material_color;\r\n\r\nvoid main(void) {\r\n\r\n    vec4 diffuse = material_color;\r\n    #ifdef USE_DIFFUSE_MAP\r\n    diffuse *= texture2D(diffuse_map,v_uv);\r\n    #elif defined( USE_DIFFUSE_MAP_CUBE )\r\n    diffuse *= textureCube(diffuse_map,v_position);\r\n    #endif\r\n\r\n    gl_FragColor = diffuse;\r\n}\r\n"},phong:{vsSource:ne,fsSource:q+Z+W+"#ifdef USE_ENV_MAP_CUBE\r\nuniform samplerCube env_map;\r\n#endif\r\n\r\n\r\n"+Q+K+J+$+ee+"uniform vec3 u_cameraPosition;\r\nvarying vec3 v_position;\r\nvarying vec2 v_uv;\r\nvarying vec3 v_normal;\r\n\r\nuniform vec4 material_color;\r\nuniform float material_shininess;\r\nuniform float material_reflect;\r\n\r\nvoid main(){\r\n    vec3 view_dir = normalize(u_cameraPosition - v_position);\r\n\r\n    vec4 diffuse = material_color;\r\n    #ifdef USE_DIFFUSE_MAP\r\n    diffuse *= texture2D(diffuse_map,v_uv);\r\n    #elif defined( USE_DIFFUSE_MAP_CUBE )\r\n    diffuse *= textureCube(diffuse_map,v_position);\r\n    #endif\r\n\r\n    vec4 specular = vec4(1.0);\r\n    #ifdef USE_SPECULAR_MAP\r\n    specular = texture2D(specular_map,v_uv);\r\n    #elif defined( USE_SPECULAR_MAP_CUBE )\r\n    specular = textureCube(specular_map,v_position);\r\n    #endif\r\n\r\n    #ifdef USE_ENV_MAP_CUBE\r\n    vec3 R = reflect(-view_dir, v_normal);\r\n    vec4 env = textureCube(env_map,R);\r\n    diffuse = diffuse * (1. - env.a * material_reflect) + env * material_reflect;\r\n    #endif\r\n\r\n    vec3 result_color = vec3(0.0);\r\n    calcAllLight(result_color,view_dir,v_normal,v_position,diffuse,specular,material_shininess);\r\n    gl_FragColor = vec4(result_color,diffuse.a);\r\n}\r\n"},inversion:{vsSource:te,fsSource:q+Z+"\r\nvarying vec2 v_uv;\r\nuniform vec4 material_color;\r\n\r\nvoid main(){\r\n  vec4 diffuse = material_color;\r\n  #ifdef USE_DIFFUSE_MAP\r\n  diffuse *= texture2D(diffuse_map,v_uv);\r\n  #elif defined( USE_DIFFUSE_MAP_CUBE )\r\n  diffuse *= textureCube(diffuse_map,v_position);\r\n  #endif\r\n\r\n  gl_FragColor = vec4(1.0-diffuse.xyz,diffuse.a);\r\n}\r\n"},grayscale:{vsSource:te,fsSource:q+Z+"precision mediump float;\r\nvarying vec2 v_uv;\r\nuniform vec4 material_color;\r\n\r\nvoid main(){\r\n  vec4 diffuse = material_color;\r\n  #ifdef USE_DIFFUSE_MAP\r\n  diffuse *= texture2D(diffuse_map,v_uv);\r\n  #elif defined( USE_DIFFUSE_MAP_CUBE )\r\n  diffuse *= textureCube(diffuse_map,v_position);\r\n  #endif\r\n\r\n  float average =  0.2126 * diffuse.r + 0.7152 * diffuse.g + 0.0722 * diffuse.b;\r\n  gl_FragColor = vec4(vec3(average),diffuse.a);\r\n}\r\n\r\n"},kernel:{vsSource:ne,fsSource:q+Z+"varying vec2 v_uv;\r\n\r\nuniform vec4 material_color;\r\nuniform float kernel[9];\r\nuniform float offset;\r\nvec2 offsets[9];\r\nvec3 sampleTex[9];\r\n\r\nvoid main()\r\n{\r\n    offsets[0] = vec2(-offset,  offset);\r\n    offsets[1] = vec2(      0.0,  offset);\r\n    offsets[2] = vec2( offset,  offset);\r\n    offsets[3] = vec2(-offset,      0.0);\r\n    offsets[4] = vec2(      0.0,      0.0);\r\n    offsets[5] = vec2( offset,       0.0);\r\n    offsets[6] = vec2(-offset, -offset);\r\n    offsets[7] = vec2(     0.0,  -offset);\r\n    offsets[8] = vec2( offset,  -offset);\r\n\r\n    for(int i = 0; i < 9; i++)\r\n    {\r\n        #ifdef USE_DIFFUSE_MAP\r\n        sampleTex[i] = texture2D(diffuse_map, v_uv + offsets[i]).xyz;\r\n        #elif defined( USE_DIFFUSE_MAP_CUBE )\r\n        sampleTex[i] = textureCube(diffuse_map,v_position  + vec3(offsets[i],0.0)).xyz;\r\n        #endif\r\n    }\r\n\r\n    vec3 col = vec3(0.0);\r\n    for(int i = 0; i < 9; i++)\r\n        col += sampleTex[i] * kernel[i];\r\n    gl_FragColor = vec4(col, 1.0) * material_color;\r\n}\r\n\r\n"},pbr:{vsSource:ne,fsSource:q+Z+"#ifdef USE_NORMAL_MAP\r\nuniform sampler2D normal_map;\r\n#endif\r\n\r\n\r\n#ifdef USE_ROUGHNESS_MAP\r\nuniform sampler2D roughness;\r\n#endif\r\n\r\n\r\n#ifdef USE_METALLIC_MAP\r\nuniform sampler2D metallic_map;\r\n#endif\r\n\r\n\r\n#ifdef USE_AO_MAP\r\nuniform sampler2D ao_map;\r\n#endif\r\n\r\n\r\nconst float PI = 3.14159265359;\r\n\r\nuniform vec3 u_cameraPosition;\r\nvarying vec3 v_position;\r\nvarying vec2 v_uv;\r\nvarying vec3 v_normal;\r\n\r\nuniform vec4  material_color;\r\nuniform float metallic;\r\nuniform float roughness;\r\nuniform float ao;\r\n\r\nuniform vec3 light_position[4];\r\nuniform vec3 light_color[4];\r\n\r\n\r\nvec3 getNormalFromMap(sampler2D normal_map,vec2 v_uv)\r\n{\r\n    vec3 tangentNormal = texture2D(normal_map, v_uv).xyz * 2.0 - 1.0;\r\n\r\n    vec3 Q1  = dFdx(v_position);\r\n    vec3 Q2  = dFdy(v_position);\r\n    vec2 st1 = dFdx(v_uv);\r\n    vec2 st2 = dFdy(v_uv);\r\n\r\n    vec3 N   = normalize(v_normal);\r\n    vec3 T  = normalize(Q1*st2.t - Q2*st1.t);\r\n    vec3 B  = -normalize(cross(N, T));\r\n    mat3 TBN = mat3(T, B, N);\r\n\r\n    return normalize(TBN * tangentNormal);\r\n}\r\n\r\nfloat DistributionGGX(vec3 N, vec3 H, float roughness)\r\n{\r\n    float a      = roughness*roughness;\r\n    float a2     = a*a;\r\n    float NdotH  = max(dot(N, H), 0.0);\r\n    float NdotH2 = NdotH*NdotH;\r\n\r\n    float nom   = a2;\r\n    float denom = (NdotH2 * (a2 - 1.0) + 1.0);\r\n    denom = PI * denom * denom;\r\n\r\n    return nom / denom;\r\n}\r\n\r\nfloat GeometrySchlickGGX(float NdotV, float roughness)\r\n{\r\n    float r = (roughness + 1.0);\r\n    float k = (r*r) / 8.0;\r\n\r\n    float nom   = NdotV;\r\n    float denom = NdotV * (1.0 - k) + k;\r\n\r\n    return nom / denom;\r\n}\r\n\r\nfloat GeometrySmith(vec3 N, vec3 V, vec3 L, float roughness)\r\n{\r\n    float NdotV = max(dot(N, V), 0.0);\r\n    float NdotL = max(dot(N, L), 0.0);\r\n    float ggx2  = GeometrySchlickGGX(NdotV, roughness);\r\n    float ggx1  = GeometrySchlickGGX(NdotL, roughness);\r\n\r\n    return ggx1 * ggx2;\r\n}\r\n\r\nvec3 fresnelSchlick(float cosTheta, vec3 F0)\r\n{\r\n    return F0 + (1.0 - F0) * pow(1.0 - cosTheta, 5.0);\r\n}\r\n\r\nvoid main(){\r\n    vec3  result_diffuse = pow(material_color.rgb,vec3(2.2));\r\n    vec3  result_normal = v_normal;\r\n    float result_metallic = metallic;\r\n    float result_roughness = roughness;\r\n    float result_ao = ao;\r\n\r\n    #ifdef USE_DIFFUSE_MAP\r\n    result_diffuse *= pow(texture2D(diffuse_map,v_uv).rgb,vec3(2.2));\r\n    #elif defined( USE_DIFFUSE_MAP_CUBE )\r\n    result_diffuse *= pow(textureCube(diffuse_map,v_position).rgb,2.2);\r\n    #endif\r\n\r\n    #ifdef USE_METALLIC_MAP\r\n    result_metallic = texture2D(metallic_map,v_uv).r;\r\n    #endif\r\n\r\n    #ifdef USE_ROUGHNESS_MAP\r\n    result_roughness = texture2D(roughness_map,v_uv).r;\r\n    #endif\r\n\r\n    #ifdef USE_AO_MAP\r\n    result_ao = texture2D(ao_map,v_uv);\r\n    #endif\r\n\r\n    #ifdef USE_NORMAL_MAP\r\n    result_normal = getNormalFromMap(normal_map,v_uv).r;\r\n    #endif\r\n\r\n    vec3 V = normalize(u_cameraPosition - v_position);\r\n    vec3 Lo = vec3(0.0);\r\n    vec3 F0 = vec3(0.04);\r\n    F0 = mix(F0, result_diffuse, result_metallic);\r\n\r\n    for(int i = 0; i < 4; ++i)\r\n    {\r\n        vec3 N = normalize(result_normal);\r\n        vec3 L = normalize(light_position[i] - v_position);\r\n        vec3 H = normalize(V + L);\r\n        float distance    = length(light_position[i] - v_position);\r\n        float attenuation = 1.0 / (distance * distance);\r\n        vec3 radiance     = light_color[i] * attenuation;\r\n\r\n        float NDF = DistributionGGX(N, H, roughness);\r\n        float G   = GeometrySmith(N, V, L, roughness);\r\n        vec3 F    = fresnelSchlick(max(dot(H, V), 0.0), F0);\r\n\r\n        vec3 kS = F;\r\n        vec3 kD = vec3(1.0) - kS;\r\n        kD *= 1.0 - metallic;\r\n\r\n        vec3 nominator    = NDF * G * F;\r\n        float denominator = 4.0 * max(dot(N, V), 0.0) * max(dot(N, L), 0.0) + 0.001;\r\n        vec3 specular     = nominator / denominator;\r\n\r\n        // add to outgoing radiance Lo\r\n        float NdotL = max(dot(N, L), 0.0);\r\n        Lo += (kD * result_diffuse / PI + specular) * radiance * NdotL;\r\n    }\r\n\r\n    vec3 ambient = vec3(0.03) * result_diffuse * result_ao;\r\n    vec3 color = ambient + Lo;\r\n\r\n    color = color / (color + vec3(1.0));\r\n    color = pow(color, vec3(1.0/2.2));\r\n\r\n    gl_FragColor = vec4(color, 1.0);\r\n}\r\n"}},ie={USE_DIFFUSE_MAP:"#define USE_DIFFUSE_MAP\n",USE_DIFFUSE_MAP_CUBE:"#define USE_DIFFUSE_MAP_CUBE\n",USE_SPECULAR_MAP:"#define USE_SPECULAR_MAP\n",USE_SPECULAR_MAP_CUBE:"#define USE_SPECULAR_MAP_CUBE\n",USE_METALLIC_MAP:"#define USE_METALLIC_MAP\n",USE_ROUGHNESS_MAP:"#define USE_ROUGHNESS_MAP\n",USE_AO_MAP:"#define USE_AO_MAP\n",USE_NORMAL_MAP:"#define USE_NORMAL_MAP\n"},ae=new(function(){function e(){Object(r.a)(this,e),this.source=null}return Object(i.a)(e,[{key:"parseLight",value:function(e){var t=e.dirLightNum,n=e.ambientLightNum,r=e.pointLightNum,i=e.spotLightNum,a=this.source;t>0&&(a.phongFS="#define NUM_DIR_LIGHT "+t+"\n"+a.phongFS),n>0&&(a.phongFS="#define NUM_AMB_LIGHT "+n+"\n"+a.phongFS),r>0&&(a.phongFS="#define NUM_POINT_LIGHT "+r+"\n"+a.phongFS),i>0&&(a.phongFS="#define NUM_SPOT_LIGHT "+i+"\n"+a.phongFS)}},{key:"parseMaterial",value:function(e){var t=e.type,n=this.source,r="",i="",a=e.map?e.map.type:"",s=e.specularMap?e.specularMap.type:"",o=e.envMap?e.envMap.type:"",u=e.normalMap?e.normalMap.type:"",c=e.roughnessMap?e.roughnessMap.type:"",l=e.metallicMap?e.metallicMap.type:"",f=e.aoMap?e.aoMap.type:"",h=t+a+s+o;switch(a===U.TEXTURE_2D?i+=ie.USE_DIFFUSE_MAP:a===U.TEXTURE_CUBE&&(i+=ie.USE_DIFFUSE_MAP_CUBE),s===U.TEXTURE_2D?i+=ie.USE_SPECULAR_MAP:s===U.TEXTURE_CUBE&&(i+=ie.USE_SPECULAR_MAP_CUBE),u===U.TEXTURE_2D&&(i+=ie.USE_NORMAL_MAP),c===U.TEXTURE_CUBE&&(i+=ie.USE_ROUGHNESS_MAP),l===U.TEXTURE_CUBE&&(i+=ie.USE_METALLIC_MAP),f===U.TEXTURE_CUBE&&(i+=ie.USE_AO_MAP),o===U.TEXTURE_CUBE&&(i+=ie.USE_ENV_MAP_CUBE),t){case C.MESH_BASIC_MATERIAL:r+=n.baseVS,i+=n.baseFS;break;case C.MESH_PHONG_MATERIAL:r+=n.phongVS,i+=n.phongFS;break;case C.MESH_INVERSION_MATERIAL:r+=n.inversionVS,i+=n.inversionFS;break;case C.MESH_GRAYSCALE_MATERIAL:r+=n.grayscaleVS,i+=n.grayscaleFS;break;case C.MESH_KERNEL_MATERIAL:r+=n.kernelVS,i+=n.kernelFS;break;case C.MESH_PBR_MATERIAL:r+=n.pbrVS,i="#extension GL_EXT_shader_texture_lod : enable\n#extension GL_OES_standard_derivatives : enable\n"+n.pbrFS}return{id:h,vsSource:r,fsSource:i}}},{key:"reset",value:function(){this.source={baseVS:re.base.vsSource,baseFS:re.base.fsSource,phongVS:re.phong.vsSource,phongFS:re.phong.fsSource,inversionVS:re.inversion.vsSource,inversionFS:re.inversion.fsSource,grayscaleVS:re.grayscale.vsSource,grayscaleFS:re.grayscale.fsSource,kernelVS:re.kernel.vsSource,kernelFS:re.kernel.fsSource,pbrVS:re.pbr.vsSource,pbrFS:re.pbr.fsSource}}}]),e}()),se=function(){function e(){Object(r.a)(this,e),this.uniforms={}}return Object(i.a)(e,[{key:"parse",value:function(e){var t=new l;t.multiplyMatrices(e.projectionMatrix,e.matrixInverse),this.uniforms={u_projectionMatrix:t.elements,u_cameraPosition:e.position.toArray()}}}]),e}(),oe=function(){function e(){Object(r.a)(this,e),this.uniforms={}}return Object(i.a)(e,[{key:"parse",value:function(e){var t={};e.forEach(function(e,n){var r="ambient_lights["+n+"]";t[r+".ambient"]=e.color.toArray3(),t[r+".intensity"]=e.intensity}),this.uniforms=t}}]),e}(),ue=function(){function e(){Object(r.a)(this,e),this.uniforms={}}return Object(i.a)(e,[{key:"parse",value:function(e){var t={};e.forEach(function(e,n){var r=e.intensity,i="dir_lights["+n+"]";t[i+".diffuse"]=e.color.toArray3(),t[i+".specular"]=e.specular.toArray3(),t[i+".dir"]=e.dir.toArray(),t[i+".intensity"]=r}),this.uniforms=t}}]),e}(),ce=function(){function e(){Object(r.a)(this,e),this.uniforms={}}return Object(i.a)(e,[{key:"parse",value:function(e){var t={};e.forEach(function(e,n){var r="spot_lights["+n+"]";t[r+".diffuse"]=e.color.toArray3(),t[r+".specular"]=e.specular.toArray3(),t[r+".position"]=e.position.toArray(),t[r+".dir"]=e.dir.toArray(),t[r+".cut_off"]=e.cutOff,t[r+".outer_cut_off"]=e.outerCutOff,t[r+".intensity"]=e.intensity,t[r+".constant"]=e.constant,t[r+".linear"]=e.linear,t[r+".quadratic"]=e.quadratic}),this.uniforms=t}}]),e}(),le=function(){function e(){Object(r.a)(this,e),this.uniforms={}}return Object(i.a)(e,[{key:"parse",value:function(e){var t={};e.forEach(function(e,n){var r="point_lights["+n+"]";t[r+".diffuse"]=e.color.toArray3(),t[r+".specular"]=e.specular.toArray3(),t[r+".position"]=e.position.toArray(),t[r+".intensity"]=e.intensity,t[r+".constant"]=e.constant,t[r+".linear"]=e.linear,t[r+".quadratic"]=e.quadratic}),this.uniforms=t}}]),e}(),fe=function(){function e(){Object(r.a)(this,e),this.uniforms={}}return Object(i.a)(e,[{key:"parse",value:function(e,t){this.uniforms={u_modelViewMatrix:t.matrix.elements,u_normalMatrix:t.normalMatrix.elements}}}]),e}(),he=function(){function e(){Object(r.a)(this,e),this.programInfo=null,this.uniforms={},this.capabilities={}}return Object(i.a)(e,[{key:"parse",value:function(e,t,n,r){var i,a=n.map,s=n.specularMap,o=n.envMap,u={},c=n,l=r.parseMaterial(n);i=X.loadProgramInfoFromCache({state:e,cache:t,uuid:l.id,shaderSource:l}),a&&(u.diffuse_map=X.loadTextureFromCache({state:e,cache:t,map:a})),s&&(u.specular_map=X.loadTextureFromCache({state:e,cache:t,map:s})),o&&(u.env_map=X.loadTextureFromCache({state:e,cache:t,map:o}));var f=n.color.toArray3();f.push(n.color.a*n.opacity),u.material_color=f,n.type===C.MESH_KERNEL_MATERIAL&&(u.kernel=n.kernel,u.offset=n.offset),n.type===C.MESH_PHONG_MATERIAL&&(u.material_shininess=n.shininess,u.material_reflect=n.reflect),n.type===C.MESH_PBR_MATERIAL&&(u.metallic=n.metallic,u.roughness=n.roughness,u.ao=n.ao,u.light_position=n.lightPosition,u.light_color=n.lightColor),this.programInfo=i,this.uniforms=u,this.capabilities=c}}]),e}(),_e=function(){function e(){Object(r.a)(this,e),this.attributes={},this.indices=null,this.VAO=null,this.needsUpdateVAO=null,this.drawSize=0}return Object(i.a)(e,[{key:"parse",value:function(e,t,n,r){var i=n.UUID+r,a=n.attributes,s=n.indices;if(this.needsUpdateVAO=!Boolean(t.getVAO(i)),this.VAO=X.loadVAOFromCache({state:e,cache:t,uuid:i}),this.drawSize=s.data.length,this.needsUpdateVAO||n.needsUpdate){for(var o in n.needsUpdate=!1,this.attributes={},a){var u=a[o],c="a_"+u.name;this.attributes[c]=X.loadAttributeFromCache({state:e,cache:t,uuid:i+c,bufferAttribute:u,isIndices:!1})}this.indices=X.loadAttributeFromCache({state:e,cache:t,uuid:i+"indices",data:s.data,bufferAttribute:s,isIndices:!0})}}}]),e}(),de=function(){function e(){Object(r.a)(this,e),this.programInfo=null,this.uniforms=null,this.attributes=null,this.indices=null,this.drawSize=0,this.capabilities=null,this.depth=0}return Object(i.a)(e,[{key:"setUp",value:function(e){var t=e.programInfo,n=e.uniforms,r=e.attributes,i=e.indices,a=e.drawSize,s=e.VAO,o=e.needsUpdateVAO,u=e.capabilities;this.programInfo=t,this.uniforms=n,this.attributes=r,this.indices=i,this.drawSize=a,this.VAO=s,this.needsUpdateVAO=o,this.capabilities=u}},{key:"mergeUniforms",value:function(){return Object.assign.apply(Object,[this.uniforms].concat(Array.prototype.slice.call(arguments)))}},{key:"needSort",value:function(){return this.capabilities.transparent}},{key:"reCalcDepth",value:function(){var e=this.uniforms;e.u_projectionMatrix&&e.u_modelViewMatrix||console.warn("Can't be sorted because there is no u_projectionMatrix||u_modelViewMatrix");var t=new l,n=new l,r=new c;t.elements=this.uniforms.u_projectionMatrix,n.elements=this.uniforms.u_modelViewMatrix,this.depth=r.setFromMatrixPosition(n).applyMatrix4(t).z}}]),e}(),ve=function(){function e(){Object(r.a)(this,e)}return Object(i.a)(e,null,[{key:"createRenderTargetGL",value:function(){return new Y}},{key:"createShaderStoreGL",value:function(){return ae.reset(),ae}},{key:"createCameraGL",value:function(){return new se}},{key:"createAmbientLightGL",value:function(){return new oe}},{key:"createDirectionalLightGL",value:function(){return new ue}},{key:"createSpotLightGL",value:function(){return new ce}},{key:"createPointLightGL",value:function(){return new le}},{key:"createMaterialGL",value:function(){return new he}},{key:"createGeometryGL",value:function(){return new _e}},{key:"createMeshGL",value:function(){return new fe}},{key:"createWaitToDrawObject",value:function(){return new de}}]),e}(),me=function(){function e(t,n){Object(r.a)(this,e),this.state=t,this.cache=n,this.autoClear=!0,this.curRenderTarget=null,this.meshes=[],this.ambientLights=[],this.dirLights=[],this.spotLights=[],this.pointLights=[]}return Object(i.a)(e,[{key:"sortScene",value:function(e){var t=this;this.dirLights=[],this.ambientLights=[],this.pointLights=[],this.spotLights=[],this.meshes=[],e.traverse(function(e){e.isDirectionalLight&&t.dirLights.push(e),e.isAmbientLight&&t.ambientLights.push(e),e.isPointLight&&t.pointLights.push(e),e.isSpotLight&&t.spotLights.push(e),e.isMesh&&t.meshes.push(e)})}},{key:"render",value:function(e,t,n){var r=this.state,i=this.cache;this.sortScene(e);var a=ve.createRenderTargetGL(),s=ve.createShaderStoreGL(),o=ve.createCameraGL(),u=ve.createAmbientLightGL(),c=ve.createDirectionalLightGL(),l=ve.createSpotLightGL(),f=ve.createPointLightGL();s.parseLight({dirLightNum:this.dirLights.length,ambientLightNum:this.ambientLights.length,pointLightNum:this.pointLights.length,spotLightNum:this.spotLights.length}),a.parse(r,i,n),o.parse(t),c.parse(this.dirLights),u.parse(this.ambientLights),f.parse(this.pointLights),l.parse(this.spotLights);var h=[],_=[];this.meshes.forEach(function(e){var t=ve.createMeshGL(),n=ve.createMaterialGL(),a=ve.createGeometryGL();t.parse(i,e),n.parse(r,i,e.material,s),a.parse(r,i,e.geometry,e.material.type);var d=ve.createWaitToDrawObject();d.setUp({programInfo:n.programInfo,uniforms:{},attributes:a.attributes,indices:a.indices,drawSize:a.drawSize,VAO:a.VAO,needsUpdateVAO:a.needsUpdateVAO,capabilities:n.capabilities}),d.mergeUniforms(t.uniforms,n.uniforms,o.uniforms,c.uniforms,u.uniforms,f.uniforms,l.uniforms),d.needSort()?(d.reCalcDepth(),_.push(d)):h.push(d)}),_.sort(function(e,t){return t.depth-e.depth});var d=h.concat(_);this.curRenderTarget!==n&&(this.curRenderTarget=n,r.bindFrameBuffer(a.fbo)),this.autoClear&&this.clear(),d.forEach(function(e){var t=e.programInfo,n=t.program,i=e.uniforms,a=e.attributes,s=e.indices,o=e.drawSize,u=e.VAO,c=e.needsUpdateVAO,l=e.capabilities,f=l.depthTest,h=l.stencilTest,_=l.transparent,d=l.cullFace;r.useProgram(n),r.setUniforms(t,i),c?r.bindVAOAndSetAttributes(t,a,s,u):r.bindVAO(u);var v=r.capabilities.depthBuffer,m=r.capabilities.stencilBuffer,p=r.capabilities.blending,g=r.capabilities.CullFace;v.setTest(f),m.setTest(h),p.setBlend(_),g.setCullType(d),f&&(v.setMask(l.depthMask),v.setFunc(l.depthFunc)),h&&(m.setMask(l.stencilMask),m.setFunc(l.stencilFunc,l.stencilFuncRef,l.stencilFuncMask),m.setOp(l.Fail,l.ZFail,l.ZPass)),_&&(l.blendSeprate?p.setBlendFuncSeparate(l.blendSrc,l.blendDst,l.blendSrcAlpha,l.blendDstAlpha):p.setBlendFunc(l.blendSrc,l.blendDst),l.blendEquation&&p.setBlendEquation(l.blendEquation)),r.drawElements(o)}),r.bindVAO(null)}},{key:"setClearColor",value:function(e,t,n,r){this.state.setClearColor(e,t,n,r)}},{key:"setClearDepth",value:function(e){this.state.setClearDepth(e)}},{key:"setClearStencil",value:function(e){this.state.setClearStencil(e)}},{key:"clear",value:function(){this.state.clear()}},{key:"getState",value:function(){return this.state}},{key:"dispose",value:function(){this.state.disposeContext()}},{key:"viewport",value:function(e,t,n,r){this.state.viewport(e,t,n,r)}}]),e}();function pe(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n,r,i={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var ge=function(){function e(t){Object(r.a)(this,e),this.gl=t,this.extensions={}}return Object(i.a)(e,[{key:"get",value:function(e){return this.extensions[e]?this.extensions[e]:this.gl.getExtension(e)}}]),e}();ge.OES_VERTEX_ARRAY_OBJECT="OES_vertex_array_object",ge.EXT_SHADER_TEXTURE_LOD="EXT_shader_texture_lod",ge.OES_STANDARD_DERIVATIVES="OES_standard_derivatives";var Ee=function(){function e(t,n,i){Object(r.a)(this,e),this._gl=t,this.extensions=n,this.capabilities=i,this.textureUnit=0}return Object(i.a)(e,null,[{key:"createContext",value:function(e){var t=e.canvas,n=pe(e,["canvas"]),r={};r.alpha=void 0!==n.alpha&&n.alpha,r.depth=void 0===n.depth||n.depth,r.stencil=void 0===n.stencil||n.stencil,r.antialias=void 0===n.antialias||n.antialias,r.premultipliedAlpha=void 0===n.premultipliedAlpha||n.premultipliedAlpha,r.preserveDrawingBuffer=void 0!==n.preserveDrawingBuffer&&n.preserveDrawingBuffer,r.powerPreference=void 0!==n.powerPreference?n.powerPreference:"default";var i=t.getContext("webgl",r);return i||alert("Unable to initialize WebGL. Your browser or machine may not support it."),i}}]),Object(i.a)(e,[{key:"loaderShader",value:function(e,t){var n=this._gl,r=n.createShader(e);return n.shaderSource(r,t),n.compileShader(r),n.getShaderParameter(r,n.COMPILE_STATUS)?r:(alert("An error occurred compiling the shaders: "+n.getShaderInfoLog(r)),n.deleteShader(r),null)}},{key:"getBindPointForSamplerType",value:function(e){var t=this._gl;return e===t.SAMPLER_2D?t.TEXTURE_2D:e===t.SAMPLER_CUBE?t.TEXTURE_CUBE_MAP:void 0}},{key:"createUniformsSetter",value:function(e){var t=this;this.textureUnit=0;for(var n=function(n,r){var i,a=n.getUniformLocation(e,r.name),s=r.type,o=r.size>1&&"[0]"===r.name.substr(-3);if(s===n.FLOAT&&o)return function(e){n.uniform1fv(a,e)};if(s===n.FLOAT)return function(e){n.uniform1f(a,e)};if(s===n.FLOAT_VEC2)return function(e){n.uniform2fv(a,e)};if(s===n.FLOAT_VEC3)return function(e){n.uniform3fv(a,e)};if(s===n.FLOAT_VEC4)return function(e){n.uniform4fv(a,e)};if(s===n.INT&&o)return function(e){n.uniform1iv(a,e)};if(s===n.INT)return function(e){n.uniform1i(a,e)};if(s===n.INT_VEC2)return function(e){n.uniform2iv(a,e)};if(s===n.INT_VEC3)return function(e){n.uniform3iv(a,e)};if(s===n.INT_VEC4)return function(e){n.uniform4iv(a,e)};if(s===n.BOOL)return function(e){n.uniform1iv(a,e)};if(s===n.BOOL_VEC2)return function(e){n.uniform2iv(a,e)};if(s===n.BOOL_VEC3)return function(e){n.uniform3iv(a,e)};if(s===n.BOOL_VEC4)return function(e){n.uniform4iv(a,e)};if(s===n.FLOAT_MAT2)return function(e){n.uniformMatrix2fv(a,!1,e)};if(s===n.FLOAT_MAT3)return function(e){n.uniformMatrix3fv(a,!1,e)};if(s===n.FLOAT_MAT4)return function(e){n.uniformMatrix4fv(a,!1,e)};if((s===n.SAMPLER_2D||s===n.SAMPLER_CUBE)&&o){for(var u=[],c=t.getBindPointForSamplerType(s),l=0;l<r.size;++l)u.push(++t.textureUnit);return function(e){return function(t){n.uniform1iv(a,e),t.forEach(function(t,r){n.activeTexture(n.TEXTURE0+e[r]),n.bindTexture(c,t)})}}(u)}if(s===n.SAMPLER_2D||s===n.SAMPLER_CUBE){var f=t.getBindPointForSamplerType(s);return i=++t.textureUnit,function(e){n.uniform1i(a,i),n.activeTexture(n.TEXTURE0+i),n.bindTexture(f,e)}}console.error("unknown type: 0x"+s.toString(16))},r=this._gl,i={},a=r.getProgramParameter(e,r.ACTIVE_UNIFORMS),s=0;s<a;++s){var o=r.getActiveUniform(e,s);if(!o)break;var u=o.name;"[0]"===u.substr(-3)&&(u=u.substr(0,u.length-3)),i[u]=n(r,o)}return i}},{key:"createAttributeSetters",value:function(e){function t(e,t){return function(n){e.bindBuffer(e.ARRAY_BUFFER,n.buffer),e.enableVertexAttribArray(t),e.vertexAttribPointer(t,n.numComponents||n.size,n.type||e.FLOAT,n.normalize||!1,n.stride||0,n.offset||0)}}for(var n=this._gl,r={},i=n.getProgramParameter(e,n.ACTIVE_ATTRIBUTES),a=0;a<i;++a){var s=n.getActiveAttrib(e,a);if(!s)break;var o=n.getAttribLocation(e,s.name);r[s.name]=t(n,o)}return r}},{key:"createProgram",value:function(e,t){var n=this._gl,r=this.loaderShader(n.VERTEX_SHADER,e),i=this.loaderShader(n.FRAGMENT_SHADER,t),a=n.createProgram();return n.attachShader(a,r),n.attachShader(a,i),n.linkProgram(a),n.getProgramParameter(a,n.LINK_STATUS)?(this.deleteShader(r),this.deleteShader(i),a):(n.deleteProgram(a),console.error("Unable to initialize the shader program: "+n.getProgramInfoLog(a)),null)}},{key:"useProgram",value:function(e){this._gl.useProgram(e)}},{key:"createProgramInfo",value:function(e,t){var n=this.createProgram(e,t);return{program:n,uniformSetters:this.createUniformsSetter(n),attribSetters:this.createAttributeSetters(n)}}},{key:"getGLTypeForTypedArray",value:function(e){var t=this._gl;return e instanceof Int8Array?t.BYTE:e instanceof Uint8Array?t.UNSIGNED_BYTE:e instanceof Int16Array?t.SHORT:e instanceof Uint16Array?t.UNSIGNED_SHORT:e instanceof Int32Array?t.INT:e instanceof Uint32Array?t.UNSIGNED_INT:e instanceof Float32Array?t.FLOAT:void console.error("unsupported typed array type")}},{key:"createBufferFromTypedArray",value:function(e,t,n){var r=this._gl;t=t||r.ARRAY_BUFFER;var i=r.createBuffer();return r.bindBuffer(t,i),r.bufferData(t,e,n||r.STATIC_DRAW),i}},{key:"updateBufferFromTypedArray",value:function(e,t,n,r){var i=this._gl;return n=n||i.ARRAY_BUFFER,i.bindBuffer(n,e),i.bufferData(n,t,r||i.STATIC_DRAW),e}},{key:"createVAO",value:function(){return this.extensions.get(ge.OES_VERTEX_ARRAY_OBJECT).createVertexArrayOES()}},{key:"createAttributeBufferArrayInfo",value:function(e,t,n){var r=this._gl,i=n?r.ELEMENT_ARRAY_BUFFER:r.ARRAY_BUFFER,a=e.length;return{buffer:this.createBufferFromTypedArray(e,i),numComponents:t,size:a,isIndices:n,type:this.getGLTypeForTypedArray(e)}}},{key:"updateAttributeBufferArrayInfo",value:function(e,t){var n=this._gl,r=e.isIndices?n.ELEMENT_ARRAY_BUFFER:n.ARRAY_BUFFER;return this.updateBufferFromTypedArray(e.buffer,t,r),e.size=t.length,e}},{key:"updateSubAttributeBufferArrayInfo",value:function(e,t,n){var r=this._gl,i=e.isIndices?r.ELEMENT_ARRAY_BUFFER:r.ARRAY_BUFFER;r.bindBuffer(i,e.buffer),r.bufferSubData(i,t,n)}},{key:"bindVAO",value:function(e){this.extensions.get(ge.OES_VERTEX_ARRAY_OBJECT).bindVertexArrayOES(e)}},{key:"setAttributes",value:function(e,t){e=e.attribSetters||e,Object.keys(t).forEach(function(n){var r=e[n];r&&r(t[n])})}},{key:"setBuffersAndAttributes",value:function(e,t){var n=this._gl;this.setAttributes(e,t.attributes),t.indices&&n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,t.indices.buffer)}},{key:"bindVAOAndSetAttributes",value:function(e,t,n,r){var i=this._gl;this.extensions.get(ge.OES_VERTEX_ARRAY_OBJECT).bindVertexArrayOES(r),this.setAttributes(e,t),n&&i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,n.buffer)}},{key:"setUniforms",value:function(e,t){e=e.uniformSetters||e,Object.keys(t).forEach(function(n){var r=e[n];r&&r(t[n])})}},{key:"genTexture",value:function(e){var t=e.wrapS,n=e.wrapT,r=e.isCubeTexture,i=void 0!==r&&r,a=this._gl,s=i?a.TEXTURE_CUBE_MAP:a.TEXTURE_2D,o=a.createTexture(),u=a[t],c=a[n],l=a.NEAREST,f=a.NEAREST;return a.bindTexture(s,o),a.texParameteri(s,a.TEXTURE_WRAP_S,u),a.texParameteri(s,a.TEXTURE_WRAP_T,c),a.texParameteri(s,a.TEXTURE_MIN_FILTER,l),a.texParameteri(s,a.TEXTURE_MAG_FILTER,f),o}},{key:"updateTexture",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,a=arguments.length>5?arguments[5]:void 0,s=arguments.length>6&&void 0!==arguments[6]&&arguments[6],o=this._gl,u=a||o.RGBA,c=a||o.RGBA,l=o.UNSIGNED_BYTE,f=t||null;s&&!t||(s?f instanceof Array&&(o.texImage2D(o.TEXTURE_CUBE_MAP_POSITIVE_X,0,u,c,l,f[3]),o.texImage2D(o.TEXTURE_CUBE_MAP_NEGATIVE_X,0,u,c,l,f[2]),o.texImage2D(o.TEXTURE_CUBE_MAP_POSITIVE_Y,0,u,c,l,f[0]),o.texImage2D(o.TEXTURE_CUBE_MAP_NEGATIVE_Y,0,u,c,l,f[1]),o.texImage2D(o.TEXTURE_CUBE_MAP_POSITIVE_Z,0,u,c,l,f[4]),o.texImage2D(o.TEXTURE_CUBE_MAP_NEGATIVE_Z,0,u,c,l,f[5])):(o.bindTexture(o.TEXTURE_2D,e),f?o.texImage2D(o.TEXTURE_2D,0,u,c,l,f):o.texImage2D(o.TEXTURE_2D,0,u,n,r,i,c,l,f)))}},{key:"bindFrameBuffer",value:function(e){this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,e)}},{key:"genFramebufferTexture",value:function(e){var t=this._gl,n=t.createFramebuffer();return t.bindFramebuffer(t.FRAMEBUFFER,n),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,e,0),n}},{key:"genRenderBuffer",value:function(e,t){var n=this._gl,r=n.createRenderbuffer();return n.bindRenderbuffer(n.RENDERBUFFER,r),n.renderbufferStorage(n.RENDERBUFFER,n.RGBA4,e,t),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.RENDERBUFFER,r),r}},{key:"disable",value:function(e){this._gl.disable(e)}},{key:"enable",value:function(e){this._gl.enable(e)}},{key:"viewport",value:function(e,t,n,r){this._gl.viewport(e,t,n,r)}},{key:"setClearColor",value:function(e,t,n,r){this._gl.clearColor(e,t,n,r)}},{key:"setClearDepth",value:function(e){this._gl.clearDepth(e)}},{key:"setClearStencil",value:function(e){this._gl.clearStencil(e)}},{key:"clear",value:function(){var e=this._gl;e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT|e.STENCIL_BUFFER_BIT)}},{key:"drawElements",value:function(e){var t=this._gl,n=t.UNSIGNED_SHORT;t.drawElements(t.TRIANGLES,e,n,0)}},{key:"deleteVAO",value:function(e){this.extensions.get(ge.OES_VERTEX_ARRAY_OBJECT).deleteVertexArrayOES(e)}},{key:"deleteBuffer",value:function(e){this._gl.deleteBuffer(e)}},{key:"deleteTexture",value:function(e){this._gl.deleteTexture(e)}},{key:"deleteShader",value:function(e){this._gl.deleteShader(e)}},{key:"deleteProgram",value:function(e){this._gl.deleteProgram(e)}},{key:"deleteFramebuffer",value:function(e){this._gl.deleteFramebuffer(e)}},{key:"deleteRenderbuffer",value:function(e){this._gl.deleteRenderbuffer(e)}},{key:"disposeContext",value:function(){this._gl.getExtension("WEBGL_lose_context").loseContext()}}]),e}(),ye=function(){function e(t){Object(r.a)(this,e),this._gl=t,this.tempColor=new L,this.currentMask=null,this.currentClear=new L(0,0,0,0)}return Object(i.a)(e,[{key:"setMask",value:function(e){this.currentMask!==e&&(this._gl.colorMask(e,e,e,e),this.currentMask=e)}},{key:"setClear",value:function(e,t,n,r,i){!0===i&&(e*=r,t*=r,n*=r),this.tempColor.set(e,t,n,r),!1===this.currentClear.equals(this.tempColor)&&(this._gl.clearColor(e,t,n,r),this.currentClear.copy(this.tempColor))}},{key:"reset",value:function(){this.currentColorMask=null,this.currentClear.set(-1,0,0,0)}}]),e}(),Ae=function(){function e(t){Object(r.a)(this,e),this._gl=t,this.currentTest=null,this.currentMask=null,this.currentFunc=null,this.currentClear=null}return Object(i.a)(e,[{key:"setTest",value:function(e){if(this.currentTest!==e){var t=this._gl;e?t.enable(t.DEPTH_TEST):t.disable(t.DEPTH_TEST),this.currentTest=e}}},{key:"setMask",value:function(e){this.currentMask!==e&&(this._gl.depthMask(e),this.currentMask=e)}},{key:"setFunc",value:function(e){if(this.currentFunc!==e){var t=this._gl;t.depthFunc(t[e]),this.currentFunc=e}}},{key:"setClear",value:function(e){this.currentClear!==e&&(this._gl.clearDepth(e),this.currentClear=e)}},{key:"reset",value:function(){this.currentFunc=null}}]),e}(),be=function(){function e(t){Object(r.a)(this,e),this._gl=t,this.currentTest=null,this.currentMask=null,this.currentFunc=null,this.currentFuncRef=null,this.currentFuncMask=null,this.currentFail=null,this.currentZFail=null,this.currentZPass=null,this.currentClear=null}return Object(i.a)(e,[{key:"setTest",value:function(e){if(this.currentTest!==e){var t=this._gl;e?t.enable(t.STENCIL_TEST):t.disable(t.STENCIL_TEST),this.currentTest=e}}},{key:"setMask",value:function(e){this.currentMask!==e&&(this._gl.stencilMask(e),this.currentMask=e)}},{key:"setFunc",value:function(e,t,n){if(this.currentFunc!==e||this.currentFuncRef!==t||this.currentFuncMask!==n){var r=this._gl;r.stencilFunc(r[e],t,n),this.currentFunc=e,this.currentFuncRef=t,this.currentFuncMask=n}}},{key:"setOp",value:function(e,t,n){if(this.currentFail!==e||this.currentZFail!==t||this.currentZPass!==n){var r=this._gl;r.stencilOp(r[e],r[t],r[n]),this.currentFail=e,this.currentZFail=t,this.currentZPass=n}}},{key:"setClear",value:function(e){this.currentClear!==e&&(this._gl.clearStencil(e),this.currentClear=e)}},{key:"reset",value:function(){this.currentFunc=null}}]),e}(),Se=function(){function e(t){Object(r.a)(this,e),this._gl=t,this.currentBlend=null,this.blendEquation=null,this.blendSrc=null,this.blendDst=null,this.srcAlpha=null,this.dstAlpha=null}return Object(i.a)(e,[{key:"setBlend",value:function(e){if(this.currentBlend!==e){var t=this._gl;e?t.enable(t.BLEND):t.disable(t.BLEND),this.currentBlend=e}}},{key:"setBlendFunc",value:function(e,t){if(this.blendSrc!==e||this.blendDst!==t){var n=this._gl;n.blendFunc(n[e],n[t]),this.blendSrc=e,this.blendDst=t}}},{key:"setBlendFuncSeparate",value:function(e,t,n,r){if(this.blendSrc!==e||this.blendDst!==t||this.srcAlpha!==n||this.dstAlpha!==r){var i=this._gl;i.blendFuncSeparate(i[e],i[t],i[n],i[r]),this.blendSrc=e,this.blendDst=t,this.srcAlpha=n,this.dstAlpha=r}}},{key:"setBlendEquation",value:function(e){this.blendEquation!==e&&(this._gl.blendEquation(this._gl[e]),this.blendEquation=e)}},{key:"reset",value:function(){this.currentBlend=null}}]),e}(),Te=function(){function e(t){Object(r.a)(this,e),this._gl=t,this.currentCullType=null,this.enableCullType=null}return Object(i.a)(e,[{key:"setCullType",value:function(e){if(this.currentCullType!==e){var t=this._gl;e===M.a.FRONT||e===M.a.BACK?(!0!==this.enableCullType&&t.enable(t.CULL_FACE),t.cullFace(t[e]),this.enableCullType=!0):!1!==this.enableCullType&&(t.disable(t.CULL_FACE),this.enableCullType=!1),this.currentCullType=e}}},{key:"reset",value:function(){this.currentCullType=null}}]),e}(),Oe=function e(t){Object(r.a)(this,e),this.depthBuffer=new Ae(t),this.stencilBuffer=new be(t),this.colorBuffer=new ye(t),this.blending=new Se(t),this.CullFace=new Te(t)},Me=function(){function e(){Object(r.a)(this,e),this.programsInfo={},this.uniforms={},this.attributes={},this.textures={},this.frameBuffers={},this.VAOs={}}return Object(i.a)(e,null,[{key:"getCacheByTarget",value:function(t,n,r){var i=t[n];return!i&&r&&e.setCacheByTarget(t,n,r),i}},{key:"setCacheByTarget",value:function(e,t,n){return e[t]=n}}]),Object(i.a)(e,[{key:"getUniform",value:function(e){return this.uniforms[e]}},{key:"setUniform",value:function(e,t){this.uniforms[e]=t}},{key:"getProgramInfo",value:function(e){return this.programsInfo[e]}},{key:"setProgramInfo",value:function(e,t){this.programsInfo[e]=t}},{key:"getTexture",value:function(e){return this.textures[e]}},{key:"setTexture",value:function(e,t){this.textures[e]=t}},{key:"getAttribute",value:function(e){return this.attributes[e]}},{key:"setAttribute",value:function(e,t){this.attributes[e]=t}},{key:"getFrameBuffer",value:function(e){return this.frameBuffers[e]}},{key:"setFrameBuffer",value:function(e,t){this.frameBuffers[e]=t}},{key:"getVAO",value:function(e){return this.VAOs[e]}},{key:"setVAO",value:function(e,t){this.VAOs[e]=t}}]),e}(),Ue=function(){function e(){Object(r.a)(this,e)}return Object(i.a)(e,null,[{key:"create",value:function(e){var t=Ee.createContext(e),n=new ge(t),r=new Oe(t),i=new Ee(t,n,r),a=new Me;return new me(i,a)}}]),e}();n.d(t,"p",function(){return d}),n.d(t,"m",function(){return m}),n.d(t,"f",function(){return g}),n.d(t,"b",function(){return E}),n.d(t,"c",function(){return b}),n.d(t,"u",function(){return T}),n.d(t,"n",function(){return O}),n.d(t,"q",function(){return S}),n.d(t,"s",function(){return R}),n.d(t,"t",function(){return k}),n.d(t,"g",function(){return F}),n.d(t,"l",function(){return I}),n.d(t,"i",function(){return N}),n.d(t,"h",function(){return P}),n.d(t,"j",function(){return w}),n.d(t,"k",function(){return j}),n.d(t,"a",function(){return V}),n.d(t,"e",function(){return B}),n.d(t,"o",function(){return z}),n.d(t,"r",function(){return G}),n.d(t,"v",function(){return c}),n.d(t,"d",function(){return L}),n.d(t,"x",function(){return H}),n.d(t,"y",function(){return Ue}),n.d(t,"w",function(){return ge})},53:function(e,t,n){"use strict";n.d(t,"a",function(){return o});var r=n(5),i=n(6),a=n(52),s=n(55),o=function(){function e(){Object(r.a)(this,e),this.canvas=null,this.renderer=null,this.renderTarget=null,this.scene=null,this.camera=null,this.needRender=!1,this.listenerManager=new s.a}return Object(i.a)(e,[{key:"setUp",value:function(e){this.renderer=a.y.create({canvas:e,antialias:!0}),this.listenerManager.addListener("resize",this.resize.bind(this),window),this.canvas=e,this.scene=new a.p;var t=this.camera=new a.m(70,e.clientWidth/e.clientHeight,.1,1e3);t.position.set(0,0,5),t.updateMatrix(),t.lookAt(new a.v(0,0,0)),e.width=e.clientWidth,e.height=e.clientHeight}},{key:"loadScene",value:function(){}},{key:"dispose",value:function(){this.needRender=!1,this.listenerManager.dispose(),this.renderer&&this.renderer.dispose(),this.renderer=null,this.scene.dispose(),this.camera.dispose()}},{key:"render",value:function(){this.renderer.render(this.scene,this.camera)}},{key:"resize",value:function(){this.resizeCanvas(),this.updateCamera(this.canvas.width,this.canvas.height)}},{key:"resizeCanvas",value:function(){var e=this.canvas;e.width=e.clientWidth,e.height=e.clientHeight}},{key:"updateCamera",value:function(e,t){this.renderer.viewport(0,0,e,t),this.camera.aspect=e/t,this.camera.updateProjectionMatrix()}},{key:"startAnimate",value:function(){this.needRender=!0,this.animate()}},{key:"animate",value:function(){this.needRender&&(this.render(),requestAnimationFrame(this.animate.bind(this)))}}]),e}()},54:function(e,t,n){"use strict";t.a={FRONT:"FRONT",BACK:"BACK",LEQUAL:"LEQUAL",LESS:"LESS",ALWAYS:"ALWAYS",NEVER:"NEVER",EQUAL:"EQUAL",NOTEQUAL:"NOTEQUAL",GEQUAL:"GEQUAL",GREATER:"GREATER",KEEP:"KEEP",REPLACE:"REPLACE",INCR:"INCR",INCR_WRAP:"INCR_WRAP",DECR:"DECR",DECR_WRAP:"DECR_WRAP",INVERT:"INVERT",ZERO:"ZERO",ONE:"ONE",SRC_COLOR:"SRC_COLOR",ONE_MINUS_SRC_COLOR:"ONE_MINUS_SRC_COLOR",DST_COLOR:"DST_COLOR",ONE_MINUS_DST_COLOR:"ONE_MINUS_DST_COLOR",SRC_ALPHA:"SRC_ALPHA",ONE_MINUS_SRC_ALPHA:"ONE_MINUS_SRC_ALPHA",DST_ALPHA:"DST_ALPHA",ONE_MINUS_DST_ALPHA:"ONE_MINUS_DST_ALPHA",CONSTANT_COLOR:"CONSTANT_COLOR",ONE_MINUS_CONSTANT_COLOR:"ONE_MINUS_CONSTANT_COLOR",CONSTANT_ALPHA:"CONSTANT_ALPHA",ONE_MINUS_CONSTANT_ALPHA:"ONE_MINUS_CONSTANT_ALPHA",FUNC_ADD:"FUNC_ADD",FUNC_SUBTRACT:"FUNC_SUBTRACT",FUNC_REVERSE_SUBTRACT:"FUNC_REVERSE_SUBTRACT",CLAMP_TO_EDGE:"CLAMP_TO_EDGE",REPEAT:"REPEAT"}},55:function(e,t,n){"use strict";n.d(t,"a",function(){return a});var r=n(5),i=n(6),a=function(){function e(){Object(r.a)(this,e),this.listens=[]}return Object(i.a)(e,[{key:"addListener",value:function(e,t,n){n.addEventListener(e,t,!1),this.listens.push({target:n,type:e,handler:t})}},{key:"dispose",value:function(){this.listens.forEach(function(e){e.target.removeEventListener(e.type,e.handler)})}}]),e}()}}]);