(window.webpackJsonp=window.webpackJsonp||[]).push([[3],{47:function(e,t,r){"use strict";r.r(t),r.d(t,"default",function(){return m});var a=r(32),n=r.n(a),c=r(37),s=r(33),o=r(2),i=r(3),u=r(36),p=r(35),h=r(34),m=function(){function e(){var t=this;Object(o.a)(this,e),this.onDown=function(){t.isAnimate=!t.isAnimate},this.onResize=function(){var e=t.state,r=t.canvas.width=window.innerWidth,a=t.canvas.height=window.innerHeight;e.viewport(0,0,r,a);var n=t.sphereMeshInfo.projectionMatrix,c=t.sphereMeshInfo.viewMatrix=h.a.create(),s=h.c.set(h.c.create(),0,0,100+50*Math.max(a/r-1,0));h.a.perspective(n,Math.PI/3,r/a,.1,500),h.a.lookAt(c,h.c.set(h.c.create(),s[0],s[1],s[2]),h.c.set(h.c.create(),0,0,0),h.c.set(h.c.create(),0,-1,0)),e.use(t.sphereMeshInfo.program),e.setMat4("projection",n),e.setMat4("view",c),e.use(t.backgroundMeshInfo.program),e.setMat4("projection",n),e.setMat4("view",c),t.reDraw()},this.state=null,this.canvas=null,this.sphereMeshInfo=null,this.backgroundMeshInfo=null,this.isAnimate=!1}return Object(i.a)(e,[{key:"run",value:function(){var e=Object(s.a)(n.a.mark(function e(t){var r,a,s,o,i,m,g,l,d,w,M,T,f,I,E,x,v,F,A,L,R,B,G,_,N,b,U,C,D,y,k,O,P,S,j,V,H,z,Y,q,J,W,X,K,Q,Z,$,ee,te,re,ae,ne;return n.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(new p.a).load("./assets/textures/hdr/skybox.png",void 0,p.a.IMAGE);case 2:return r=e.sent,a=new Uint8Array([255,255,255,255]),s=new Uint8Array([255]),e.next=7,(new p.a).load("./assets/textures/pbr/rusted_iron/normal.png",void 0,p.a.IMAGE);case 7:for(o=e.sent,i=new Uint8Array([255]),m=new Uint8Array([255]),t.width=window.innerWidth,t.height=window.innerHeight,g=h.a.perspective(h.a.create(),Math.PI/2,1,.1,10),l=[h.a.lookAt(h.a.create(),h.c.set(h.c.create(),0,0,0),h.c.set(h.c.create(),1,0,0),h.c.set(h.c.create(),0,-1,0)),h.a.lookAt(h.a.create(),h.c.set(h.c.create(),0,0,0),h.c.set(h.c.create(),-1,0,0),h.c.set(h.c.create(),0,-1,0)),h.a.lookAt(h.a.create(),h.c.set(h.c.create(),0,0,0),h.c.set(h.c.create(),0,1,0),h.c.set(h.c.create(),0,0,1)),h.a.lookAt(h.a.create(),h.c.set(h.c.create(),0,0,0),h.c.set(h.c.create(),0,-1,0),h.c.set(h.c.create(),0,0,-1)),h.a.lookAt(h.a.create(),h.c.set(h.c.create(),0,0,0),h.c.set(h.c.create(),0,0,1),h.c.set(h.c.create(),0,-1,0)),h.a.lookAt(h.a.create(),h.c.set(h.c.create(),0,0,0),h.c.set(h.c.create(),0,0,-1),h.c.set(h.c.create(),0,-1,0))],d=h.c.set(h.c.create(),0,0,110),w=h.a.perspective(h.a.create(),Math.PI/3,t.width/t.height,.1,500),M=h.a.lookAt(h.a.create(),h.c.set(h.c.create(),d[0],d[1],d[2]),h.c.set(h.c.create(),0,0,0),h.c.set(h.c.create(),0,-1,0)),T=new u.a,f=new u.g,I=new u.j(5,64,64),E=[h.c.set(h.c.create(),0,0,30),h.c.set(h.c.create(),30,30,30),h.c.set(h.c.create(),-30,-30,30),h.c.set(h.c.create(),30,-30,30)],x=[h.c.set(h.c.create(),300,300,300),h.c.set(h.c.create(),300,300,300),h.c.set(h.c.create(),300,300,300),h.c.set(h.c.create(),300,300,300)],v=new u.o(t),(F=v.getContext()).getExtension("EXT_color_buffer_float"),F.enable(F.CULL_FACE),F.cullFace(F.FRONT),A=v.createVaoFromGeometry(T),L=v.createVaoFromGeometry(f),R=v.createVaoFromGeometry(I),B=v.createRenderTarget(512,512),G=v.createTexture2D({image:a,width:1,height:1,internalFormat:F.RGBA,format:F.RGBA,type:F.UNSIGNED_BYTE}),_=v.createTexture2D({image:s,width:1,height:1,internalFormat:F.LUMINANCE,format:F.LUMINANCE,type:F.UNSIGNED_BYTE}),N=v.createTexture2D({image:o,internalFormat:F.RGBA,format:F.RGBA,type:F.UNSIGNED_BYTE}),b=v.createTexture2D({image:i,width:1,height:1,internalFormat:F.LUMINANCE,format:F.LUMINANCE,type:F.UNSIGNED_BYTE}),U=v.createTexture2D({image:m,width:1,height:1,internalFormat:F.LUMINANCE,format:F.LUMINANCE,type:F.UNSIGNED_BYTE}),C=v.createTexture2D({image:r,internalFormat:F.RGBA16F,format:F.RGBA,type:F.FLOAT}),D=v.createTextureCube({internalFormat:F.RGBA16F,format:F.RGBA,type:F.FLOAT,width:512,height:512,minF:F.LINEAR_MIPMAP_LINEAR}),y=v.createTextureCube({internalFormat:F.RGBA16F,format:F.RGBA,type:F.FLOAT,width:32,height:32}),k=v.createTextureCube({internalFormat:F.RGBA16F,format:F.RGBA,type:F.FLOAT,width:128,height:128,minF:F.LINEAR_MIPMAP_LINEAR,levels:5}),O=v.createTexture2D({internalFormat:F.RG16F,format:F.RG,type:F.FLOAT,width:512,height:512}),P=u.i.pbr,S=u.i.brdf,j=u.i.background,V=u.i.prefilter,H=u.i.convert_2d_to_cubemap,z=u.i.irradiance_convolution,Y=v.createProgramInfo(P.vs.getSource(),P.fs.getSource()),q=v.createProgramInfo(S.vs.getSource(),S.fs.getSource()),J=v.createProgramInfo(j.vs.getSource(),j.fs.getSource()),W=v.createProgramInfo(V.vs.getSource(),V.fs.getSource()),X=v.createProgramInfo(H.vs.getSource(),H.fs.getSource()),K=v.createProgramInfo(z.vs.getSource(),z.fs.getSource()),v.enableDepthTest(F.DEPTH_TEST),v.setClearColor(0,0,0,1),v.viewport(0,0,512,512),v.use(X.program),v.setMat4("projection",g),v.setInt("equirectangularMap",0),v.setTexture2D(C,0),v.setVao(A),Q=0;Q<6;++Q)v.setCubeRenderTarget(B,D,Q),v.setMat4("view",l[Q]),v.clear(F.COLOR_BUFFER_BIT|F.DEPTH_BUFFER_BIT),v.drawElements(36);for(v.generateMipmap(F.TEXTURE_CUBE_MAP,D),v.unBindRenderTarget(),v.use(K.program),v.viewport(0,0,32,32),v.setMat4("projection",g),v.setInt("environmentMap",0),v.setTextureCube(D,0,!0),v.setVao(A),v.resizeRenderTarget(B,32,32),v.clear(F.COLOR_BUFFER_BIT|F.DEPTH_BUFFER_BIT),Z=0;Z<6;++Z)v.setMat4("view",l[Z]),v.setCubeRenderTarget(B,y,Z),v.drawElements(36);for(v.unBindRenderTarget(),v.use(W.program),v.setMat4("projection",g),v.setVao(A),v.setInt("environmentMap",0),5,$=0;$<5;++$)for(ee=128*Math.pow(.5,$),te=128*Math.pow(.5,$),re=$/4,v.viewport(0,0,ee,te),v.resizeRenderTarget(B,ee,te),v.setFloat("roughness",re),ae=0;ae<6;++ae)v.setMat4("view",l[ae]),v.setTextureCube(D,0,!0),v.setCubeRenderTarget(B,k,ae,$),v.clear(F.COLOR_BUFFER_BIT|F.DEPTH_BUFFER_BIT),v.drawElements(36);for(v.unBindRenderTarget(),F.cullFace(F.BACK),v.use(q.program),v.viewport(0,0,512,512),v.setVao(L),v.resizeRenderTarget(B,512,512),v.setRenderTarget(B,O),v.clear(F.COLOR_BUFFER_BIT|F.DEPTH_BUFFER_BIT),v.drawElements(f.indices.data.length),v.unBindRenderTarget(),F.cullFace(F.FRONT),v.use(Y.program),v.viewport(0,0,t.width,t.height),v.setVao(R),v.setMat4("projection",w),v.setMat4("view",M),v.setVec3.apply(v,["camPos"].concat(Object(c.a)(d))),v.setFloat("opacity",1),v.setInt("irradianceMap",0),v.setInt("prefilterMap",1),v.setInt("brdfLUT",2),v.setInt("albedoMap",3),v.setInt("normalMap",4),v.setInt("aoMap",5),v.setInt("metallicMap",6),v.setInt("roughnessMap",5),ne=0;ne<E.length;++ne)v.setVec3.apply(v,["pointLightPositions["+ne+"]"].concat(Object(c.a)(E[ne]))),v.setVec3.apply(v,["pointLightColors["+ne+"]"].concat(Object(c.a)(x[ne])));v.use(J.program),v.setMat4("view",M),v.setMat4("projection",w),v.setInt("environmentMap",0),this.state=v,this.canvas=t,this.sphereMeshInfo=new u.c({program:Y.program,vao:R,geometry:I,projectionMatrix:w,viewMatrix:M,textures:{irradianceMap:new u.k({textureGL:y}),prefilterMap:new u.k({textureGL:k}),brdfLUTMap:new u.k({textureGL:O}),albedoMap:new u.k({textureGL:G}),normalMap:new u.k({textureGL:N}),aoMap:new u.k({textureGL:_}),metallicMap:new u.k({textureGL:b,image:i}),roughnessMap:new u.k({textureGL:U,image:m})}}),this.backgroundMeshInfo=new u.c({program:J.program,vao:A,geometry:T,textures:{environmentMap:new u.l({textureGL:D})}}),this.onResize(),this.animate(),window.addEventListener("resize",this.onResize,!1),window.addEventListener("mousedown",this.onDown,!1),window.addEventListener("touchstart",this.onDown,!1);case 109:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"animate",value:function(){this.reDraw(),requestAnimationFrame(this.animate.bind(this))}},{key:"reDraw",value:function(){var e=this.state,t=e.getContext(),r=this.sphereMeshInfo,a=this.backgroundMeshInfo,n=r.vao,c=r.geometry,s=r.textures,o=r.geometry.radius+1,i=s.irradianceMap.textureGL,u=s.prefilterMap.textureGL,p=s.brdfLUTMap.textureGL,m=s.albedoMap.textureGL,g=s.normalMap.textureGL,l=s.aoMap.textureGL,d=s.metallicMap.image,w=s.metallicMap.textureGL,M=s.roughnessMap.image,T=s.roughnessMap.textureGL,f=a.textures.environmentMap.textureGL,I=h.a.create(),E=this.isAnimate?0:5*-o/2;h.a.translate(I,I,h.c.set(h.c.create(),E,5*-o/2,0));var x=h.c.set(h.c.create(),o,0,0),v=h.c.set(h.c.create(),0,o,0);t.enable(t.CULL_FACE),t.cullFace(t.FRONT),e.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT),e.use(r.program),e.setVao(n),e.setTextureCube(i,0),e.setTextureCube(u,1),e.setTexture2D(p,2),e.setTexture2D(m,3),e.setTexture2D(g,4),e.setTexture2D(l,5);for(var F=0;F<6;F++){d[0]=255-42.5*F,e.updateTexture2D({textureBuffer:w,image:d,width:1,height:1,internalFormat:t.LUMINANCE,format:t.LUMINANCE,type:t.UNSIGNED_BYTE}),e.setTexture2D(w,6);for(var A=h.c.scale(h.c.create(),x,F),L=0;L<6;L++){M[0]=255-42.5*L,e.updateTexture2D({textureBuffer:T,image:M,width:1,height:1,internalFormat:t.LUMINANCE,format:t.LUMINANCE,type:t.UNSIGNED_BYTE}),this.isAnimate&&h.a.rotate(I,I,Math.PI/4*Math.sin((new Date).getTime()/1e4),h.c.set(h.c.create(),0,1,0)),e.setTexture2D(T,7);var R=h.c.add(h.c.create(),A,h.c.scale(h.c.create(),v,L)),B=h.a.translate(h.a.create(),I,R);e.setMat4("model",B),e.drawElements(c.indices.data.length)}}e.use(a.program),e.setVao(a.vao),e.setTextureCube(f),e.drawElements(a.geometry.indices.data.length)}}]),e}()}}]);