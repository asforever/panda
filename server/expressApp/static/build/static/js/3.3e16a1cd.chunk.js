(window.webpackJsonp=window.webpackJsonp||[]).push([[3],{47:function(e,t,r){"use strict";r.r(t),r.d(t,"default",function(){return l});var a=r(32),c=r.n(a),o=r(37),n=r(33),s=r(2),i=r(3),u=r(36),p=r(35),g=r(34),l=function(){function e(){Object(s.a)(this,e)}return Object(i.a)(e,[{key:"run",value:function(){var e=Object(n.a)(c.a.mark(function e(t){var r,a,n,s,i,l,T,m,d,h,E,F,w,f,A,R,B,M,I,_,N,U,x,C,v,D,b,L,y,G,O,P,S,k,V,j,H,Y,z,J,X,q,K,W,Q,Z,$,ee,te,re,ae,ce,oe,ne,se,ie,ue,pe,ge,le,Te;return c.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(new p.a).load("./assets/textures/hdr/skybox.png",void 0,p.a.IMAGE);case 2:return r=e.sent,a=new Uint8Array([255,0,0,255]),n=new Uint8Array([255]),e.next=7,(new p.a).load("./assets/textures/pbr/rusted_iron/normal.png",void 0,p.a.IMAGE);case 7:for(s=e.sent,i=new Uint8Array([255]),l=new Uint8Array([255]),t.width=window.innerWidth,t.height=window.innerHeight,T=g.a.perspective(g.a.create(),Math.PI/2,1,.1,10),m=[g.a.lookAt(g.a.create(),g.c.set(g.c.create(),0,0,0),g.c.set(g.c.create(),1,0,0),g.c.set(g.c.create(),0,-1,0)),g.a.lookAt(g.a.create(),g.c.set(g.c.create(),0,0,0),g.c.set(g.c.create(),-1,0,0),g.c.set(g.c.create(),0,-1,0)),g.a.lookAt(g.a.create(),g.c.set(g.c.create(),0,0,0),g.c.set(g.c.create(),0,1,0),g.c.set(g.c.create(),0,0,1)),g.a.lookAt(g.a.create(),g.c.set(g.c.create(),0,0,0),g.c.set(g.c.create(),0,-1,0),g.c.set(g.c.create(),0,0,-1)),g.a.lookAt(g.a.create(),g.c.set(g.c.create(),0,0,0),g.c.set(g.c.create(),0,0,1),g.c.set(g.c.create(),0,-1,0)),g.a.lookAt(g.a.create(),g.c.set(g.c.create(),0,0,0),g.c.set(g.c.create(),0,0,-1),g.c.set(g.c.create(),0,-1,0))],d=g.a.perspective(g.a.create(),Math.PI/3,t.width/t.height,.1,100),h=g.a.lookAt(g.a.create(),g.c.set(g.c.create(),30,0,70),g.c.set(g.c.create(),0,0,0),g.c.set(g.c.create(),0,-1,0)),E=[30,0,70],F=new u.a,w=new u.g,f=new u.j(5,64,64),A=[g.c.set(g.c.create(),0,0,30),g.c.set(g.c.create(),30,30,30),g.c.set(g.c.create(),-30,-30,30),g.c.set(g.c.create(),30,-30,30)],R=[g.c.set(g.c.create(),300,300,300),g.c.set(g.c.create(),300,300,300),g.c.set(g.c.create(),300,300,300),g.c.set(g.c.create(),300,300,300)],B=new u.o(t),(M=B.getContext()).getExtension("EXT_color_buffer_float"),M.enable(M.CULL_FACE),M.cullFace(M.FRONT),I=B.createVaoFromGeometry(F),_=B.createVaoFromGeometry(w),N=B.createVaoFromGeometry(f),U=B.createRenderTarget(512,512),x=B.createTexture2D({image:a,width:1,height:1,internalFormat:M.RGBA,format:M.RGBA,type:M.UNSIGNED_BYTE}),C=B.createTexture2D({image:n,width:1,height:1,internalFormat:M.LUMINANCE,format:M.LUMINANCE,type:M.UNSIGNED_BYTE}),v=B.createTexture2D({image:s,internalFormat:M.RGBA,format:M.RGBA,type:M.UNSIGNED_BYTE}),D=B.createTexture2D({image:i,width:1,height:1,internalFormat:M.LUMINANCE,format:M.LUMINANCE,type:M.UNSIGNED_BYTE}),b=B.createTexture2D({image:l,width:1,height:1,internalFormat:M.LUMINANCE,format:M.LUMINANCE,type:M.UNSIGNED_BYTE}),L=B.createTexture2D({image:r,internalFormat:M.RGBA16F,format:M.RGBA,type:M.FLOAT}),y=B.createTextureCube({internalFormat:M.RGBA16F,format:M.RGBA,type:M.FLOAT,width:512,height:512,minF:M.LINEAR_MIPMAP_LINEAR}),G=B.createTextureCube({internalFormat:M.RGBA16F,format:M.RGBA,type:M.FLOAT,width:32,height:32}),O=B.createTextureCube({internalFormat:M.RGBA16F,format:M.RGBA,type:M.FLOAT,width:128,height:128,minF:M.LINEAR_MIPMAP_LINEAR,levels:5}),P=B.createTexture2D({internalFormat:M.RG16F,format:M.RG,type:M.FLOAT,width:512,height:512}),S=u.i.pbr,k=u.i.brdf,V=u.i.background,j=u.i.prefilter,H=u.i.convert_2d_to_cubemap,Y=u.i.irradiance_convolution,z=B.createProgramInfo(S.vs.getSource(),S.fs.getSource()),J=B.createProgramInfo(k.vs.getSource(),k.fs.getSource()),X=B.createProgramInfo(V.vs.getSource(),V.fs.getSource()),q=B.createProgramInfo(j.vs.getSource(),j.fs.getSource()),K=B.createProgramInfo(H.vs.getSource(),H.fs.getSource()),W=B.createProgramInfo(Y.vs.getSource(),Y.fs.getSource()),B.enableDepthTest(M.DEPTH_TEST),B.setClearColor(0,0,0,1),B.viewport(0,0,512,512),B.use(K.program),B.setMat4("projection",T),B.setTexture2D("equirectangularMap",L,0),B.setVao(I),Q=0;Q<6;++Q)B.setCubeRenderTarget(U,y,Q),B.setMat4("view",m[Q]),B.clear(M.COLOR_BUFFER_BIT|M.DEPTH_BUFFER_BIT),B.drawElements(36);for(B.generateMipmap(M.TEXTURE_CUBE_MAP,y),B.unBindRenderTarget(),B.use(W.program),B.viewport(0,0,32,32),B.setMat4("projection",T),B.setTextureCube("environmentMap",y,0,!0),B.setVao(I),B.resizeRenderTarget(U,32,32),B.clear(M.COLOR_BUFFER_BIT|M.DEPTH_BUFFER_BIT),Z=0;Z<6;++Z)B.setMat4("view",m[Z]),B.setCubeRenderTarget(U,G,Z),B.drawElements(36);for(B.unBindRenderTarget(),B.use(q.program),B.setMat4("projection",T),B.setVao(I),5,$=0;$<5;++$)for(ee=128*Math.pow(.5,$),te=128*Math.pow(.5,$),re=$/4,B.viewport(0,0,ee,te),B.resizeRenderTarget(U,ee,te),B.setFloat("roughness",re),ae=0;ae<6;++ae)B.setMat4("view",m[ae]),B.setTextureCube("environmentMap",y,0,!0),B.setCubeRenderTarget(U,O,ae,$),B.clear(M.COLOR_BUFFER_BIT|M.DEPTH_BUFFER_BIT),B.drawElements(36);for(B.unBindRenderTarget(),M.cullFace(M.BACK),B.use(J.program),B.viewport(0,0,512,512),B.setVao(_),B.resizeRenderTarget(U,512,512),B.setRenderTarget(U,P),B.clear(M.COLOR_BUFFER_BIT|M.DEPTH_BUFFER_BIT),B.drawElements(w.indices.data.length),B.unBindRenderTarget(),M.cullFace(M.FRONT),B.use(z.program),B.viewport(0,0,t.width,t.height),B.setVao(N),B.setMat4("projection",d),B.setMat4("view",h),B.setVec3.apply(B,["camPos"].concat(E)),B.setFloat("opacity",1),B.setTextureCube("irradianceMap",G,0),B.setTextureCube("prefilterMap",O,1),B.setTexture2D("brdfLUT",P,2),B.setTexture2D("albedoMap",x,3),B.setTexture2D("normalMap",v,4),B.setTexture2D("aoMap",C,5),B.clear(M.COLOR_BUFFER_BIT|M.DEPTH_BUFFER_BIT),6,6,ce=f.radius,oe=g.a.create(),g.a.translate(oe,oe,g.c.set(g.c.create(),5*-ce/2,5*-ce/2,0)),ne=g.c.set(g.c.create(),ce,0,0),se=g.c.set(g.c.create(),0,ce,0),ie=0;ie<A.length;++ie)B.setVec3.apply(B,["pointLightPositions["+ie+"]"].concat(Object(o.a)(A[ie]))),B.setVec3.apply(B,["pointLightColors["+ie+"]"].concat(Object(o.a)(R[ie])));for(ue=0;ue<6;ue++)for(i[0]=42.5*ue,B.updateTexture2D({textureBuffer:D,image:i,width:1,height:1,internalFormat:M.LUMINANCE,format:M.LUMINANCE,type:M.UNSIGNED_BYTE}),B.setTexture2D("metallicMap",D,6),pe=g.c.scale(g.c.create(),ne,ue),ge=0;ge<6;ge++)l[0]=42.5*ge,B.updateTexture2D({textureBuffer:b,image:l,width:1,height:1,internalFormat:M.LUMINANCE,format:M.LUMINANCE,type:M.UNSIGNED_BYTE}),B.setTexture2D("roughnessMap",b,7),le=g.c.add(g.c.create(),pe,g.c.scale(g.c.create(),se,ge)),Te=g.a.translate(g.a.create(),oe,le),g.a.rotate(Te,Te,Math.PI/2,g.c.set(g.c.create(),-1,1,1)),B.setMat4("model",Te),B.drawElements(f.indices.data.length);B.use(X.program),B.setMat4("view",h),B.setMat4("projection",d),B.setTextureCube("environmentMap",y,0),B.setVao(I),B.drawElements(F.indices.data.length);case 106:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()}]),e}()}}]);